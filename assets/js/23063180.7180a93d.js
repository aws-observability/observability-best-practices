"use strict";(self.webpackChunkobservability_best_practices=self.webpackChunkobservability_best_practices||[]).push([[8752],{82077:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var o=t(74848),a=t(28453);const s={},r="AWS X-Ray",i={id:"tools/xray",title:"AWS X-Ray",description:"Sampling rules",source:"@site/docs/tools/xray.md",sourceDirName:"tools",slug:"/tools/xray",permalink:"/observability-best-practices/docs/tools/xray",draft:!1,unlisted:!1,editUrl:"https://github.com/aws-observability/observability-best-practices/docs/tools/xray.md",tags:[],version:"current",frontMatter:{},sidebar:"tools",previous:{title:"Service Level Objectives (SLOs)",permalink:"/observability-best-practices/docs/tools/slos"}},c={},l=[{value:"Sampling rules",id:"sampling-rules",level:2},{value:"Daemon configuration",id:"daemon-configuration",level:2},{value:"Annotations",id:"annotations",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",p:"p",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"aws-x-ray",children:"AWS X-Ray"}),"\n",(0,o.jsx)(n.h2,{id:"sampling-rules",children:"Sampling rules"}),"\n",(0,o.jsx)(n.p,{children:"Sampling rules using X-Ray can be configured in the AWS Console, through local configuration file, or both. The local configuration will override those set in the console."}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"Use the X-Ray console, API, or CloudFormation whenever possible. This allows you to change the sampling behaviour of an application at runtime."})}),"\n",(0,o.jsx)(n.p,{children:"You can set sample rates separately for each of these criteria:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Service name (e.g. billing, payments)"}),"\n",(0,o.jsx)(n.li,{children:"Service type (e.g. EC2, Container)"}),"\n",(0,o.jsx)(n.li,{children:"HTTP method"}),"\n",(0,o.jsx)(n.li,{children:"URL path"}),"\n",(0,o.jsx)(n.li,{children:"Resource ARN"}),"\n",(0,o.jsxs)(n.li,{children:["Host (e.g. ",(0,o.jsx)(n.a,{href:"http://www.example.com",children:"www.example.com"}),")"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"The best practice is to set a sample rate that collects enough data to diagnose issues and understand performance profiles, while not collecting so much data that it is unmanageable. For example, sampling 1% of traffic to a landing page, but 10% of requests to a payment page, would align well with a strong observability practice."}),"\n",(0,o.jsx)(n.p,{children:"Some transactions you may wish to capture 100% of. Be cautious though as traces are not intended for forensic audits of access to your workload!"}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsx)(n.p,{children:"As traces are not intended to be used for auditing or forensic analysis, avoid sample rates of 100%. This can set a false expectation that X-Ray (by default using a UDP emitter) will never lose a transaction trace."})}),"\n",(0,o.jsx)(n.p,{children:"As a rule, capturing transaction traces should never create an onerous load on your staff, or your AWS bill. Add traces to your environment slowly while you learn the volume of data that your workload emits."}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"By default, the X-Ray SDK records the first request each second, and five percent of any additional requests.\nAlways set a reservoir size that you can tolerate. The reservoir size determines the maximum number of requests per second that you will capture. This protects you from malicious attack, unwanted charges, and configuration errors."})}),"\n",(0,o.jsx)(n.h2,{id:"daemon-configuration",children:"Daemon configuration"}),"\n",(0,o.jsx)(n.p,{children:"The X-Ray daemon is intended to offload the effort of sending telemetry to the X-Ray dataplane for analysis. As such, it should not consume too many resources on the server, container, or instance on which the source application runs."}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["The best practice is to run the X-Ray daemon on another instance or container, thereby enforcing the ",(0,o.jsx)(n.a,{href:"../faq/#what-is-the-separation-of-concerns",children:"separation of concerns"})," and allowing your source system to be unencumbered."]})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"In a container orchestration pattern, such as Kubernetes, operating your X-Ray daemon as a sidecar is a common practice."})}),"\n",(0,o.jsxs)(n.p,{children:["The daemon has safe default settings and can operate in EC2, ECS, EKS, or Fargate environments without futher configuration in most instances. For hybrid and other cloud environments though, you may with to adjust the ",(0,o.jsx)(n.code,{children:"Endpoint"})," to reflect a ",(0,o.jsx)(n.a,{href:"https://docs.aws.amazon.com/vpc/latest/privatelink/concepts.html",children:"VPC endpoint"})," if you are using a Direct Connect or VPN to integrate your remote environments."]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["If you must run the X-Ray daemon on the same instance or virtual machine as the source application, consider setting the ",(0,o.jsx)(n.code,{children:"TotalBufferSizeMB"})," setting to ensure X-ray does not consume more system resources than you can afford."]})}),"\n",(0,o.jsx)(n.h2,{id:"annotations",children:"Annotations"}),"\n",(0,o.jsxs)(n.p,{children:["AWS X-Ray supports arbitrary metadata to be sent along with your traces. These are called ",(0,o.jsx)(n.em,{children:"annotations"}),". They are a powerful feature that allows you to group your traces logically. Annotations are indexed as well, making for an easy way to find traces that pertain to a single entity."]}),"\n",(0,o.jsx)(n.p,{children:"When you use auto-instrumentation SDKs for X-Ray, annotations may not appear automatically. You need to add them to your code, which greatly enriches your traces and creates ways for you to generate X-Ray Insights, metrics based off of your annotations, alarms and anomaly detection models from your system behaviour, and automate ticketing and remediation when a component impacting your users is observed."}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"Use annotations to understand the flow of data in your environment."})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"Create alarms based on the performance and results of your annotated traces."})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var o=t(96540);const a={},s=o.createContext(a);function r(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);