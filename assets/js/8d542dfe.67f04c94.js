"use strict";(globalThis.webpackChunkobservability_best_practices=globalThis.webpackChunkobservability_best_practices||[]).push([[6749],{3267:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>n,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"faq/amp","title":"Amazon Managed Service for Prometheus - FAQ","description":"Which AWS Regions are supported currently and is it possible to collect metrics from other regions?","source":"@site/docs/faq/amp.md","sourceDirName":"faq","slug":"/faq/amp","permalink":"/observability-best-practices/faq/amp","draft":false,"unlisted":false,"editUrl":"https://github.com/aws-observability/observability-best-practices/blob/main/docusaurus/docs/faq/amp.md","tags":[],"version":"current","frontMatter":{},"sidebar":"faq","previous":{"title":"AWS X-Ray - FAQ","permalink":"/observability-best-practices/faq/x-ray"},"next":{"title":"Amazon Managed Grafana - FAQ","permalink":"/observability-best-practices/faq/amg"}}');var a=t(74848),s=t(28453);const n={},i="Amazon Managed Service for Prometheus - FAQ",c={},h=[{value:"Which AWS Regions are supported currently and is it possible to collect metrics from other regions?",id:"which-aws-regions-are-supported-currently-and-is-it-possible-to-collect-metrics-from-other-regions",level:2},{value:"How long does it take to see metering and/or billing in Cost Explorer or CloudWatch as AWS billing charges?",id:"how-long-does-it-take-to-see-metering-andor-billing-in-cost-explorer-or-cloudwatch-as-aws-billing-charges",level:2},{value:"Can the Prometheus Service only scrape metrics from a cluster (EKS/ECS)?",id:"can-the-prometheus-service-only-scrape-metrics-from-a-cluster-eksecs",level:2},{value:"How do you connect Amazon Managed Service for Prometheus to Grafana? Is there any documentation?",id:"how-do-you-connect-amazon-managed-service-for-prometheus-to-grafana-is-there-any-documentation",level:2},{value:"What are the best practices to reduce the number of samples being sent to Amazon Managed Service for Prometheus?",id:"what-are-the-best-practices-to-reduce-the-number-of-samples-being-sent-to-amazon-managed-service-for-prometheus",level:2},{value:"How can I send CloudWatch metrics to Amazon Managed Service for Prometheus?",id:"how-can-i-send-cloudwatch-metrics-to-amazon-managed-service-for-prometheus",level:2},{value:"What version of Prometheus is Amazon Managed Service for Prometheus compatible with?",id:"what-version-of-prometheus-is-amazon-managed-service-for-prometheus-compatible-with",level:2},{value:"What collector do you recommend for ingesting metrics into Amazon Managed Service for Prometheus? Should I utilize Prometheus in Agent mode?",id:"what-collector-do-you-recommend-for-ingesting-metrics-into-amazon-managed-service-for-prometheus-should-i-utilize-prometheus-in-agent-mode",level:2},{value:"How does Amazon Managed Service for Prometheus\u2019 performance scale with the size of a workspace?",id:"how-does-amazon-managed-service-for-prometheus-performance-scale-with-the-size-of-a-workspace",level:2}];function m(e){const o={a:"a",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.header,{children:(0,a.jsx)(o.h1,{id:"amazon-managed-service-for-prometheus---faq",children:"Amazon Managed Service for Prometheus - FAQ"})}),"\n",(0,a.jsx)(o.h2,{id:"which-aws-regions-are-supported-currently-and-is-it-possible-to-collect-metrics-from-other-regions",children:"Which AWS Regions are supported currently and is it possible to collect metrics from other regions?"}),"\n",(0,a.jsxs)(o.p,{children:["See our ",(0,a.jsx)(o.a,{href:"https://docs.aws.amazon.com/prometheus/latest/userguide/what-is-Amazon-Managed-Service-Prometheus.html",children:"documentation"})," for updated list of Regions that we support. Please let us know which regions you would like so that we can better prioritize our existing Product Feature Requests (PFRs). You can always collect data from any regions and send it to a specific region that we support. Here\u2019s a blog for more details: ",(0,a.jsx)(o.a,{href:"https://aws.amazon.com/blogs/opensource/set-up-cross-region-metrics-collection-for-amazon-managed-service-for-prometheus-workspaces/",children:"Cross-region metrics collection for Amazon Managed Service for Prometheus"}),"."]}),"\n",(0,a.jsxs)(o.h2,{id:"how-long-does-it-take-to-see-metering-andor-billing-in-cost-explorer-or-cloudwatch-as-aws-billing-charges",children:["How long does it take to see metering and/or billing in Cost Explorer or ",(0,a.jsx)(o.a,{href:"https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/gs_monitor_estimated_charges_with_cloudwatch.html",children:"CloudWatch as AWS billing charges"}),"?"]}),"\n",(0,a.jsx)(o.p,{children:"We meter blocks of ingested metric samples as soon as they are uploaded to S3 every 2 hours. It can take up to 3 hours to see metering and charges reported for Amazon Managed Service for Prometheus."}),"\n",(0,a.jsx)(o.h2,{id:"can-the-prometheus-service-only-scrape-metrics-from-a-cluster-eksecs",children:"Can the Prometheus Service only scrape metrics from a cluster (EKS/ECS)?"}),"\n",(0,a.jsxs)(o.p,{children:["We apologize for the lack of documentation for other compute environments. You can use Prometheus server to scrape ",(0,a.jsx)(o.a,{href:"https://aws.amazon.com/blogs/opensource/using-amazon-managed-service-for-prometheus-to-monitor-ec2-environments/",children:"Prometheus metrics from EC2"})," and any other compute environments where you can install a Prometheus server today as long as you configure the remote write and setup the ",(0,a.jsx)(o.a,{href:"https://github.com/awslabs/aws-sigv4-proxy",children:"AWS SigV4 proxy"}),". The link to the ",(0,a.jsx)(o.a,{href:"https://aws.amazon.com/blogs/opensource/using-amazon-managed-service-for-prometheus-to-monitor-ec2-environments/",children:"EC2 blog"})," has a section \u201cRunning aws-sigv4-proxy\u201d that can show you how to run it. We do need to add more documentation to help our customers simplify how to run AWS SigV4 on other compute environments."]}),"\n",(0,a.jsx)(o.h2,{id:"how-do-you-connect-amazon-managed-service-for-prometheus-to-grafana-is-there-any-documentation",children:"How do you connect Amazon Managed Service for Prometheus to Grafana? Is there any documentation?"}),"\n",(0,a.jsxs)(o.p,{children:["We use the default ",(0,a.jsx)(o.a,{href:"https://grafana.com/docs/grafana/latest/datasources/prometheus/",children:"Prometheus data source available in Grafana"})," to query Amazon Managed Service for Prometheus using PromQL. Here\u2019s some documentation and a blog that will help you get started:"]}),"\n",(0,a.jsxs)(o.ol,{children:["\n",(0,a.jsx)(o.li,{children:(0,a.jsx)(o.a,{href:"https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-onboard-query.html",children:"Service docs"})}),"\n",(0,a.jsx)(o.li,{children:(0,a.jsx)(o.a,{href:"https://aws.amazon.com/blogs/opensource/setting-up-grafana-on-ec2-to-query-metrics-from-amazon-managed-service-for-prometheus/",children:"Grafana setup on EC2"})}),"\n"]}),"\n",(0,a.jsx)(o.h2,{id:"what-are-the-best-practices-to-reduce-the-number-of-samples-being-sent-to-amazon-managed-service-for-prometheus",children:"What are the best practices to reduce the number of samples being sent to Amazon Managed Service for Prometheus?"}),"\n",(0,a.jsx)(o.p,{children:"To reduce the number of samples being ingested into Amazon Managed Service for Prometheus, customers can extend their scrape interval (e.g., change from 30s to 1min) or decrease the number of series they are scraping. Changing the scrape interval will have a more dramatic impact on the number of samples than decreasing the number of series, with doubling the scrape interval halving the volume of samples ingested."}),"\n",(0,a.jsx)(o.h2,{id:"how-can-i-send-cloudwatch-metrics-to-amazon-managed-service-for-prometheus",children:"How can I send CloudWatch metrics to Amazon Managed Service for Prometheus?"}),"\n",(0,a.jsxs)(o.p,{children:["We recommend utilizing ",(0,a.jsx)(o.a,{href:"https://aws-observability.github.io/observability-best-practices/recipes/recipes/lambda-cw-metrics-go-amp/",children:"CloudWatch metric streams to send CloudWatch metrics to Amazon Managed Service for Prometheus"}),". Some possible shortcomings of this integration are,"]}),"\n",(0,a.jsxs)(o.ol,{children:["\n",(0,a.jsx)(o.li,{children:"A Lambda function is required to call the Amazon Managed Service for Prometheus APIs,"}),"\n",(0,a.jsx)(o.li,{children:"No ability to enrich CloudWatch metrics with metadata (e.g., with AWS tags) before ingesting them to Amazon Managed Service for Prometheus,"}),"\n",(0,a.jsx)(o.li,{children:"Metrics can only be filtered by namespace (not granular enough). As an alternative, customers can utilize Prometheus Exporters to send CloudWatch metrics data to Amazon Managed Service for Prometheus: (1) CloudWatch  Exporter: Java based scraping that uses CW ListMetrics and  GetMetricStatistics (GMS) APIs."}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.a,{href:"https://github.com/nerdswords/yet-another-cloudwatch-exporter",children:(0,a.jsx)(o.strong,{children:"Yet Another CloudWatch Exporter (YACE)"})})," is another option to get metrics from CloudWatch into Amazon Managed Service for Prometheus. This is a Go based tool that uses the CW ListMetrics, GetMetricData (GMD), and  GetMetricStatistics (GMS) APIs. Some disadvantages in using this could be that you will have to deploy the agent and have to manage the life-cycle yourself which has to be done thoughtfully."]}),"\n",(0,a.jsx)(o.h2,{id:"what-version-of-prometheus-is-amazon-managed-service-for-prometheus-compatible-with",children:"What version of Prometheus is Amazon Managed Service for Prometheus compatible with?"}),"\n",(0,a.jsxs)(o.p,{children:["Amazon Managed Service for Prometheus is compatible with ",(0,a.jsx)(o.a,{href:"https://github.com/prometheus/prometheus/blob/main/RELEASE.md",children:"Prometheus 2.x"}),". Amazon Managed Service for Prometheus is based on the open source ",(0,a.jsx)(o.a,{href:"https://cortexmetrics.io/",children:"CNCF Cortex project"})," as its data plane. Cortex strives to be 100% API compatible with Prometheus (under /prometheus/* and /api/prom/*). Amazon Managed Service for Prometheus supports Prometheus-compatible PromQL queries and Remote write metric ingestion and the Prometheus data model for existing metric types including Gauge, Counters, Summary, and Histogram. We do not currently expose ",(0,a.jsx)(o.a,{href:"https://cortexmetrics.io/docs/api/",children:"all Cortex APIs"}),". The list of compatible APIs we support can be ",(0,a.jsx)(o.a,{href:"https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-APIReference.html",children:"found here"}),". Customers can work with their account team to open new or influence existing Product Features Requests (PFRs) if we are missing any features required from Amazon Managed Service for Prometheus."]}),"\n",(0,a.jsx)(o.h2,{id:"what-collector-do-you-recommend-for-ingesting-metrics-into-amazon-managed-service-for-prometheus-should-i-utilize-prometheus-in-agent-mode",children:"What collector do you recommend for ingesting metrics into Amazon Managed Service for Prometheus? Should I utilize Prometheus in Agent mode?"}),"\n",(0,a.jsx)(o.p,{children:"We support the usage of Prometheus servers inclusive of agent mode, the OpenTelemetry agent, and the AWS Distro for OpenTelemetry agent as agents that customers can use to send metrics data to Amazon Managed Service for Prometheus. The AWS Distro for OpenTelemetry is a downstream distribution of the OpenTelemetry project packaged and secured by AWS. Any of the three should be fine, and you\u2019re welcome to pick whichever best suits your individual team\u2019s needs and preferences."}),"\n",(0,a.jsx)(o.h2,{id:"how-does-amazon-managed-service-for-prometheus-performance-scale-with-the-size-of-a-workspace",children:"How does Amazon Managed Service for Prometheus\u2019 performance scale with the size of a workspace?"}),"\n",(0,a.jsx)(o.p,{children:"Currently, Amazon Managed Service for Prometheus supports up to 200M active time series in a single workspace. When we announce a new max limit, we\u2019re ensuring that the performance and reliability properties of the service continue to be maintained across ingest and query. Queries across the same size dataset should not see a performance degradation regardless of the number of active series in a workspace."}),"\n",(0,a.jsxs)(o.p,{children:[(0,a.jsx)(o.strong,{children:"Product FAQ:"})," ",(0,a.jsx)(o.a,{href:"https://aws.amazon.com/prometheus/faqs/",children:"https://aws.amazon.com/prometheus/faqs/"})]})]})}function l(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,a.jsx)(o,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}},28453:(e,o,t)=>{t.d(o,{R:()=>n,x:()=>i});var r=t(96540);const a={},s=r.createContext(a);function n(e){const o=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function i(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:n(e.components),r.createElement(s.Provider,{value:o},e.children)}}}]);