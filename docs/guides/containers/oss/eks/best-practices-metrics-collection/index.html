<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/containers/oss/eks/best-practices-metrics-collection" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">EKS Observability : Essential Metrics | AWS Observability best practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-observability.github.io/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="EKS Observability : Essential Metrics | AWS Observability best practices"><meta data-rh="true" name="description" content="Monitoring is defined as a solution that allows infrastructure and application owners a way to see and understand both historical and current state of their systems, focused on gathering defined metrics or logs."><meta data-rh="true" property="og:description" content="Monitoring is defined as a solution that allows infrastructure and application owners a way to see and understand both historical and current state of their systems, focused on gathering defined metrics or logs."><link data-rh="true" rel="icon" href="/observability-best-practices/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-observability.github.io/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/ja/docs/guides/containers/oss/eks/best-practices-metrics-collection" hreflang="ja"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/observability-best-practices/blog/rss.xml" title="AWS Observability best practices RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/observability-best-practices/blog/atom.xml" title="AWS Observability best practices Atom Feed"><link rel="stylesheet" href="/observability-best-practices/assets/css/styles.2859e3e9.css">
<script src="/observability-best-practices/assets/js/runtime~main.240bb889.js" defer="defer"></script>
<script src="/observability-best-practices/assets/js/main.21eb589f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/observability-best-practices/"><div class="navbar__logo"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AWS Observability Best Practices</b></a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/observability-best-practices/docs/guides/">Guides</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/signals/alarms">Signals</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/tools/observability_accelerator">Tools</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/recipes/">Recipes</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/faq/adot">FAQ</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/patterns/multiaccount">Patterns</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/contributors">Contributors</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/observability-best-practices/ja/docs/guides/containers/oss/eks/best-practices-metrics-collection" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li></ul></div><a href="https://github.com/aws-observability/observability-best-practices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/observability-best-practices/docs/guides/">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/">Best practices overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/choosing-a-tracing-agent">Choosing a tracing agent</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/cost/kubecost">Cost</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/databases/rds-and-aurora">Databases</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/ec2-monitoring">EC2 Monitoring and Observability</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/containers/aws-native/ecs/best-practices-metrics-collection-1">ECS best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/observability-best-practices/docs/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">EKS best practices</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">AWS Native</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection">Open Source</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection">EKS Observability : Essential Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/containers/oss/eks/keda-amp-eks">Autoscaling applications using KEDA on AMP and EKS</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/serverless/aws-native/lambda-based-observability">Serverless best practices</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/hybrid-and-multicloud">Best practices for hybrid and multicloud</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/operational/adot-at-scale/operating-adot-collector">Operational</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/signal-collection/emf">Signal collection</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/partners/databricks">Partners</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/observability-maturity-model">AWS Observability Maturity Model</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/observability-best-practices/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">EKS best practices</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Open Source</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">EKS Observability : Essential Metrics</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>EKS Observability : Essential Metrics</h1>
<h1>Current Landscape</h1>
<p>Monitoring is defined as a solution that allows infrastructure and application owners a way to see and understand both historical and current state of their systems, focused on gathering defined metrics or logs.</p>
<p>Monitoring has evolved through the years.  We started working with debug and dump logs to debug and troubleshoot issues to having basic monitoring using command-line tools like syslogs, top etc, which progressed to being able to visualize them in a dashboard.  In the advent of cloud and increase in scale,  we are tracking more today that we have ever been.  The industry has shifted more into Observability, which is defined as a solution to allow infrastructure and application owners to actively troubleshoot and debug their systems.  With Observability focusing more on looking at patterns derived from the metrics.</p>
<h1>Metrics, why does it matter?</h1>
<p>Metrics are a series of numerical values that are kept in order with the time that they are created. They are used to track everything from the number of servers in your environment, their disk usage, number of requests they handle per second, or the latency in completing these requests.  Metrics are data that tell you how your systems are performing.  Whether you are running a small or large cluster, getting insights on your systems health and performance allows you to identify areas of improvement, ability to troubleshoot and trace an issue, as well as improve your workloads performance and efficiency as whole.  These changes can impact how much time and resources you spend on your cluster, which translates directly into cost.</p>
<h1>Metrics Collection</h1>
<p>Collecting metrics from an EKS cluster consists of <a href="https://aws-observability.github.io/observability-best-practices/recipes/telemetry/" target="_blank" rel="noopener noreferrer">three components</a> :</p>
<ol>
<li>Sources: where metrics come from like the ones listed in this guide.</li>
<li>Agents: Applications running in the EKS environment, often called an agent, which collects the metrics monitoring data and pushes this data to the second component. Some examples of this component are <a href="https://aws-otel.github.io/" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry (ADOT)</a> and <a href="https://aws-observability.github.io/observability-best-practices/tools/cloudwatch_agent/" target="_blank" rel="noopener noreferrer">CloudWatch Agent</a></li>
<li>Destinations: A monitoring data storage and analysis solution, this component is typically a data service that is optimized for <a href="https://aws-observability.github.io/observability-best-practices/signals/metrics/" target="_blank" rel="noopener noreferrer">time series formatted data</a>. Some examples of this component are <a href="https://aws.amazon.com/prometheus/" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus</a> and <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/deploy-container-insights-EKS.html" target="_blank" rel="noopener noreferrer">AWS Cloudwatch</a>.</li>
</ol>
<p>Note: In this section, configuration examples are links to relevant sections of the <a href="https://aws-observability.github.io/terraform-aws-observability-accelerator/" target="_blank" rel="noopener noreferrer">AWS Observability Accelerator</a>. This is to ensure you get up to date guidance and examples on EKS metrics collection implementations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="managed-open-source-solution">Managed Open Source Solution<a class="hash-link" aria-label="Direct link to Managed Open Source Solution" title="Direct link to Managed Open Source Solution" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#managed-open-source-solution">​</a></h2>
<p><a href="https://aws-otel.github.io/" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry (ADOT)</a> is a supported version of the <a href="https://opentelemetry.io/" target="_blank" rel="noopener noreferrer">OpenTelemetry</a> project that enables users to send correlated metrics and traces to various monitoring data collection solutions like <a href="https://aws.amazon.com/prometheus/" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus</a> and <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/deploy-container-insights-EKS.html" target="_blank" rel="noopener noreferrer">AWS Cloudwatch</a>. ADOT can be installed through <a href="https://docs.aws.amazon.com/eks/latest/userguide/eks-add-ons.html" target="_blank" rel="noopener noreferrer">EKS Managed Add-ons</a> on to an EKS cluster and configured to collect metrics (like the ones listed on this page) and workload traces. AWS has validated that the ADOT add-on is compatible with Amazon EKS, and it is regularly updated with the latest bug fixes and security patches. <a href="https://aws-observability.github.io/observability-best-practices/guides/operational/adot-at-scale/operating-adot-collector/" target="_blank" rel="noopener noreferrer">ADOT best practices and more information.</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="adot--amp">ADOT + AMP<a class="hash-link" aria-label="Direct link to ADOT + AMP" title="Direct link to ADOT + AMP" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#adot--amp">​</a></h2>
<p>The quickest way to get up and running with AWS Distro for OpenTelemetry (ADOT), Amazon Managed Service for Prometheus (AMP), and Amazon Managed Service for Grafana (AMG) is to utilize the <a href="https://aws-observability.github.io/terraform-aws-observability-accelerator/eks/" target="_blank" rel="noopener noreferrer">infrastructure monitoring example</a> from AWS Observability Accelerator. The accelerator examples deploy the tools and services in your environment with out of the box metrics collection, alerting rules and Grafana dashboards.</p>
<p>Please refer to the AWS documentation for additional information on installation, configuration and operation of <a href="https://docs.aws.amazon.com/eks/latest/userguide/opentelemetry.html" target="_blank" rel="noopener noreferrer">EKS Managed Add-on for ADOT</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sources">Sources<a class="hash-link" aria-label="Direct link to Sources" title="Direct link to Sources" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#sources">​</a></h3>
<p>EKS metrics are created from multiple locations at different layers of an overall solution. This is a table summarizing the metrics sources that are called out in essential metrics section.</p>
<table><thead><tr><th>Layer</th><th>Source</th><th>Tool</th><th>Installation and More info</th><th>Helm Chart</th></tr></thead><tbody><tr><td>Control Plane</td><td><em>api server endpoint</em>/metrics</td><td>N/A - api server exposes metrics in prometheus format directly</td><td><a href="https://docs.aws.amazon.com/eks/latest/userguide/prometheus.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/eks/latest/userguide/prometheus.html</a></td><td>N/A</td></tr><tr><td>Cluster State</td><td><em>kube-state-metrics-http-endpoint</em>:8080/metrics</td><td>kube-state-metrics</td><td><a href="https://github.com/kubernetes/kube-state-metrics#overview" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/kube-state-metrics#overview</a></td><td><a href="https://github.com/kubernetes/kube-state-metrics#helm-chart" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/kube-state-metrics#helm-chart</a></td></tr><tr><td>Kube Proxy</td><td><em>kube-proxy-http</em>:10249/metrics</td><td>N/A - kube proxy exposes metrics in prometheus format directly</td><td><a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/</a></td><td>N/A</td></tr><tr><td>VPC CNI</td><td><em>vpc-cni-metrics-helper</em>/metrics</td><td>cni-metrics-helper</td><td><a href="https://github.com/aws/amazon-vpc-cni-k8s/blob/master/cmd/cni-metrics-helper/README.md" target="_blank" rel="noopener noreferrer">https://github.com/aws/amazon-vpc-cni-k8s/blob/master/cmd/cni-metrics-helper/README.md</a></td><td><a href="https://github.com/aws/amazon-vpc-cni-k8s/tree/master/charts/cni-metrics-helper" target="_blank" rel="noopener noreferrer">https://github.com/aws/amazon-vpc-cni-k8s/tree/master/charts/cni-metrics-helper</a></td></tr><tr><td>Core DNS</td><td><em>core-dns</em>:9153/metrics</td><td>N/A - core DNS exposes metrics in prometheus format directly</td><td><a href="https://github.com/coredns/coredns/tree/master/plugin/metrics" target="_blank" rel="noopener noreferrer">https://github.com/coredns/coredns/tree/master/plugin/metrics</a></td><td>N/A</td></tr><tr><td>Node</td><td><em>prom-node-exporter-http</em>:9100/metrics</td><td>prom-node-exporter</td><td><a href="https://github.com/prometheus/node_exporter" target="_blank" rel="noopener noreferrer">https://github.com/prometheus/node_exporter</a></td><td></td></tr><tr><td><a href="https://prometheus.io/docs/guides/node-exporter/#node-exporter-metrics" target="_blank" rel="noopener noreferrer">https://prometheus.io/docs/guides/node-exporter/#node-exporter-metrics</a></td><td><a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/prometheus-node-exporter" target="_blank" rel="noopener noreferrer">https://github.com/prometheus-community/helm-charts/tree/main/charts/prometheus-node-exporter</a></td><td></td><td></td><td></td></tr><tr><td>Kubelet/Pod</td><td><em>kubelet</em>/metrics/cadvisor</td><td>kubelet or proxied through api server</td><td><a href="https://kubernetes.io/docs/concepts/cluster-administration/system-metrics/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/cluster-administration/system-metrics/</a></td><td>N/A</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="agent--aws-distro-for-opentelemetry">Agent : AWS Distro for OpenTelemetry<a class="hash-link" aria-label="Direct link to Agent : AWS Distro for OpenTelemetry" title="Direct link to Agent : AWS Distro for OpenTelemetry" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#agent--aws-distro-for-opentelemetry">​</a></h3>
<p>AWS recommends installation, configuration and operations of ADOT on your EKS cluster through the AWS EKS ADOT managed addon. This addon utilized the ADOT operator/collector custom resource model allowing you to deploy, configure and manage multiple ADOT collectors on your cluster. For detailed information on installation, advanced configuration and operations of this addon check out this <a href="https://aws-otel.github.io/docs/getting-started/adot-eks-add-on" target="_blank" rel="noopener noreferrer">documentation</a>.</p>
<p>Note: The AWS EKS ADOT managed addon web console can be used for <a href="https://docs.aws.amazon.com/eks/latest/userguide/deploy-collector-advanced-configuration.html" target="_blank" rel="noopener noreferrer">advanced configuration of the ADOT addon</a>.</p>
<p>There are two components to the ADOT collector configuration.</p>
<ol>
<li>The <a href="https://github.com/aws-observability/aws-otel-community/blob/master/sample-configs/operator/collector-config-amp.yaml" target="_blank" rel="noopener noreferrer">collector configuration</a> which includes collector deployment mode (deployment, daemonset, etc).</li>
<li>The <a href="https://opentelemetry.io/docs/collector/configuration/" target="_blank" rel="noopener noreferrer">OpenTelemetry Pipeline configuration</a> which includes what receivers, processors, and exporters are needed for metrics collection. Example configuration snippet:</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">config: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    extensions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sigv4auth:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        region: &lt;YOUR_AWS_REGION&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        service: &quot;aps&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    receivers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Scrape configuration for the Prometheus Receiver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # This is the same configuration used when Prometheus is installed using the community Helm chart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      #  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      prometheus:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          global:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            scrape_interval: 60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            scrape_timeout: 10s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          scrape_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - job_name: kubernetes-apiservers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            kubernetes_sd_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - role: endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            relabel_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - action: keep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              regex: default;kubernetes;https</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              source_labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - __meta_kubernetes_namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - __meta_kubernetes_service_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - __meta_kubernetes_endpoint_port_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            scheme: https</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tls_config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              insecure_skip_verify: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exporters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      prometheusremotewrite:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        endpoint: &lt;YOUR AMP WRITE ENDPOINT URL&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          authenticator: sigv4auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      logging:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loglevel: warn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    extensions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sigv4auth:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        region: &lt;YOUR_AWS_REGION&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        service: aps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      health_check:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pprof:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        endpoint: :1888</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      zpages:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        endpoint: :55679</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    processors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      batch/metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timeout: 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        send_batch_size: 500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      extensions: [pprof, zpages, health_check, sigv4auth]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pipelines:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          receivers: [prometheus]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          processors: [batch/metrics]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          exporters: [logging, prometheusremotewrite]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A complete best practices collector configuration, ADOT pipeline configuration and Prometheus scrape configuration can be found here as <a href="https://github.com/aws-observability/terraform-aws-observability-accelerator/blob/main/modules/eks-monitoring/otel-config/templates/opentelemetrycollector.yaml" target="_blank" rel="noopener noreferrer">a Helm Chart in the Observability Accelerator</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="destination-amazon-managed-service-for-prometheus">Destination: Amazon Managed Service for Prometheus<a class="hash-link" aria-label="Direct link to Destination: Amazon Managed Service for Prometheus" title="Direct link to Destination: Amazon Managed Service for Prometheus" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#destination-amazon-managed-service-for-prometheus">​</a></h3>
<p>The ADOT collector pipeline utilizes Prometheus Remote Write capabilities to export metrics to an AMP instance. Example configuration snippet, note the AMP WRITE ENDPOINT URL</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    exporters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      prometheusremotewrite:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        endpoint: &lt;YOUR AMP WRITE ENDPOINT URL&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          authenticator: sigv4auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      logging:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loglevel: warn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A complete best practices collector configuration, ADOT pipeline configuration and Prometheus scrape configuration can be found here as <a href="https://github.com/aws-observability/terraform-aws-observability-accelerator/blob/main/modules/eks-monitoring/otel-config/templates/opentelemetrycollector.yaml" target="_blank" rel="noopener noreferrer">a Helm Chart in the Observability Accelerator</a>.</p>
<p>Best practices on AMP configuration and usage is <a href="https://aws-observability.github.io/observability-best-practices/recipes/amp/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h1>What are the relevant metrics?</h1>
<p>Gone are the days where you have little metrics available, nowadays it is the opposite, there are hundreds of metrics available.  Being able to determine what are the relevant metrics is important towards building a system with an observability first mindset.</p>
<p>This guide outlines the different grouping of metrics available to you and explains which ones you should focus on as you build observability into your infrastructure and applications.  The list of metrics below are the list of metrics we recommend monitoring based on best practices.</p>
<p>The metrics listed in the following sections are in addition to the metrics highlighted in the <a href="https://github.com/aws-observability/terraform-aws-observability-accelerator/tree/main/modules/eks-monitoring" target="_blank" rel="noopener noreferrer">AWS Observability Accelerator Grafana Dashboards</a> and <a href="https://monitoring.mixins.dev/" target="_blank" rel="noopener noreferrer">Kube Prometheus Stack Dashboards</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="control-plane-metrics">Control Plane Metrics<a class="hash-link" aria-label="Direct link to Control Plane Metrics" title="Direct link to Control Plane Metrics" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#control-plane-metrics">​</a></h2>
<p>The Amazon EKS control plane is managed by AWS for you and runs in an account managed by AWS.  It consists of control plane nodes that run the Kubernetes components, such as etcd and the Kubernetes API server.   Kubernetes publishes various events to keep users informed of activities in the cluster, such as spinning up and tearing down pods, deployments, namespaces, and more.  The Amazon EKS control plane is a critical component that you need to track to make sure the core components are able function properly and perform the fundamental activities required by your cluster.</p>
<p>The Control Plane API Server exposes thousands of metrics, the table below lists the essential control plane metrics that we recommend monitoring.</p>
<table><thead><tr><th>Name</th><th>Metric</th><th>Description</th><th>Reason</th></tr></thead><tbody><tr><td>API Server total requests</td><td>apiserver_request_total</td><td>Counter of apiserver requests broken out for each verb, dry run value, group, version, resource, scope, component, and HTTP response code.</td><td></td></tr><tr><td>API Server latency</td><td>apiserver_request_duration_seconds</td><td>Response latency distribution in seconds for each verb, dry  run value, group, version, resource, subresource, scope, and component.</td><td></td></tr><tr><td>Request latency</td><td>rest_client_request_duration_seconds</td><td>Request latency in seconds. Broken down by verb and URL.</td><td></td></tr><tr><td>Total requests</td><td>rest_client_requests_total</td><td>Number of HTTP requests, partitioned by status code, method,  and host.</td><td></td></tr><tr><td>API Server request duration</td><td>apiserver_request_duration_seconds_bucket</td><td>Measures the latency for each request to the Kubernetes API server in seconds</td><td></td></tr><tr><td>API server request latency sum</td><td>apiserver_request_latencies_sum</td><td>Cumulative Counter which tracks total time taken by the K8 API server to process requests</td><td></td></tr><tr><td>API server registered watchers</td><td>apiserver_registered_watchers</td><td>The number of currently registered watchers for a given resource</td><td></td></tr><tr><td>API server number of objects</td><td>apiserver_storage_object</td><td>Number of stored objects at the time of last check split by kind.</td><td></td></tr><tr><td>Admission controller latency</td><td>apiserver_admission_controller_admission_duration_seconds</td><td>Admission controller latency histogram in seconds, identified  by name and broken out for each operation and API resource and type (validate  or admit).</td><td></td></tr><tr><td>Etcd latency</td><td>etcd_request_duration_seconds</td><td>Etcd request latency in seconds for each operation and object  type.</td><td></td></tr><tr><td>Etcd DB size</td><td>apiserver_storage_db_total_size_in_bytes</td><td>Etcd database size.</td><td>This helps you proactively monitor etcd database usage, and avoid overrunning the limit.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-state-metrics">Cluster State metrics<a class="hash-link" aria-label="Direct link to Cluster State metrics" title="Direct link to Cluster State metrics" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#cluster-state-metrics">​</a></h2>
<p>The Cluster State Metrics are generated by <code>kube-state-metrics</code> (KSM). KSM is a utility that runs as a pod in the cluster, listening to the Kubernetes API Server, providing you insights into your cluster state and Kubernetes objects in your cluster as Prometheus metrics.  KSM will need to be <a href="https://github.com/kubernetes/kube-state-metrics" target="_blank" rel="noopener noreferrer">installed</a> before these metrics are available.  These metrics are used by Kubernetes to effectively do pod scheduling, and is focused on the health of various objects inside, such as deployments, replica sets, nodes and pods.  Cluster state metrics expose pod information on status, capacity and availability.  Its essential to keep track on how your cluster is performing on scheduling tasks for your cluster so you can keep track performance, get ahead of issues and monitor the health of your cluster. There are about X number of exposed Cluster State Metrics, the table below lists the essential metrics that should be tracked.</p>
<table><thead><tr><th>Name</th><th>Metric</th><th>Description</th></tr></thead><tbody><tr><td>Node status</td><td>kube_node_status_condition</td><td>Current health status of the node. Returns a set of node conditions and <code>true</code>, <code>false</code>, or <code>unknown</code> for each</td></tr><tr><td>Desired pods</td><td>kube_deployment_spec_replicas or kube_daemonset_status_desired_number_scheduled</td><td>Number of pods specified for a Deployment or DaemonSet</td></tr><tr><td>Current pods</td><td>kube_deployment_status_replicas or kube_daemonset_status_current_number_scheduled</td><td>Number of pods currently running in a Deployment or DaemonSet</td></tr><tr><td>Pod capacity</td><td>kube_node_status_capacity_pods</td><td>Maximum pods allowed on the node</td></tr><tr><td>Available pods</td><td>kube_deployment_status_replicas_available or kube_daemonset_status_number_available</td><td>Number of pods currently available for a Deployment or DaemonSet</td></tr><tr><td>Unavailable pods</td><td>kube_deployment_status_replicas_unavailable or kube_daemonset_status_number_unavailable</td><td>Number of pods currently not available for a Deployment or DaemonSet</td></tr><tr><td>Pod readiness</td><td>kube_pod_status_ready</td><td>If a pod is ready to serve client requests</td></tr><tr><td>Pod status</td><td>kube_pod_status_phase</td><td>Current status of the pod; value would be pending/running/succeeded/failed/unknown</td></tr><tr><td>Pod waiting reason</td><td>kube_pod_container_status_waiting_reason</td><td>Reason a container is in a waiting state</td></tr><tr><td>Pod termination status</td><td>kube_pod_container_status_terminated</td><td>Whether the container is currently in a terminated state or not</td></tr><tr><td>Pods pending scheduling</td><td>pending_pods</td><td>Number of pods awaiting node assignment</td></tr><tr><td>Pod scheduling attempts</td><td>pod_scheduling_attempts</td><td>Number of attempts made to schedule pods</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-add-on-metrics">Cluster Add-on Metrics<a class="hash-link" aria-label="Direct link to Cluster Add-on Metrics" title="Direct link to Cluster Add-on Metrics" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#cluster-add-on-metrics">​</a></h2>
<p>Cluster add-on is software that provides supporting operational capabilities to Kubernetes applications.  This includes software like observability agents or Kubernetes drives that allow the cluster to interact with underlying AWS resources for networking, compute and storage.   Add-on software is typically built and maintained by the Kubernetes community, cloud providers like AWS, or third-party vendors. Amazon EKS automatically installs self-managed add-ons such as the Amazon VPC CNI plugin for Kubernetes, <code>kube-proxy</code>, and CoreDNS for every cluster.</p>
<p>These Cluster add-ons provide operational support in different areas like networking, domain name resolution, etc.  They provide you with insights on how the critical supporting infrastructure and components are operating. Tracking add-on metrics are important to understand your clusters operational health.</p>
<p>Below are the essential add-ons that you should consider monitoring along with their essential metrics.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="amazon-vpc-cni-plugin">Amazon VPC CNI Plugin<a class="hash-link" aria-label="Direct link to Amazon VPC CNI Plugin" title="Direct link to Amazon VPC CNI Plugin" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#amazon-vpc-cni-plugin">​</a></h2>
<p>Amazon EKS implements cluster networking through the Amazon VPC Container Network Interface (VPC CNI) plugin.  The CNI plugin allows Kubernetes Pods to have the same IP address ad they do on the VPC network.  More specifically, all containers inside the Pod share a network namespace, and they can communicate with each-other using local ports. The VPC CNI add-on enables you to continuously ensure the security and stability of your Amazon EKS clusters and decrease the amount of effort required to install, configure and update add-ons.</p>
<p>VPC CNI add-on metrics are exposed by the CNI Metrics Helper. Monitoring the IP address allocation is fundamental to ensuring a healthy cluster and avoiding IP exhaustion issues. <a href="https://aws.github.io/aws-eks-best-practices/networking/vpc-cni/#monitor-ip-address-inventory" target="_blank" rel="noopener noreferrer">Here is the latest networking best practices and VPC CNI metrics to collect and monitor</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="coredns-metrics">CoreDNS Metrics<a class="hash-link" aria-label="Direct link to CoreDNS Metrics" title="Direct link to CoreDNS Metrics" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#coredns-metrics">​</a></h2>
<p>CoreDNS is a flexible, extensible DNS server that can serve as the Kubernetes cluster DNS.  The CoreDNS pods provide name resolution for all pods in the cluster.  Running DNS intensive workloads can sometimes experience intermittent CoreDNS failures due to DNS throttling, and this can impact applications.</p>
<p>Checkout the latest best practices for tracking key <a href="https://aws.github.io/aws-eks-best-practices/reliability/docs/dataplane/#monitor-coredns-metrics" target="_blank" rel="noopener noreferrer">CoreDNS performance metrics here</a> and <a href="https://aws.github.io/aws-eks-best-practices/networking/monitoring/" target="_blank" rel="noopener noreferrer">Monitoring CoreDNS traffic for DNS throttling issues</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="podcontainer-metrics">Pod/Container Metrics<a class="hash-link" aria-label="Direct link to Pod/Container Metrics" title="Direct link to Pod/Container Metrics" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#podcontainer-metrics">​</a></h2>
<p>Tracking usage in across all layers of you application is important, these includes taking a closer look at your nodes and pods running inside your cluster. Out of all the metrics available at the pod dimension, this list of metrics are of practical use for you to understand the state of the workloads running on your cluster. Tracking CPU, memory and network usage allows for diagnosing and troubleshooting application related issues. Tracking your workload metrics provide you insights into your resource utilization to right size your workloads running on EKS.</p>
<table><thead><tr><th>Metric</th><th>Example PromQL Query</th><th>Dimension</th></tr></thead><tbody><tr><td>Number of running pods per namspace</td><td>count by(namespace) (kube_pod_info)</td><td>Per Cluster by Namespace</td></tr><tr><td>CPU usage per container per pod</td><td>sum(rate(container_cpu_usage_seconds_total{container!=&quot;&quot;}[5m])) by (namespace, pod)</td><td>Per Cluster by Namespace by Pod</td></tr><tr><td>Memory utilization per pod</td><td>sum(container_memory_usage_bytes{container!=&quot;&quot;}) by (namespace, pod)</td><td>Per Cluster by Namespace by Pod</td></tr><tr><td>Network Received Bytes per pod</td><td>sum by(pod) (rate(container_network_receive_bytes_total[5m]))</td><td>Per Cluster by Namespace by Pod</td></tr><tr><td>Network Transmitted Bytes per pod</td><td>sum by(pod) (rate(container_network_transmit_bytes_total[5m]))</td><td>Per Cluster by Namespace by Pod</td></tr><tr><td>The number of container restarts per container</td><td>increase(kube_pod_container_status_restarts_total[15m]) &gt; 3</td><td>Per Cluster by Namespace by Pod</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="node-metrics">Node Metrics<a class="hash-link" aria-label="Direct link to Node Metrics" title="Direct link to Node Metrics" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#node-metrics">​</a></h2>
<p>Kube State Metrics and Prometheus node exporter gathers metric statistics on the nodes in your cluster.  Tracking your nodes status, cpu usage, memory, filesystem and traffic is important to understand your node utilization.  Understanding how your nodes resources are being utilized is important for properly selecting instance types and storage to effectively the types of workloads you expect to run on your cluster.  The metrics below are some of the essential metrics that you should be tracking.</p>
<table><thead><tr><th>Metric</th><th>Example PromQL Query</th><th>Dimension</th></tr></thead><tbody><tr><td>Node CPU Utilization</td><td>sum(rate(container_cpu_usage_seconds_total{container!=&quot;&quot;}[5m])) by (node)</td><td>Per Cluster by Node</td></tr><tr><td>Node Memory Utilization</td><td>sum(container_memory_usage_bytes{container!=&quot;&quot;}) by (node)</td><td>Per Cluster by Node</td></tr><tr><td>Node Network Total Bytes</td><td>sum by (instance) (rate(node_network_receive_bytes_total[3m]))+sum by (instance) (rate(node_network_transmit_bytes_total[3m]))</td><td>Per Cluster by Node</td></tr><tr><td>Node CPU Reserved Capacity</td><td>sum(kube_node_status_capacity{cluster!=&quot;&quot;}) by (node)</td><td>Per Cluster by Node</td></tr><tr><td>Number of Running Pods per Node</td><td>sum(kubelet_running_pods) by (instance)</td><td>Per Cluster by Node</td></tr><tr><td>Cluster CPU Utilization</td><td>sum(rate(node_cpu_seconds_total{mode!=&quot;idle&quot;,mode!=&quot;iowait&quot;,mode!=&quot;steal&quot;}[5m]))</td><td>Per Cluster</td></tr><tr><td>Cluster Memory Utilization</td><td>1 - sum(:node_memory_MemAvailable_bytes<!-- -->:sum<!-- -->{cluster=&quot;&quot;}) / sum(node_memory_MemTotal_bytes\job=&quot;node-exporter&quot;,cluster=&quot;&quot;})</td><td>Per Cluster</td></tr><tr><td>Cluster Network Total Bytes</td><td>sum(rate(node_network_receive_bytes_total[3m]))+sum(rate(node_network_transmit_bytes_total[3m]))</td><td>Per Cluster</td></tr><tr><td>Number of Running Pods</td><td>sum(kubelet_running_pod_count{cluster=&quot;&quot;})</td><td>Per Cluster</td></tr><tr><td>Number of Running Containers</td><td>sum(kubelet_running_container_count{cluster=&quot;&quot;})</td><td>Per Cluster</td></tr><tr><td>Cluster CPU Limit</td><td>sum(kube_node_status_allocatable{resource=&quot;cpu&quot;})</td><td>Per Cluster</td></tr><tr><td>Cluster Memory Limit</td><td>sum(kube_node_status_allocatable{resource=&quot;memory&quot;})</td><td>Per Cluster</td></tr><tr><td>Cluster Node Count</td><td>count(kube_node_info) OR sum(kubelet_node_name{cluster=&quot;&quot;})</td><td>Per Cluster</td></tr></tbody></table>
<h1>Additional Resources</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="aws-services">AWS Services<a class="hash-link" aria-label="Direct link to AWS Services" title="Direct link to AWS Services" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#aws-services">​</a></h2>
<p><a href="https://aws-otel.github.io/" target="_blank" rel="noopener noreferrer">https://aws-otel.github.io/</a></p>
<p><a href="https://aws.amazon.com/prometheus" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/prometheus</a></p>
<p><a href="https://aws.amazon.com/cloudwatch/features/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/cloudwatch/features/</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="blogs">Blogs<a class="hash-link" aria-label="Direct link to Blogs" title="Direct link to Blogs" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#blogs">​</a></h2>
<p><a href="https://aws.amazon.com/blogs/containers/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/blogs/containers/</a></p>
<p><a href="https://aws.amazon.com/blogs/containers/metrics-and-traces-collection-using-amazon-eks-add-ons-for-aws-distro-for-opentelemetry/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/blogs/containers/metrics-and-traces-collection-using-amazon-eks-add-ons-for-aws-distro-for-opentelemetry/</a></p>
<p><a href="https://aws.amazon.com/blogs/containers/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/blogs/containers/</a></p>
<p><a href="https://aws.amazon.com/blogs/containers/introducing-amazon-cloudwatch-container-insights-for-amazon-eks-fargate-using-aws-distro-for-opentelemetry/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/blogs/containers/introducing-amazon-cloudwatch-container-insights-for-amazon-eks-fargate-using-aws-distro-for-opentelemetry/</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="infrastructure-as-code-resources">Infrastructure as Code Resources<a class="hash-link" aria-label="Direct link to Infrastructure as Code Resources" title="Direct link to Infrastructure as Code Resources" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#infrastructure-as-code-resources">​</a></h2>
<p><a href="https://github.com/aws-observability/terraform-aws-observability-accelerator" target="_blank" rel="noopener noreferrer">https://github.com/aws-observability/terraform-aws-observability-accelerator</a></p>
<p><a href="https://github.com/aws-ia/terraform-aws-eks-blueprints" target="_blank" rel="noopener noreferrer">https://github.com/aws-ia/terraform-aws-eks-blueprints</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/aws-observability/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/observability-best-practices/docs/guides/containers/aws-native/eks/container-tracing-with-aws-xray"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Container Tracing with AWS X-Ray</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/observability-best-practices/docs/guides/containers/oss/eks/keda-amp-eks"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Autoscaling applications using KEDA on AMP and EKS</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#managed-open-source-solution">Managed Open Source Solution</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#adot--amp">ADOT + AMP</a><ul><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#sources">Sources</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#agent--aws-distro-for-opentelemetry">Agent : AWS Distro for OpenTelemetry</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#destination-amazon-managed-service-for-prometheus">Destination: Amazon Managed Service for Prometheus</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#control-plane-metrics">Control Plane Metrics</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#cluster-state-metrics">Cluster State metrics</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#cluster-add-on-metrics">Cluster Add-on Metrics</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#amazon-vpc-cni-plugin">Amazon VPC CNI Plugin</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#coredns-metrics">CoreDNS Metrics</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#podcontainer-metrics">Pod/Container Metrics</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#node-metrics">Node Metrics</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#aws-services">AWS Services</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#blogs">Blogs</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/best-practices-metrics-collection#infrastructure-as-code-resources">Infrastructure as Code Resources</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2024.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>