<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/containers/oss/eks/resource-optimization" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Resource Optimization best practices for Kubernetes workloads | AWS Observability best practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-observability.github.io/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Resource Optimization best practices for Kubernetes workloads | AWS Observability best practices"><meta data-rh="true" name="description" content="Kubernetes adoption continues to accelerate, as many move to microservice based architectures. A lot of the initial focus was on designing and building new cloud native architectures to support the applications. As environments grow, we are starting to see the focus to optimize resource allocation from customers. Resource optimization is the second most important  question operations team ask for after security."><meta data-rh="true" property="og:description" content="Kubernetes adoption continues to accelerate, as many move to microservice based architectures. A lot of the initial focus was on designing and building new cloud native architectures to support the applications. As environments grow, we are starting to see the focus to optimize resource allocation from customers. Resource optimization is the second most important  question operations team ask for after security."><link data-rh="true" rel="icon" href="/observability-best-practices/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-observability.github.io/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/ja/docs/guides/containers/oss/eks/resource-optimization" hreflang="ja"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/observability-best-practices/blog/rss.xml" title="AWS Observability best practices RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/observability-best-practices/blog/atom.xml" title="AWS Observability best practices Atom Feed"><link rel="stylesheet" href="/observability-best-practices/assets/css/styles.2859e3e9.css">
<script src="/observability-best-practices/assets/js/runtime~main.240bb889.js" defer="defer"></script>
<script src="/observability-best-practices/assets/js/main.21eb589f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/observability-best-practices/"><div class="navbar__logo"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AWS Observability Best Practices</b></a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/home">Home</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/guides/">Guides</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/signals/alarms">Signals</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/tools/observability_accelerator">Tools</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/recipes/">Recipes</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/faq/adot">FAQ</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/patterns/multiaccount">Patterns</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/contributors">Contributors</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/observability-best-practices/ja/docs/guides/containers/oss/eks/resource-optimization" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li></ul></div><a href="https://github.com/aws-observability/observability-best-practices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Resource Optimization best practices for Kubernetes workloads</h1>
<p>Kubernetes adoption continues to accelerate, as many move to microservice based architectures. A lot of the initial focus was on designing and building new cloud native architectures to support the applications. As environments grow, we are starting to see the focus to optimize resource allocation from customers. Resource optimization is the second most important  question operations team ask for after security.
Let&#x27;s talk about guidance on how to optimize resource allocation and right-size applications on Kubernetes environments. This includes applications running on Amazon EKS deployed with managed node groups, self-managed node groups, and AWS Fargate.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reasons-for-right-sizing-applications-on-kubernetes">Reasons for Right-sizing applications on Kubernetes<a class="hash-link" aria-label="Direct link to Reasons for Right-sizing applications on Kubernetes" title="Direct link to Reasons for Right-sizing applications on Kubernetes" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#reasons-for-right-sizing-applications-on-kubernetes">​</a></h2>
<p>In Kubernetes, resource right-sizing is done through setting resource specifications on applications. These settings directly impact:</p>
<ul>
<li>Performance — Kubernetes applications will arbitrarily compete for resources without proper resource specifications, This can adversely impact application performance.</li>
<li>Cost Optimization — Applications deployed with oversized resource specifications will result in increased costs and under utilized infrastructure.</li>
<li>Autoscaling — The Kubernetes Cluster Autoscaler and Horizontal Pod Autoscaling require resource specifications to function.</li>
</ul>
<p>The most common resource specifications in Kubernetes are for <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits" target="_blank" rel="noopener noreferrer">CPU and memory requests and limits</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requests-and-limits">Requests and Limits<a class="hash-link" aria-label="Direct link to Requests and Limits" title="Direct link to Requests and Limits" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#requests-and-limits">​</a></h2>
<p>Containerized applications are deployed on Kubernetes as Pods. CPU and memory requests and limits are an optional part of the Pod definition. CPU is specified in units of <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-cpu" target="_blank" rel="noopener noreferrer">Kubernetes CPUs</a> while memory is specified in bytes, usually as <a href="https://simple.wikipedia.org/wiki/Mebibyte" target="_blank" rel="noopener noreferrer">mebibytes (Mi)</a>.</p>
<p>Request and limits each serve different functions in Kubernetes and impact scheduling and resource enforcement differently.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="recommendations">Recommendations<a class="hash-link" aria-label="Direct link to Recommendations" title="Direct link to Recommendations" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#recommendations">​</a></h2>
<p>An application owner needs to choose the &quot;right&quot; values  for their CPU and memory resource requests. An ideal way  is to load test the application in a development environment and measure resource usage using observability tooling. While that might make sense for your organization’s most critical applications, it’s likely not feasible for every containerized application deployed in your cluster. Let&#x27;s talk about the tools that can help us optimize and right-size the workloads:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vertical-pod-autoscaler-vpa">Vertical Pod Autoscaler (VPA)<a class="hash-link" aria-label="Direct link to Vertical Pod Autoscaler (VPA)" title="Direct link to Vertical Pod Autoscaler (VPA)" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#vertical-pod-autoscaler-vpa">​</a></h3>
<p><a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler" target="_blank" rel="noopener noreferrer">VPA</a> is Kubernetes sub-project owned by the Autoscaling special interest group (SIG). It’s designed to automatically set Pod requests based on observed application performance. VPA collects resource usage using the <a href="https://github.com/kubernetes-sigs/metrics-server" target="_blank" rel="noopener noreferrer">Kubernetes Metric Server</a> by default but can be optionally configured to use Prometheus as a data source.
VPA has a recommendation engine  that measures application performance and makes sizing recommendations. The VPA recommendation engine can be deployed stand-alone so VPA will not perform any autoscaling actions. It’s configured by creating a VerticalPodAutoscaler custom resource for each application and VPA updates the object’s status field with resource sizing recommendations.
Creating VerticalPodAutoscaler objects for every application in your cluster and trying to read and interpret the JSON results is challenging at scale. <a href="https://github.com/FairwindsOps/goldilocks" target="_blank" rel="noopener noreferrer">Goldilocks</a> is an open source project that makes this easy.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="goldilocks">Goldilocks<a class="hash-link" aria-label="Direct link to Goldilocks" title="Direct link to Goldilocks" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#goldilocks">​</a></h3>
<p>Goldilocks is an open source project from Fairwinds that is designed to help organizations get their Kubernetes application resource requests “just right&quot;. The default configuration of Goldilocks is an opt-in model. You choose which workloads are monitored by adding the goldilocks.fairwinds.com/enabled: true label to a namespace.</p>
<p><img decoding="async" loading="lazy" alt="Goldilocks-Architecture" src="/observability-best-practices/assets/images/goldilocks-architecture-879084217dd0813e22ad3fda88f1b9a0.png" width="1291" height="772" class="img_ev3q"></p>
<p>The Metrics Server collects resource metrics from the Kubelet running on worker nodes and exposes them through Metrics API for use by the Vertical Pod Autoscaler. The Goldilocks controller watches for namespaces with the goldilocks.fairwinds.com/enabled: true label and creates VerticalPodAutoscaler objects for each workload in those namespaces.</p>
<p>To enable namespaces for resource recommendation, run the below command:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create ns javajmx-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl label ns javajmx-sample goldilocks.fairwinds.com/enabled=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To deploy goldilocks in the Amazon EKS Cluster, run the below command:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add fairwinds-stable https://charts.fairwinds.com/stable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade --install goldilocks fairwinds-stable/goldilocks --namespace goldilocks --create-namespace --set vpa.enabled=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Goldilocks-dashboard will expose the dashboard in the port 8080 and we can access it to get the resource recommendation.  Let’s run the below command to access the dashboard:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n goldilocks port-forward svc/goldilocks-dashboard 8080:80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then open your browser to <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080</a></p>
<p><img decoding="async" loading="lazy" alt="Goldilocks-Dashboard" src="/observability-best-practices/assets/images/goldilocks-dashboard-94a18829a8f83117496d2bc74b32909f.png" width="1128" height="326" class="img_ev3q"></p>
<p>Let’s analyze the sample namespace to see the recommendations provided by Goldilocks. We should be able to see the recommendations for the deployment.
<img decoding="async" loading="lazy" alt="Goldilocks-Recommendation" src="/observability-best-practices/assets/images/goldilocks-recommendation-aa45dfaf808e1d9276f2f607d0064e56.png" width="1569" height="776" class="img_ev3q"></p>
<p>We could see the request &amp; limit recommendations for the javajmx-sample workload. The Current column under each Quality of Service (Qos) indicates the currently configured CPU and Memory request and limits. The Guranteed and Burstable column indicates the recommended CPU and Memory request limits for the respective QoS.</p>
<p>We can clearly notice that we have over provisioned the resources and goldilocks has made the recommendations to optimize the CPU and Memory request. The CPU request and limits has been recommended to be 15m and 15m compared to 100m and 300m for Guranteed QoS and Memory request and limits to be 105M and 105M, compared to 180Mi and 300 Mi.
You can simply copy the respective manifest file for the QoS class, they are interested in and deploy the workloads which is right-sized and optimized.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="understand-throttling-using-cadvisor-metric-and-configuring-the-resource-appropriately">Understand throttling using cAdvisor metric and configuring the resource appropriately<a class="hash-link" aria-label="Direct link to Understand throttling using cAdvisor metric and configuring the resource appropriately" title="Direct link to Understand throttling using cAdvisor metric and configuring the resource appropriately" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#understand-throttling-using-cadvisor-metric-and-configuring-the-resource-appropriately">​</a></h3>
<p>When we configure limits, we are telling the Linux node how long a specific containerized application can run during a specific period of time. We do this to protect the rest of the workloads on a node from a wayward set of processes from taking an unreasonable amount of CPU cycles. We are not defining several physical “cores” sitting on a motherboard; however, we are configuring how much time a grouping of processes or threads in a single container can run before we want to temporarily pause the container to avoid overwhelming other applications.</p>
<p>There is a handy cAdvisor metrics called <code>container_cpu_cfs_throttled_seconds_total</code> which adds up all the throttled 5 ms slices and gives us an idea how far over the quota the process is. This metric is in seconds, so we divide the value by 10 to get 100 ms, which is the real period of time associated with the container.</p>
<p>PromQl query to understand the top three pods CPU usage over a 100 ms time.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">topk(3, max by (pod, container)(rate(container_cpu_usage_seconds_total{image!=&quot;&quot;, instance=&quot;$instance&quot;}[$__rate_interval]))) / 10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A value of 400 ms of vCPU usage is observed.</p>
<p><img decoding="async" loading="lazy" alt="Throttled-Period" src="/observability-best-practices/assets/images/throttled-period-bf33f6b78e32c8b630b1c70e67b02d92.png" width="1000" height="198" class="img_ev3q"></p>
<p>PromQL gives us a per second throttling, with 10 periods in a second. To get the per period throttling, we divide by 10. If we want to know how much to increase the limits setting, then we can multiple by 10 (e.g., 400 ms * 10 = 4000 m).</p>
<p>While the above tools provide ways to identify opportunities for resource optimization, applications team should spend time in identifying whether a given application is CPU / Memory intensive and allocate resources to prevent throttling / over-provisioning.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/aws-observability/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#reasons-for-right-sizing-applications-on-kubernetes">Reasons for Right-sizing applications on Kubernetes</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#requests-and-limits">Requests and Limits</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#recommendations">Recommendations</a><ul><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#vertical-pod-autoscaler-vpa">Vertical Pod Autoscaler (VPA)</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#goldilocks">Goldilocks</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/containers/oss/eks/resource-optimization#understand-throttling-using-cadvisor-metric-and-configuring-the-resource-appropriately">Understand throttling using cAdvisor metric and configuring the resource appropriately</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2024.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>