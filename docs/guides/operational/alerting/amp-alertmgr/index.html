<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/operational/alerting/amp-alertmgr" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Amazon Managed Service for Prometheus Alert Manager | AWS Observability best practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-observability.github.io/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Amazon Managed Service for Prometheus Alert Manager | AWS Observability best practices"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/observability-best-practices/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-observability.github.io/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/ja/docs/guides/operational/alerting/amp-alertmgr" hreflang="ja"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/observability-best-practices/blog/rss.xml" title="AWS Observability best practices RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/observability-best-practices/blog/atom.xml" title="AWS Observability best practices Atom Feed"><link rel="stylesheet" href="/observability-best-practices/assets/css/styles.2859e3e9.css">
<script src="/observability-best-practices/assets/js/runtime~main.240bb889.js" defer="defer"></script>
<script src="/observability-best-practices/assets/js/main.21eb589f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/observability-best-practices/"><div class="navbar__logo"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AWS Observability Best Practices</b></a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/observability-best-practices/docs/guides/">Guides</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/signals/alarms">Signals</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/tools/observability_accelerator">Tools</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/recipes/">Recipes</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/faq/adot">FAQ</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/patterns/multiaccount">Patterns</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/contributors">Contributors</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/observability-best-practices/ja/docs/guides/operational/alerting/amp-alertmgr" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li></ul></div><a href="https://github.com/aws-observability/observability-best-practices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/observability-best-practices/docs/guides/">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/">Best practices overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/choosing-a-tracing-agent">Choosing a tracing agent</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/cost/kubecost">Cost</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/databases/rds-and-aurora">Databases</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/ec2-monitoring">EC2 Monitoring and Observability</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/containers/aws-native/ecs/best-practices-metrics-collection-1">ECS best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">EKS best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/serverless/aws-native/lambda-based-observability">Serverless best practices</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/hybrid-and-multicloud">Best practices for hybrid and multicloud</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/observability-best-practices/docs/guides/operational/adot-at-scale/operating-adot-collector">Operational</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/operational/adot-at-scale/operating-adot-collector">ADOT Collector</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/operational/business/monitoring-for-business-outcomes">Why should you do observability?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/operational/business/sla-percentile">Percentiles are important</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/operational/business/key-performance-indicators">key-performance-indicators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/rust-custom-metrics/">Creating Custom Metrics with the AWS Rust SDK</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr">Alerting</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr">Amazon Managed Service for Prometheus Alert Manager</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/operational/gitops-with-amg/">GitOps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/tools/cloudwatch-dashboard">Dashboards</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/signal-collection/emf">Signal collection</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/partners/databricks">Partners</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/observability-maturity-model">AWS Observability Maturity Model</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/observability-best-practices/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Operational</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Alerting</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Amazon Managed Service for Prometheus Alert Manager</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Amazon Managed Service for Prometheus Alert Manager</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#introduction">​</a></h2>
<p><a href="https://aws.amazon.com/prometheus/" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus</a> (AMP) supports two types of rules namely &#x27;<strong>Recording rules</strong>&#x27; and &#x27;<strong>Alerting rules</strong>&#x27;, which can be imported from your existing Prometheus server and are evaluated at regular intervals.</p>
<p><a href="https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/" target="_blank" rel="noopener noreferrer">Alerting rules</a> allow customers to define alert conditions based on <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/" target="_blank" rel="noopener noreferrer">PromQL</a> and a threshold. When the value of the alerting rule exceeds threshold, a notification is sent to Alert manager in Amazon Managed Service for Prometheus which provides similar functionality to alert manager in standalone Prometheus. An alert is the outcome of an alerting rule in Prometheus when it is active.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="alerting-rules-file">Alerting Rules File<a class="hash-link" aria-label="Direct link to Alerting Rules File" title="Direct link to Alerting Rules File" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#alerting-rules-file">​</a></h2>
<p>An Alerting rule in Amazon Managed Service for Prometheus is defined by a rules file in YAML format, which follows the same format as a rules file in standalone Prometheus. Customers can have multiple rules files in an Amazon Managed Service for Prometheus workspace. A workspace is a logical space dedicated to the storage and querying of Prometheus metrics.</p>
<p>A rules file typically has the following fields:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - alert:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  expr:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  annotations:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Groups: A collection of rules that are run sequentially at a regular interval</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name: Name of the group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Rules: The rules in a group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Alert: Name of the alert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Expr: The expression for the alert to trigger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For: Minimum duration for an alert’s expression to be exceeding threshold before updating to a firing status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Labels: Any additional labels attached to the alert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotations: Contextual details such as a description or link</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A sample rule file looks like below</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - record: metric:recording_rule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      expr: avg(rate(container_cpu_usage_seconds_total[5m]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: alert-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - alert: metric:alerting_rule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      expr: avg(rate(container_cpu_usage_seconds_total[5m])) &gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      for: 2m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="alert-manager-configuration-file">Alert Manager Configuration File<a class="hash-link" aria-label="Direct link to Alert Manager Configuration File" title="Direct link to Alert Manager Configuration File" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#alert-manager-configuration-file">​</a></h2>
<p>The Amazon Managed Service for Prometheus Alert Manager uses a configuration file in YAML format to set up the alerts (for the receiving service) that is in the same structure as an alert manager config file in standalone Prometheus. The configuration file consists of two key sections for alert manager and templating</p>
<ol>
<li>
<p><a href="https://prometheus.io/docs/prometheus/latest/configuration/template_reference/" target="_blank" rel="noopener noreferrer">template_files</a>, contains the templates of annotations and labels in alerts exposed as the <code>$value</code>, <code>$labels</code>, <code>$externalLabels</code>, and <code>$externalURL</code> variables for convenience. The <code>$labels</code> variable holds the label key/value pairs of an alert instance. The configured external labels can be accessed via the <code>$externalLabels</code> variable. The <code>$value</code> variable holds the evaluated value of an alert instance. <code>.Value</code>, <code>.Labels</code>, <code>.ExternalLabels</code>, and <code>.ExternalURL</code> contain the alert value, the alert labels, the globally configured external labels, and the external URL (configured with <code>--web.external-url</code>) respectively.</p>
</li>
<li>
<p><a href="https://prometheus.io/docs/alerting/latest/configuration/" target="_blank" rel="noopener noreferrer">alertmanager_config</a>, contains the alert manager configuration that uses the same structure as an alert manager config file in standalone Prometheus.</p>
</li>
</ol>
<p>A sample alert manager configuration file having both template_files and alertmanager_config looks like below,</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">template_files:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default_template: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ define &quot;sns.default.subject&quot; }}[{{ .Status | toUpper }}{{ if eq .Status &quot;firing&quot; }}:{{ .Alerts.Firing | len }}{{ end }}]{{ end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ define &quot;__alertmanager&quot; }}AlertManager{{ end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ define &quot;__alertmanagerURL&quot; }}{{ .ExternalURL }}/#/alerts?receiver={{ .Receiver | urlquery }}{{ end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alertmanager_config: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  global:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  templates:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &#x27;default_template&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  route:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    receiver: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  receivers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: &#x27;default&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sns_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - topic_arn: arn:aws:sns:us-east-2:accountid:My-Topic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sigv4:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          region: us-east-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        attributes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          key: severity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value: SEV2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-aspects-of-alerting">Key aspects of alerting<a class="hash-link" aria-label="Direct link to Key aspects of alerting" title="Direct link to Key aspects of alerting" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#key-aspects-of-alerting">​</a></h2>
<p>There are three important aspects to be aware of when creating Amazon Managed Service for Prometheus <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-alert-manager.html" target="_blank" rel="noopener noreferrer">Alert Manager configuration file</a>.</p>
<ul>
<li><strong>Grouping</strong>: This helps collect similar alerts into a single notification, which is useful when the blast radius of failure or outage is large affecting many systems and several alerts fire simultaneously. This can also be used to group into categories (e.g., node alerts, pod alerts). The <a href="https://prometheus.io/docs/alerting/latest/configuration/#route" target="_blank" rel="noopener noreferrer">route</a> block in the alert manager configuration file can be used to configure this grouping.</li>
<li><strong>Inhibition</strong>: This is a way to suppress certain notifications to avoid spamming similar alerts that are already active and fired. <a href="https://prometheus.io/docs/alerting/latest/configuration/#inhibit_rule" target="_blank" rel="noopener noreferrer">inhibit_rules</a> block can be used to write inhibition rules.</li>
<li><strong>Silencing</strong>: Alerts can be muted for a specified duration, such as during a maintenance window or a planned outage. Incoming alerts are verified for matching all equality or regular expression before silencing the alert. <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-APIReference.html#AMP-APIReference-PutAlertManagerSilences" target="_blank" rel="noopener noreferrer">PutAlertManagerSilences</a> API can be used to create silencing.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="route-alerts-through-amazon-simple-notification-service-sns">Route alerts through Amazon Simple Notification Service (SNS)<a class="hash-link" aria-label="Direct link to Route alerts through Amazon Simple Notification Service (SNS)" title="Direct link to Route alerts through Amazon Simple Notification Service (SNS)" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#route-alerts-through-amazon-simple-notification-service-sns">​</a></h2>
<p>Currently <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-alertmanager-receiver-AMPpermission.html" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus Alert Manager supports Amazon SNS</a> as the only receiver. The key section in the alertmanager_config block is the receivers, which lets customers configure <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-alertmanager-receiver-config.html" target="_blank" rel="noopener noreferrer">Amazon SNS to receive alerts</a>. The following section can be used as a template for the receivers block.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- name: name_of_receiver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sns_configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - sigv4:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        region: &lt;AWS_Region&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topic_arn: &lt;ARN_of_SNS_topic&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subject: somesubject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    attributes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       key: &lt;somekey&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       value: &lt;somevalue&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The Amazon SNS configuration uses the following template as default unless its explicitly overridden.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{{ define &quot;sns.default.message&quot; }}{{ .CommonAnnotations.SortedPairs.Values | join &quot; &quot; }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {{ if gt (len .Alerts.Firing) 0 -}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Alerts Firing:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ template &quot;__text_alert_list&quot; .Alerts.Firing }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {{ if gt (len .Alerts.Resolved) 0 -}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Alerts Resolved:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ template &quot;__text_alert_list&quot; .Alerts.Resolved }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {{- end }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{- end }}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Additional Reference: <a href="https://prometheus.io/docs/alerting/latest/notification_examples/" target="_blank" rel="noopener noreferrer">Notification Template Examples</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="routing-alerts-to-other-destinations-beyond-amazon-sns">Routing alerts to other destinations beyond Amazon SNS<a class="hash-link" aria-label="Direct link to Routing alerts to other destinations beyond Amazon SNS" title="Direct link to Routing alerts to other destinations beyond Amazon SNS" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#routing-alerts-to-other-destinations-beyond-amazon-sns">​</a></h2>
<p>Amazon Managed Service for Prometheus Alert Manager can use <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-alertmanager-SNS-otherdestinations.html" target="_blank" rel="noopener noreferrer">Amazon SNS to connect to other destinations</a> such as email, webhook (HTTP), Slack, PageDuty, and OpsGenie.</p>
<ul>
<li><strong>Email</strong> A successful notification will result in an email received from Amazon Managed Service for Prometheus Alert Manager through Amazon SNS topic with the alert details as one of the targets.</li>
<li>Amazon Managed Service for Prometheus Alert Manager can <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-alertmanager-receiver-JSON.html" target="_blank" rel="noopener noreferrer">send alerts in JSON format</a>, so that they can be processed downstream from Amazon SNS in AWS Lambda or in webhook-receiving endpoints.</li>
<li><strong>Webhook</strong> An existing Amazon SNS topic can be configured to output messages to a webhook endpoint. Webhooks are messages in serialized form-encoded JSON or XML formats, exchanged over HTTP between applications based on event driven triggers. This can be used to hook any existing <a href="https://repost.aws/knowledge-center/sns-lambda-webhooks-chime-slack-teams" target="_blank" rel="noopener noreferrer">SIEM or collaboration tools</a> for alerting, ticketing or incident management systems.</li>
<li><strong>Slack</strong> Customers can integrate with <a href="https://aws.amazon.com/blogs/mt/how-to-integrate-amazon-managed-service-for-prometheus-with-slack/" target="_blank" rel="noopener noreferrer">Slack’s</a> email-to-channel integration where Slack can accept an email and forward it to a Slack channel, or use a Lambda function to rewrite the SNS notification to Slack.</li>
<li><strong>PagerDuty</strong> The template used in <code>template_files</code> block in the <code>alertmanager_config</code> definition can be customized to send the payload to <a href="https://aws.amazon.com/blogs/mt/using-amazon-managed-service-for-prometheus-alert-manager-to-receive-alerts-with-pagerduty/" target="_blank" rel="noopener noreferrer">PagerDuty</a> as a destination of Amazon SNS.</li>
</ul>
<p>Additional Reference: <a href="https://prometheus.io/blog/2016/03/03/custom-alertmanager-templates/" target="_blank" rel="noopener noreferrer">Custom Alert manager Templates</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="alert-status">Alert status<a class="hash-link" aria-label="Direct link to Alert status" title="Direct link to Alert status" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#alert-status">​</a></h2>
<p>Alerting rules define alert conditions based on expressions to send alerts to any notification service, whenever the set threshold is crossed. An example rule and its expression is shown below.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- alert: metric:alerting_rule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  expr: avg(rate(container_cpu_usage_seconds_total[5m])) &gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for: 2m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Whenever the alert expression results in one or more vector elements at a given point in time, the alert counts as active. The alerts take active (pending | firing) or resolved status.</p>
<ul>
<li><strong>Pending</strong>: The time elapsed since threshold breach is less than the recording interval</li>
<li><strong>Firing</strong>: The time elapsed since threshold breach is more than the recording interval and Alert Manager is routing alerts.</li>
<li><strong>Resolved</strong>: The alert is no longer firing because the threshold is no longer breached.</li>
</ul>
<p>This can be manually verified by querying the Amazon Managed Service for Prometheus Alert Manager endpoint with <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-APIReference.html#AMP-APIReference-ListAlerts" target="_blank" rel="noopener noreferrer">ListAlerts</a> API using <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-compatible-APIs.html" target="_blank" rel="noopener noreferrer">awscurl</a> command. A sample request is shown below.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">awscurl https://aps-workspaces.us-east-1.amazonaws.com/workspaces/$WORKSPACE_ID/alertmanager/api/v2/alerts --service=&quot;aps&quot; -H &quot;Content-Type: application/json&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="amazon-managed-service-for-prometheus-alert-manager-rules-in-amazon-managed-grafana">Amazon Managed Service for Prometheus Alert Manager rules in Amazon Managed Grafana<a class="hash-link" aria-label="Direct link to Amazon Managed Service for Prometheus Alert Manager rules in Amazon Managed Grafana" title="Direct link to Amazon Managed Service for Prometheus Alert Manager rules in Amazon Managed Grafana" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#amazon-managed-service-for-prometheus-alert-manager-rules-in-amazon-managed-grafana">​</a></h2>
<p>Amazon Managed Grafana (AMG) alerting feature allows customers to gain visibility into Amazon Managed Service for Prometheus Alert Manager alerts from their Amazon Managed Grafana workspace. Customers using the Amazon Managed Service for Prometheus workspaces to collect Prometheus metrics utilize the fully managed Alert Manager and Ruler features in the service to configure alerting and recording rules. With this feature, they can visualize all their alert and recording rules configured in their Amazon Managed Service for Prometheus workspace. Prometheus alerts view can be in Amazon Managed Grafana (AMG) console by checking the Grafana alerting checkbox in the Workspace configuration options tab. Once enabled, this will also migrate native Grafana alerts that were previously created in Grafana dashboards into a new Alerting page in the Grafana workspace.</p>
<p>Reference: <a href="https://aws.amazon.com/blogs/mt/announcing-prometheus-alertmanager-rules-in-amazon-managed-grafana/" target="_blank" rel="noopener noreferrer">Announcing Prometheus Alert manager rules in Amazon Managed Grafana</a></p>
<p><img decoding="async" loading="lazy" alt="List of AMP alerts in Grafana" src="/observability-best-practices/assets/images/amp-alerting-57f47bed52478cd997dfa3e5c6566e77.png" width="1283" height="1055" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="recommended-alerts-for-a-baseline-monitoring">Recommended alerts for a baseline monitoring<a class="hash-link" aria-label="Direct link to Recommended alerts for a baseline monitoring" title="Direct link to Recommended alerts for a baseline monitoring" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#recommended-alerts-for-a-baseline-monitoring">​</a></h2>
<p>Alerting is a key aspect of robust monitoring and observability best practices. The alerting mechanism should strike a balance between alert fatigue and missing critical alerts. Here are some of the alerts that are recommended to improve the overall reliability of the workloads. Various teams in the organization look at monitoring their infrastructure and workloads from different perspectives and hence this could be expanded or changed based on the requirement and scenario &amp; certainly this is not a comprehensive list.</p>
<ul>
<li>Container Node is using more than certain (ex. 80%) allocated memory limit.</li>
<li>Container Node is using more than certain (ex. 80%) allocated CPU limit.</li>
<li>Container Node is using more than certain (ex. 90%) allocated disk space.</li>
<li>Container in pod in namespace is using more than certain (ex. 80%) allocated CPU limit.</li>
<li>Container in pod in namespace is using more than certain (ex. 80%) of memory limit.</li>
<li>Container in pod in namespace had too many restarts.</li>
<li>Persistent Volume in a namespace is using more than certain (max 75%) disk space.</li>
<li>Deployment is currently having no active pods running</li>
<li>Horizontal Pod Autoscaler (HPA) in namespace is running at max capacity</li>
</ul>
<p>The essential thing in setting up alerts for the above or any similar scenario will require the expression to be changed as needed. For example,</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">expr: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ((sum(irate(container_cpu_usage_seconds_total{image!=&quot;&quot;,container!=&quot;POD&quot;, namespace!=&quot;kube-sys&quot;}[30s])) by (namespace,container,pod) /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sum(container_spec_cpu_quota{image!=&quot;&quot;,container!=&quot;POD&quot;, namespace!=&quot;kube-sys&quot;} /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">container_spec_cpu_period{image!=&quot;&quot;,container!=&quot;POD&quot;, namespace!=&quot;kube-sys&quot;}) by (namespace,container,pod) ) * 100)  &gt; 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      for: 5m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ack-controller-for-amazon-managed-service-for-prometheus">ACK Controller for Amazon Managed Service for Prometheus<a class="hash-link" aria-label="Direct link to ACK Controller for Amazon Managed Service for Prometheus" title="Direct link to ACK Controller for Amazon Managed Service for Prometheus" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#ack-controller-for-amazon-managed-service-for-prometheus">​</a></h2>
<p>Amazon Managed Service for Prometheus <a href="https://github.com/aws-controllers-k8s/community" target="_blank" rel="noopener noreferrer">AWS Controller for Kubernetes</a> (ACK) controller is available for Workspace, Alert Manager and Ruler resources which lets customers take advantage of Prometheus using <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/" target="_blank" rel="noopener noreferrer">custom resource definitions</a> (CRDs) and native objects or services that provide supporting capabilities without having to define any resources outside of Kubernetes cluster. The <a href="https://aws.amazon.com/blogs/mt/introducing-the-ack-controller-for-amazon-managed-service-for-prometheus/" target="_blank" rel="noopener noreferrer">ACK controller for Amazon Managed Service for Prometheus</a> can be used to manage all resources directly from the Kubernetes cluster that you’re monitoring, allowing Kubernetes to act as your ‘source of truth’ for your workload’s desired state. <a href="https://aws-controllers-k8s.github.io/community/docs/community/overview/" target="_blank" rel="noopener noreferrer">ACK</a> is a collection of Kubernetes CRDs and custom controllers working together to extend the Kubernetes API and manage AWS resources.</p>
<p>A snippet of alerting rules configured using ACK is shown below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: prometheusservice.services.k8s.aws/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: RuleGroupsNamespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: default-rule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  workspaceID: WORKSPACE-ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: default-rule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  configuration: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - alert: HostHighCpuLoad</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expr: 100 - (avg(rate(node_cpu_seconds_total{mode=&quot;idle&quot;}[2m])) * 100) &gt; 60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for: 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          severity: warning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          event_type: scale_up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          summary: Host high CPU load (instance {{ $labels.instance }})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          description: &quot;CPU load is &gt; 60%\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - alert: HostLowCpuLoad</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expr: 100 - (avg(rate(node_cpu_seconds_total{mode=&quot;idle&quot;}[2m])) * 100) &lt; 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for: 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          severity: warning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          event_type: scale_down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          summary: Host low CPU load (instance {{ $labels.instance }})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          description: &quot;CPU load is &lt; 30%\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="restricting-access-to-rules-using-iam-policy">Restricting access to rules using IAM policy<a class="hash-link" aria-label="Direct link to Restricting access to rules using IAM policy" title="Direct link to Restricting access to rules using IAM policy" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#restricting-access-to-rules-using-iam-policy">​</a></h2>
<p>Organizations require various teams to have their own rules to be created &amp; administered for their recording and alerting requirements. Rules management in Amazon Managed Service for Prometheus allows rules to be access controlled using AWS Identity and Access Management (IAM) policy so that each team can control their own set of rules &amp; alerts grouped by rulegroupnamespaces.</p>
<p>The below image shows two example rulegroupnamespaces called devops and engg added into Rules management of Amazon Managed Service for Prometheus.</p>
<p><img decoding="async" loading="lazy" alt="Recording and Alerting rule namespaces in AMP console" src="/observability-best-practices/assets/images/AMP_rules_namespaces-9e8f57ad590fe7ed77ab351035eb3144.png" width="1091" height="302" class="img_ev3q"></p>
<p>The below JSON is a sample IAM policy which restricts access to the devops rulegroupnamespace (shown above) with the Resource ARN specified. The notable actions in the below IAM policy are <a href="https://docs.aws.amazon.com/cli/latest/reference/amp/put-rule-groups-namespace.html" target="_blank" rel="noopener noreferrer">PutRuleGroupsNamespace</a> and <a href="https://docs.aws.amazon.com/cli/latest/reference/amp/delete-rule-groups-namespace.html" target="_blank" rel="noopener noreferrer">DeleteRuleGroupsNamespace</a> which are restricted to the specified Resource ARN of the rulegroupsnamespace of AMP workspace. Once the policy is created, it can be assigned to any required user, group or role for desired access control requirement. The Action in the IAM policy can be modified/restricted as required based on <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-APIReference.html" target="_blank" rel="noopener noreferrer">IAM permissions</a> for required &amp; allowable actions.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2012-10-17&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Statement&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Sid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;VisualEditor0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Effect&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Allow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;aps:RemoteWrite&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;aps:DescribeRuleGroupsNamespace&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;aps:PutRuleGroupsNamespace&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;aps:DeleteRuleGroupsNamespace&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;Resource&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;arn:aws:aps:us-west-2:XXXXXXXXXXXX:workspace/ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;arn:aws:aps:us-west-2:XXXXXXXXXXXX:rulegroupsnamespace/ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx/devops&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The below awscli interaction shows an example of an IAM user having restricted access to a rulegroupsnamespace specified through Resource ARN (i.e. devops rulegroupnamespace) in IAM policy and how the same user is denied access to other resources (i.e. engg rulegroupnamespace) not having access.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ aws amp describe-rule-groups-namespace --workspace-id ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx --name devops</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ruleGroupsNamespace&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;arn&quot;: &quot;arn:aws:aps:us-west-2:XXXXXXXXXXXX:rulegroupsnamespace/ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx/devops&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;createdAt&quot;: &quot;2023-04-28T01:50:15.408000+00:00&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;data&quot;: &quot;Z3JvdXBzOgogIC0gbmFtZTogZGV2b3BzX3VwZGF0ZWQKICAgIHJ1bGVzOgogICAgLSByZWNvcmQ6IG1ldHJpYzpob3N0X2NwdV91dGlsCiAgICAgIGV4cHI6IGF2ZyhyYXRlKGNvbnRhaW5lcl9jcHVfdXNhZ2Vfc2Vjb25kc190b3RhbFsybV0pKQogICAgLSBhbGVydDogaGlnaF9ob3N0X2NwdV91c2FnZQogICAgICBleHByOiBhdmcocmF0ZShjb250YWluZXJfY3B1X3VzYWdlX3NlY29uZHNfdG90YWxbNW1dKSkKICAgICAgZm9yOiA1bQogICAgICBsYWJlbHM6CiAgICAgICAgICAgIHNldmVyaXR5OiBjcml0aWNhbAogIC0gbmFtZTogZGV2b3BzCiAgICBydWxlczoKICAgIC0gcmVjb3JkOiBjb250YWluZXJfbWVtX3V0aWwKICAgICAgZXhwcjogYXZnKHJhdGUoY29udGFpbmVyX21lbV91c2FnZV9ieXRlc190b3RhbFs1bV0pKQogICAgLSBhbGVydDogY29udGFpbmVyX2hvc3RfbWVtX3VzYWdlCiAgICAgIGV4cHI6IGF2ZyhyYXRlKGNvbnRhaW5lcl9tZW1fdXNhZ2VfYnl0ZXNfdG90YWxbNW1dKSkKICAgICAgZm9yOiA1bQogICAgICBsYWJlbHM6CiAgICAgICAgc2V2ZXJpdHk6IGNyaXRpY2FsCg==&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;modifiedAt&quot;: &quot;2023-05-01T17:47:06.409000+00:00&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;devops&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;status&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;statusCode&quot;: &quot;ACTIVE&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;statusReason&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;tags&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cat &gt; devops.yaml &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; groups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;  - name: devops_new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;    rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;   - record: metric:host_cpu_util</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;     expr: avg(rate(container_cpu_usage_seconds_total[2m]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;   - alert: high_host_cpu_usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;     expr: avg(rate(container_cpu_usage_seconds_total[5m]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;     for: 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;     labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;            severity: critical</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;  - name: devops</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;    rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;    - record: container_mem_util</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;      expr: avg(rate(container_mem_usage_bytes_total[5m]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;    - alert: container_host_mem_usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;      expr: avg(rate(container_mem_usage_bytes_total[5m]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;      for: 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;        severity: critical</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ base64 devops.yaml &gt; devops_b64.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ aws amp put-rule-groups-namespace --workspace-id ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx --name devops --data file://devops_b64.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;arn&quot;: &quot;arn:aws:aps:us-west-2:XXXXXXXXXXXX:rulegroupsnamespace/ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx/devops&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;name&quot;: &quot;devops&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;status&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;statusCode&quot;: &quot;UPDATING&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;tags&quot;: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>$ aws amp describe-rule-groups-namespace --workspace-id ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx --name engg An error occurred (AccessDeniedException) when calling the DescribeRuleGroupsNamespace operation: User: arn:aws:iam::XXXXXXXXXXXX:user/amp_ws_user is not authorized to perform: aps:DescribeRuleGroupsNamespace on resource: arn:aws:aps:us-west-2:XXXXXXXXXXXX:rulegroupsnamespace/ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx/engg</code></p>
<p><code>$ aws amp put-rule-groups-namespace --workspace-id ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx --name engg --data file://devops_b64.yaml An error occurred (AccessDeniedException) when calling the PutRuleGroupsNamespace operation: User: arn:aws:iam::XXXXXXXXXXXX:user/amp_ws_user is not authorized to perform: aps:PutRuleGroupsNamespace on resource: arn:aws:aps:us-west-2:XXXXXXXXXXXX:rulegroupsnamespace/ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx/engg</code></p>
<p><code>$ aws amp delete-rule-groups-namespace --workspace-id ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx --name engg An error occurred (AccessDeniedException) when calling the DeleteRuleGroupsNamespace operation: User: arn:aws:iam::XXXXXXXXXXXX:user/amp_ws_user is not authorized to perform: aps:DeleteRuleGroupsNamespace on resource: arn:aws:aps:us-west-2:XXXXXXXXXXXX:rulegroupsnamespace/ws-8da31ad6-f09d-44ff-93a3-xxxxxxxxxx/engg</code></p>
<p>The user permissions to use rules can also be restricted using an <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-alertmanager-IAM-permissions.html" target="_blank" rel="noopener noreferrer">IAM policy</a> (documentation sample).</p>
<p>For more information customers can read the <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-alert-manager.html" target="_blank" rel="noopener noreferrer">AWS Documentation</a>, go through the <a href="https://catalog.workshops.aws/observability/en-US/aws-managed-oss/amp/setup-alert-manager" target="_blank" rel="noopener noreferrer">AWS Observability Workshop</a> on Amazon Managed Service for Prometheus Alert Manager.</p>
<p>Additional Reference: <a href="https://aws.amazon.com/blogs/aws/amazon-managed-service-for-prometheus-is-now-generally-available-with-alert-manager-and-ruler/" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus Is Now Generally Available with Alert Manager and Ruler</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/aws-observability/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/observability-best-practices/docs/guides/rust-custom-metrics/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Creating Custom Metrics with the AWS Rust SDK</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/observability-best-practices/docs/guides/operational/gitops-with-amg/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Using GitOps and Grafana Operator with Amazon Managed Grafana</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#introduction">Introduction</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#alerting-rules-file">Alerting Rules File</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#alert-manager-configuration-file">Alert Manager Configuration File</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#key-aspects-of-alerting">Key aspects of alerting</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#route-alerts-through-amazon-simple-notification-service-sns">Route alerts through Amazon Simple Notification Service (SNS)</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#routing-alerts-to-other-destinations-beyond-amazon-sns">Routing alerts to other destinations beyond Amazon SNS</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#alert-status">Alert status</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#amazon-managed-service-for-prometheus-alert-manager-rules-in-amazon-managed-grafana">Amazon Managed Service for Prometheus Alert Manager rules in Amazon Managed Grafana</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#recommended-alerts-for-a-baseline-monitoring">Recommended alerts for a baseline monitoring</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#ack-controller-for-amazon-managed-service-for-prometheus">ACK Controller for Amazon Managed Service for Prometheus</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/operational/alerting/amp-alertmgr#restricting-access-to-rules-using-iam-policy">Restricting access to rules using IAM policy</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2024.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>