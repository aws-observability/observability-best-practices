<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/partners/databricks" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Databricks Monitoring and Observability Best Practices in AWS | AWS Observability best practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-observability.github.io/observability-best-practices/docs/guides/partners/databricks"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Databricks Monitoring and Observability Best Practices in AWS | AWS Observability best practices"><meta data-rh="true" name="description" content="Databricks is a platform for managing data analytics and AI/ML workloads. This guide aim at supporting customers running Databricks on AWS with monitoring these workloads using AWS Native services for observability or OpenSource Managed Services."><meta data-rh="true" property="og:description" content="Databricks is a platform for managing data analytics and AI/ML workloads. This guide aim at supporting customers running Databricks on AWS with monitoring these workloads using AWS Native services for observability or OpenSource Managed Services."><link data-rh="true" rel="icon" href="/observability-best-practices/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-observability.github.io/observability-best-practices/docs/guides/partners/databricks"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/docs/guides/partners/databricks" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/ja/docs/guides/partners/databricks" hreflang="ja"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/docs/guides/partners/databricks" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/observability-best-practices/blog/rss.xml" title="AWS Observability best practices RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/observability-best-practices/blog/atom.xml" title="AWS Observability best practices Atom Feed"><link rel="stylesheet" href="/observability-best-practices/assets/css/styles.2859e3e9.css">
<script src="/observability-best-practices/assets/js/runtime~main.240bb889.js" defer="defer"></script>
<script src="/observability-best-practices/assets/js/main.21eb589f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/observability-best-practices/"><div class="navbar__logo"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AWS Observability Best Practices</b></a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/observability-best-practices/docs/guides/">Guides</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/signals/alarms">Signals</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/tools/observability_accelerator">Tools</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/recipes/">Recipes</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/faq/adot">FAQ</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/patterns/multiaccount">Patterns</a><a class="navbar__item navbar__link" href="/observability-best-practices/docs/contributors">Contributors</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/observability-best-practices/docs/guides/partners/databricks"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/observability-best-practices/docs/guides/partners/databricks" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/observability-best-practices/ja/docs/guides/partners/databricks" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li></ul></div><a href="https://github.com/aws-observability/observability-best-practices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/observability-best-practices/docs/guides/">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/">Best practices overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/choosing-a-tracing-agent">Choosing a tracing agent</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/cost/kubecost">Cost</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/databases/rds-and-aurora">Databases</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/ec2-monitoring">EC2 Monitoring and Observability</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/containers/aws-native/ecs/best-practices-metrics-collection-1">ECS best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">EKS best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/serverless/aws-native/lambda-based-observability">Serverless best practices</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/hybrid-and-multicloud">Best practices for hybrid and multicloud</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/operational/adot-at-scale/operating-adot-collector">Operational</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/signal-collection/emf">Signal collection</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/observability-best-practices/docs/guides/partners/databricks">Partners</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/observability-best-practices/docs/guides/partners/databricks">Databricks Monitoring and Observability Best Practices in AWS</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/databases/rds-and-aurora">Databases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/docs/guides/cost/kubecost">Cost</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/docs/guides/observability-maturity-model">AWS Observability Maturity Model</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/observability-best-practices/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Partners</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Databricks Monitoring and Observability Best Practices in AWS</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Databricks Monitoring and Observability Best Practices in AWS</h1>
<p>Databricks is a platform for managing data analytics and AI/ML workloads. This guide aim at supporting customers running <a href="https://aws.amazon.com/solutions/partners/databricks/" target="_blank" rel="noopener noreferrer">Databricks on AWS</a> with monitoring these workloads using AWS Native services for observability or OpenSource Managed Services.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-monitor-databricks">Why monitor Databricks<a class="hash-link" aria-label="Direct link to Why monitor Databricks" title="Direct link to Why monitor Databricks" href="/observability-best-practices/docs/guides/partners/databricks#why-monitor-databricks">​</a></h2>
<p>Operation teams managing Databricks clusters benefit from having an integrated, customized dashboard to track workload status, errors, performance bottlenecks; alerting on unwanted behaviour, such as total resource usage over time, or percentual amount of errors; and centralized logging, for root cause analysis, as well as extracting additional customized metrics.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-to-monitor">What to monitor<a class="hash-link" aria-label="Direct link to What to monitor" title="Direct link to What to monitor" href="/observability-best-practices/docs/guides/partners/databricks#what-to-monitor">​</a></h2>
<p>Databricks run Apache Spark in its cluster instances, which has native features to expose metrics. These metrics will give information regarding drivers, workers, and the workloads being executed in the cluster.</p>
<p>The instances running Spark will have additional useful information about storage, CPU, memory, and networking. It´s important to understand what external factors could be affecting the performance of a Databricks cluster. In the case of clusters with numerous instances, understanding bottlenecks and general health is important as well.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-monitor">How to monitor<a class="hash-link" aria-label="Direct link to How to monitor" title="Direct link to How to monitor" href="/observability-best-practices/docs/guides/partners/databricks#how-to-monitor">​</a></h2>
<p>To install collectors and it&#x27;s dependencies, Databricks init scripts will be needed. These are scripts that are runned in each instance of a Databricks cluster at boot time.</p>
<p>Databricks cluster permissions will also need permission to send metrics and logs using instance profiles.</p>
<p>Finally, it&#x27;s a best practice to configure metrics namespace in Databricks cluster Spark configuration, replacing <code>testApp</code> with a proper reference to the cluster.</p>
<p><img decoding="async" loading="lazy" alt="Databricks Spark Config" src="/observability-best-practices/assets/images/databricks_spark_config-007ae96a1f106d1247c945bac609e98b.png" width="1422" height="1274" class="img_ev3q">
<em>Figure 1: example of metrics namespace Spark configuration</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-parts-of-a-good-observability-solution-for-databricks">Key parts of a good Observability solution for DataBricks<a class="hash-link" aria-label="Direct link to Key parts of a good Observability solution for DataBricks" title="Direct link to Key parts of a good Observability solution for DataBricks" href="/observability-best-practices/docs/guides/partners/databricks#key-parts-of-a-good-observability-solution-for-databricks">​</a></h2>
<p><strong>1) Metrics:</strong> Metrics are numbers that describe activity or a particular process measured over a period of time. Here are different types of metrics on Databricks:</p>
<p>System resource-level metrics, such as CPU, memory, disk, and network.
Application Metrics using Custom Metrics Source, StreamingQueryListener, and QueryExecutionListener,
Spark Metrics exposed by MetricsSystem.</p>
<p><strong>2) Logs:</strong> Logs are a representation of serial events that have happened, and they tell a linear story about them. Here are different types of logs on Databricks:</p>
<ul>
<li>Event logs</li>
<li>Audit logs</li>
<li>Driver logs: stdout, stderr, log4j custom logs (enable structured logging)</li>
<li>Executor logs: stdout, stderr, log4j custom logs (enable structured logging)</li>
</ul>
<p><strong>3) Traces:</strong> Stack traces provide end-to-end visibility, and they show the entire flow through stages. This is useful when you must debug to identify which stages/codes cause errors/performance issues.</p>
<p><strong>4) Dashboards:</strong> Dashboards provide a great summary view of an application/service’s golden metrics.</p>
<p><strong>5) Alerts:</strong> Alerts notify engineers about conditions that require attention.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="aws-native-observability-options">AWS Native Observability options<a class="hash-link" aria-label="Direct link to AWS Native Observability options" title="Direct link to AWS Native Observability options" href="/observability-best-practices/docs/guides/partners/databricks#aws-native-observability-options">​</a></h2>
<p>Native solutions, such as Ganglia UI and Log Delivery, are great solutions for collecting system metrics and querying Apache Spark™ metrics. However, some areas can be improved:</p>
<ul>
<li>Ganglia doesn’t support alerts.</li>
<li>Ganglia doesn’t support creating metrics derived from logs (e.g., ERROR log growth rate).</li>
<li>You can’t use custom dashboards to track SLO (Service Level Objectives) and SLI (Service Level Indicators) related to data-correctness, data-freshness, or end-to-end latency, and then visualize them with ganglia.</li>
</ul>
<p><a href="https://aws.amazon.com/cloudwatch/" target="_blank" rel="noopener noreferrer">Amazon CloudWatch</a> is a critical tool for monitoring and managing your Databricks clusters on AWS. It provides valuable insights into cluster performance and helps you identify and resolve issues quickly. Integrating Databricks with CloudWatch and enabling structured logging can help improve those areas. CloudWatch Application Insights can help you automatically discover the fields contained in the logs, and CloudWatch Logs Insights provides a purpose-built query language for faster debugging and analysis.</p>
<p><img decoding="async" loading="lazy" alt="Databricks With CloudWatch" src="/observability-best-practices/assets/images/databricks_cw_arch-5b3ce83f61d1afe9059000f87f9f784c.png" width="1540" height="800" class="img_ev3q">
<em>Figure 2: Databricks CloudWatch Architecture</em></p>
<p>For more informaton on how to use CloudWatch to monitor Databricks, see:
<a href="https://aws.amazon.com/blogs/mt/how-to-monitor-databricks-with-amazon-cloudwatch/" target="_blank" rel="noopener noreferrer">How to Monitor Databricks with Amazon CloudWatch</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="open-source-software-observability-options">Open-source software observability options<a class="hash-link" aria-label="Direct link to Open-source software observability options" title="Direct link to Open-source software observability options" href="/observability-best-practices/docs/guides/partners/databricks#open-source-software-observability-options">​</a></h2>
<p><a href="https://aws.amazon.com/prometheus/" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus</a> is a Prometheus-compatible monitoring managed, serverless service, that will be responsible for storing metrics, and managing alerts created on top of these metrics. Prometheus is a popular open source monitoring technology, being the second project belonging to the Cloud Native Computing Foundation, right after Kubernetes.</p>
<p><a href="https://aws.amazon.com/grafana/" target="_blank" rel="noopener noreferrer">Amazon Managed Grafana</a> is a managed service for Grafana. Grafana is an open source technology for time-series data visualization, commonly used for observability. We can use Grafana to visualize data from several sources, such as Amazon Managed Service for Prometheus, Amazon CloudWatch, and many others. It will be used to visualize Databricks metrics and alerts.</p>
<p><a href="https://aws-otel.github.io/" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry</a> is the AWS-supported distribution of OpenTelemetry project, which provides open source standards, libraries, and services for collecting traces and metrics. Through OpenTelemetry, we can collect several different observability data formats, such as Prometheus or StatsD, enrich this data, and send it to several destinations, such as CloudWatch or Amazon Managed Service for Prometheus.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases">Use cases<a class="hash-link" aria-label="Direct link to Use cases" title="Direct link to Use cases" href="/observability-best-practices/docs/guides/partners/databricks#use-cases">​</a></h3>
<p>While AWS Native services will deliver the observability needed to manage Databricks clusters, there are some scenarios where using Open Source managed services is the best choice.</p>
<p>Both Prometheus and Grafana are very popular technologies, and are already being used in many companies. AWS Open Source services for observability will allow operations teams to use the same existing infrastructure, the same query language, and existing dashboards and alerts to monitor Databricks workloads, without the heavy lifting of managing these services infrastructure, scalability, and performance.</p>
<p>ADOT is the best alternative for teams that need to send metrics and traces to different destinations, such as CloudWatch and Prometheus, or work with different types of data sources, such as OTLP and StatsD.</p>
<p>Finally, Amazon Managed Grafana supports many different Data Sources, including CloudWatch and Prometheus, and help correlate data for teams that decide on using more than one tool, allowing for the creation of templates that will enable observability for all Databricks Clusters, and a powerful API that allow its provisioning and configuration through Infrastructure as Code.</p>
<p><img decoding="async" loading="lazy" alt="Databricks OpenSource Observability Diagram" src="/observability-best-practices/assets/images/databricks_oss_diagram-02a08028d86e08e2b5d97ef3e8aba5b7.png" width="712" height="235" class="img_ev3q">
<em>Figure 3: Databricks Open Source Observability Architecture</em></p>
<p>To observe metrics from a Databricks cluster using AWS Managed Open Source Services for Observability, you will need an Amazon Managed Grafana workspace for visualizing both metrics and alerts, and an Amazon Managed Service for Prometheus workspace, configured as a datasource in the Amazon Managed Grafana workspace.</p>
<p>There are two important kind of metrics that must be collected: Spark and node metrics.</p>
<p>Spark metrics will bring information such as current number of workers in the cluster, or executors; shuffles, that happen when nodes exchenge data during processing; or spills, when data go from RAM to disk and from disk to RAM. To expose these metrics, Spark native Prometheus - available since version 3.0 - must be enabled through Databricks management console, and configured through a <code>init_script</code>.</p>
<p>To keep track of node metrics, such as disk usage, CPU time, memory, storage performance, we use the <code>node_exporter</code>, that can be used without any further configuration, but should only expose important metrics.</p>
<p>An ADOT Collector must be installed in each node of the cluster, scraping the metrics exposed by both Spark and the <code>node_exporter</code>, filtering these metrics, injecting metadata such as <code>cluster_name</code>, and sending these metrics to the Prometheus workspace.</p>
<p>Both the ADOT Collector and the <code>node _exporter</code> must be installed and configured through a <code>init_script</code>.</p>
<p>The Databricks cluster must be configured with an IAM Role with permission to write metrics in the Prometheus workspace.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices<a class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" href="/observability-best-practices/docs/guides/partners/databricks#best-practices">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prioritize-valuable-metrics">Prioritize valuable metrics<a class="hash-link" aria-label="Direct link to Prioritize valuable metrics" title="Direct link to Prioritize valuable metrics" href="/observability-best-practices/docs/guides/partners/databricks#prioritize-valuable-metrics">​</a></h3>
<p>Spark and node_exporter both expose several metrics, and several formats for the same metrics. Without filtering which metrics are useful for monitoring and incident response, the mean time to detect problems increase, costs with storing samples increase, valuable information will be harder to be found and understood. Using OpenTelemetry processors, it is possible to filter and keep only valuable metrics, or filter out metrics that doesn&#x27;t make sense; aggregate and calculate metrics before sending them to AMP.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="avoid-alerting-fatigue">Avoid alerting fatigue<a class="hash-link" aria-label="Direct link to Avoid alerting fatigue" title="Direct link to Avoid alerting fatigue" href="/observability-best-practices/docs/guides/partners/databricks#avoid-alerting-fatigue">​</a></h3>
<p>Once valuable metrics are being ingested into AMP, it&#x27;s essential to configure alerts. However, alerting on every resource usage burst may cause alerting fatigue, that is when too much noise will decrease the confidence in alerts severity, and leave important events undetected. AMP alerting rules group feature should be use to avoid ambiqguity, i.e., several connected alerts generating separated notifications. Also, alerts should receive the proper severity, and it should reflect business priorities.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reuse-amazon-managed-grafana-dashboards">Reuse Amazon Managed Grafana dashboards<a class="hash-link" aria-label="Direct link to Reuse Amazon Managed Grafana dashboards" title="Direct link to Reuse Amazon Managed Grafana dashboards" href="/observability-best-practices/docs/guides/partners/databricks#reuse-amazon-managed-grafana-dashboards">​</a></h3>
<p>Amazon Managed Grafana leverages Grafana native templating feature, which allow the creation for dashboards for all existing and new Databricks clusters. It removes the need of manually creating and keeping visualizations for each cluster. To use this feature, its important to have the correct labels in the metrics to group these metrics per cluster. Once again, it&#x27;s possible with OpenTelemetry processors.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references-and-more-information">References and More Information<a class="hash-link" aria-label="Direct link to References and More Information" title="Direct link to References and More Information" href="/observability-best-practices/docs/guides/partners/databricks#references-and-more-information">​</a></h2>
<ul>
<li><a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-onboard-create-workspace.html" target="_blank" rel="noopener noreferrer">Create Amazon Managed Service for Prometheus workspace</a></li>
<li><a href="https://docs.aws.amazon.com/grafana/latest/userguide/Amazon-Managed-Grafana-create-workspace.html" target="_blank" rel="noopener noreferrer">Create Amazon Managed Grafana workspace</a></li>
<li><a href="https://docs.aws.amazon.com/grafana/latest/userguide/prometheus-data-source.html" target="_blank" rel="noopener noreferrer">Configure Amazon Managed Service for Prometheus datasource</a></li>
<li><a href="https://docs.databricks.com/clusters/init-scripts.html" target="_blank" rel="noopener noreferrer">Databricks Init Scripts</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/aws-observability/observability-best-practices/docs/guides/partners/databricks.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/observability-best-practices/docs/guides/signal-collection/emf"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CloudWatch Embedded Metric Format</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/observability-best-practices/docs/guides/databases/rds-and-aurora"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Monitor Amazon RDS and Aurora databases</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#why-monitor-databricks">Why monitor Databricks</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#what-to-monitor">What to monitor</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#how-to-monitor">How to monitor</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#key-parts-of-a-good-observability-solution-for-databricks">Key parts of a good Observability solution for DataBricks</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#aws-native-observability-options">AWS Native Observability options</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#open-source-software-observability-options">Open-source software observability options</a><ul><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#use-cases">Use cases</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#best-practices">Best Practices</a><ul><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#prioritize-valuable-metrics">Prioritize valuable metrics</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#avoid-alerting-fatigue">Avoid alerting fatigue</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#reuse-amazon-managed-grafana-dashboards">Reuse Amazon Managed Grafana dashboards</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/docs/guides/partners/databricks#references-and-more-information">References and More Information</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2024.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>