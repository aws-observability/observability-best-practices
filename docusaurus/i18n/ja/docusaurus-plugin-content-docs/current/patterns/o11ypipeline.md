# ADOT Observability パイプライン

オブザーバビリティパイプラインは、さまざまなソースからオブザーバビリティデータを収集、管理、分析するために連携する複数のコンポーネントで構成されています。

## EKS クラスター

EKS (Elastic Kubernetes Service) クラスターは、オブザーバビリティパイプラインの主要コンポーネントをホストします。

### ADOT Operator Helm Chart をインストールする

ADOT (AWS Distro for OpenTelemetry) Operator は Helm チャートを使用してインストールされます。これは、オブザーバビリティパイプラインコンポーネントのデプロイと設定を管理します。

### ユーザー設定のコレクター

ユーザーが設定したコレクターは Operator によって管理され、以下のコンポーネントで構成されています。

- Deployment としての Collector: Collector は Kubernetes デプロイメントとしてデプロイされ、高可用性とスケーラビリティを確保します。
- Collector-0、Collector-1、Collector-2: 複数の Collector インスタンスがデプロイされ、受信するオブザーバビリティデータを処理します。これらは連携してワークロードを分散し、信頼性の高いデータ収集を保証します。

![OTEL pipeline](./images/otelpipeline.png)
*図 1: OpenTelemetry パイプライン*

### Persistent Volume

永続ボリュームは、収集されたオブザーバビリティデータを保存するために使用されます。これにより、データの耐久性が確保され、長期的な保存と分析が可能になります。

### Kubernetes Node

Kubernetes ノードは、アプリケーション Pod とサイドカーとしてのコレクターをホストします。

- アプリケーションコンテナ: アプリケーションコンテナは実際のアプリケーションコードを実行し、オブザーバビリティデータを生成します。
- サイドカーとしての Collector: Collector はアプリケーションコンテナと並行してサイドカーコンテナとして実行されます。アプリケーションによって生成されたオブザーバビリティデータを収集します。

## スクレイプターゲット

オブザーバビリティパイプラインは、次のようなさまざまなスクレイプターゲットからデータを収集します。

- トレース/メトリクスのスクレイピング: パイプラインは、アプリケーションとインフラストラクチャコンポーネントからトレースとメトリクスをスクレイピングします。

## AWS Prometheus Remote Write Exporter

AWS Prometheus Remote Write Exporter は、収集されたオブザーバビリティデータを AWS サービスにエクスポートするために使用されます。

## AWS CloudWatch EMF Exporter

AWS CloudWatch EMF (Embedded Metric Format) Exporter は、メトリクスを AWS CloudWatch にエクスポートするために使用されます。

## AWS X-Ray Tracing Exporter

AWS X-Ray Tracing Exporter は、分散トレーシングとパフォーマンス分析のために、トレーシングデータを AWS X-Ray にエクスポートするために使用されます。

オブザーバビリティパイプラインは、スクレイプターゲットからデータを収集し、コレクターを使用して処理し、さらなる分析と可視化のためにさまざまな AWS サービスにエクスポートします。


## ADOT を使用したメトリクスとインサイトの収集

1. **インストルメンテーション**: OpenTelemetry と同様に、ADOT はライブラリと SDK を提供し、アプリケーションとサービスをインストルメント化して、メトリクス、トレース、ログなどのテレメトリデータをキャプチャします。

2. **メトリクスの収集**: ADOT は、AWS サービスメトリクスを含むシステムおよびアプリケーションレベルのメトリクスの収集とエクスポートをサポートし、リソース使用率とアプリケーションパフォーマンスに関する洞察を提供します。

3. **分散トレーシング**: ADOT は、AWS サービス、コンテナ、オンプレミス環境全体で分散トレーシングを有効にし、リクエストとオペレーションをエンドツーエンドでトレースできるようにします。

4. **ログ記録**: ADOT には構造化ログのサポートが含まれており、ログデータを他のテレメトリシグナルと関連付けて包括的なオブザーバビリティを実現します。

5. **AWS サービス統合**: ADOT は、AWS X-Ray、AWS CloudWatch、Amazon Managed Service for Prometheus、AWS Distro for OpenTelemetry Operator などの AWS サービスとの緊密な統合を提供し、AWS エコシステム内でシームレスなテレメトリの収集と分析を可能にします。

6. **自動インストルメンテーション**: ADOT は、一般的なフレームワークやライブラリに対する自動インストルメンテーション機能を提供し、既存のアプリケーションをインストルメント化するプロセスを簡素化します。

7. **データ処理と分析**: ADOT によって収集されたテレメトリデータは、AWS X-Ray、Amazon Managed Service for Prometheus、AWS CloudWatch などの AWS オブザーバビリティサービスにエクスポートでき、AWS ネイティブの分析および可視化ツールを活用できます。

## ADOT を使用する利点

1. **AWS ネイティブ統合**: ADOT は AWS サービスおよびインフラストラクチャとシームレスに統合するように設計されており、AWS エコシステム内で一貫性のあるオブザーバビリティエクスペリエンスを提供します。

2. **パフォーマンスとスケーラビリティ**: ADOT はパフォーマンスとスケーラビリティに最適化されており、大規模な AWS 環境での効率的なテレメトリ収集と分析を可能にします。

3. **セキュリティとコンプライアンス**: ADOT は AWS セキュリティのベストプラクティスに準拠し、さまざまな業界標準に準拠しているため、安全でコンプライアンスに準拠したオブザーバビリティの実践を保証します。

4. **AWS Support**: AWS がサポートするディストリビューションとして、ADOT は AWS の広範なドキュメント、サポートチャネル、および OpenTelemetry プロジェクトへの長期的なコミットメントの恩恵を受けています。

## OpenTelemetry と ADOT の違い

ADOT と OpenTelemetry は多くのコア機能を共有していますが、いくつかの重要な違いがあります。

1. **AWS 統合**: ADOT は AWS 環境専用に設計されており、AWS サービスとの緊密な統合を提供します。一方、OpenTelemetry はベンダーニュートラルなプロジェクトです。

2. **AWS の最適化**: ADOT は AWS 環境内でのパフォーマンス、スケーラビリティ、セキュリティに最適化されており、AWS ネイティブサービスとベストプラクティスを活用しています。

3. **AWS Support**: ADOT は AWS の公式サポート、ドキュメント、長期的なコミットメントの恩恵を受けますが、OpenTelemetry はコミュニティサポートに依存しています。

4. **AWS 固有の機能**: ADOT には AWS 固有の機能と AWS サービス向けの自動インストルメンテーションが含まれていますが、OpenTelemetry は汎用的なオブザーバビリティに焦点を当てています。

5. **ベンダーニュートラリティ**: OpenTelemetry はベンダーニュートラルなプロジェクトであり、さまざまなオブザーバビリティプラットフォームとの統合が可能ですが、ADOT は主に AWS のオブザーバビリティサービスに焦点を当てています。

ADOT を活用することで、組織は AWS エコシステム内で包括的なオブザーバビリティを実現でき、AWS ネイティブ統合、最適化されたパフォーマンス、AWS サポートの恩恵を受けながら、OpenTelemetry の機能とコミュニティの貢献を活用する柔軟性を維持できます。