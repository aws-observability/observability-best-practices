# メトリクス

メトリクスは、作成された時刻とともに順序付けて保持される一連の数値です。環境内のサーバー数、ディスク使用量、1 秒あたりに処理するリクエスト数、またはこれらのリクエストを完了する際のレイテンシーなど、あらゆるものを追跡するために使用されます。

しかし、メトリクスはインフラストラクチャやアプリケーションの監視に限定されるものではありません。むしろ、売上、コールキュー、顧客満足度を追跡するために、あらゆる種類のビジネスやワークロードに使用できます。実際、メトリクスは運用データとビジネスメトリクスの両方を組み合わせることで最も有用になり、バランスの取れたビューと観測可能なシステムを提供します。

[OpenTelemetry ドキュメントページ](https://opentelemetry.io/docs/concepts/signals/metrics/)を参照すると、メトリクスに関する追加のコンテキストが提供されているため、役立つ可能性があります。

## 主要業績評価指標 (KPI) を把握し、測定しましょう！

メトリクスで*最も*重要なことは、*正しいものを測定する*ことです。そして、それが何であるかは、誰にとっても異なります。e コマースアプリケーションでは、1 時間あたりの売上が重要な KPI である可能性がありますが、ベーカリーでは、1 日あたりに作られるクロワッサンの数により関心があるでしょう。

:::warning
	ビジネス KPI の唯一の完全で包括的なソースは存在しません。プロジェクトやアプリケーションを十分に理解し、*アウトプット目標*が何であるかを把握する必要があります。 
:::
最初のステップは、高レベルの目標に名前を付けることです。そして、それらの目標は、インフラストラクチャのみから得られる単一のメトリクスとして表現されることはほとんどありません。上記の e コマースの例では、*1 時間あたりの売上*を測定するという*メタ*目標を特定したら、購入前に商品を検索するのに費やした時間、チェックアウトプロセスを完了するのにかかった時間、商品検索結果のレイテンシーなど、詳細なメトリクスまで遡ることができます。これにより、システムを観察するために関連情報を収集することについて、意図的に取り組むことができます。

:::info
	KPI を特定したら、次にそれらに影響を与えるワークロード内のメトリクスを確認するために*逆算*できます。
:::
## 運用メトリクスデータとの関連付け

Web サーバーの高い CPU 使用率が応答時間の遅延を引き起こし、それが顧客の不満を招き、最終的には収益の低下につながる場合、CPU 使用率を測定することはビジネス成果に直接的な影響を与えるため、*絶対に*測定すべきです。

逆に、一時的なクラウドリソース (Amazon EC2 フリートや、他のクラウドプロバイダー環境での同様のリソースなど) でバッチ処理を実行するアプリケーションがある場合、バッチを完了するための最もコスト効率の良い手段を達成するために、CPU をできるだけ活用*したい*と考えるかもしれません。

いずれの場合も、運用データ (CPU 使用率など) をビジネスメトリクスと同じシステムに配置して、両者を関連付けられるようにする必要があります。 

:::info
	ビジネスメトリクスと運用メトリクスを、それらを相互に関連付けて、両方への観察された影響に基づいて結論を導き出すことができるシステムに保存します。
:::
## 良い状態がどのようなものかを知る

健全なベースラインとは何かを理解することは困難な場合があります。多くの人は、健全なメトリクスがどのようなものかを理解するために、ワークロードのストレステストを実施する必要があります。ただし、ニーズによっては、既存の運用メトリクスを観察することで、健全なしきい値について安全な結論を導き出すことができる場合があります。

健全なワークロードとは、回復力があり、可用性が高く、コスト効率に優れた状態を維持しながら、KPI 目標を達成するバランスが取れているものです。

:::info
	KPI には、パフォーマンスが必要な範囲を下回ったり上回ったりした場合に[アラーム](../signals/alarms/)を作成できるよう、正常範囲を特定する*必要があります*。
:::
## 異常検出アルゴリズムを使用する

[正常な状態がどのようなものかを把握する](#良い状態がどのようなものかを知る)ことの課題は、システム内の*すべての*メトリクスについて正常なしきい値を把握することが現実的ではない可能性があることです。リレーショナルデータベース管理システム (RDBMS) は数十のパフォーマンスメトリクスを発行する可能性があり、マイクロサービスアーキテクチャと組み合わせると、KPI に影響を与える可能性のあるメトリクスが数百に及ぶ可能性があります。

このような大量のデータポイントを監視し、それぞれの上限と下限のしきい値を個別に特定することは、人間にとって常に実用的とは限りません。しかし、機械学習はこの種の反復的なタスクを*非常に*得意としています。可能な限り自動化と機械学習を活用してください。そうしないと気づくことさえできなかった問題を特定するのに役立ちます。

:::info
	機械学習アルゴリズムと異常検出モデルを使用して、ワークロードのパフォーマンスしきい値を自動的に計算します。 
:::