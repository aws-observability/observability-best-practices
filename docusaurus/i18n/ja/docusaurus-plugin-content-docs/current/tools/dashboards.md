# ダッシュボード

ダッシュボードは、Observability ソリューションの重要な部分です。ダッシュボードを使用すると、データの厳選されたビジュアライゼーションを作成できます。データの履歴を確認し、他の関連データと並べて表示できます。また、コンテキストを提供することもできます。ダッシュボードは、全体像を理解するのに役立ちます。

多くの場合、データを収集してアラームを作成した後、そこで止まってしまいます。しかし、アラームは特定の時点のみを示すものであり、通常は単一のメトリクスまたは小さなデータセットに対してのみ機能します。ダッシュボードを使用すると、時間の経過に伴う動作を確認できます。

![Sample dashboard](../images/dashboard1.png)

## 実践的な例: 高い CPU のアラームを検討する
マシンが望ましい値よりも高い CPU で実行されていることがわかります。対処する必要があるでしょうか。また、どのくらい迅速に対処すべきでしょうか。何が判断の助けになるでしょうか。

* このインスタンス/アプリケーションの通常の CPU はどのような状態ですか？
* これはスパイクですか、それとも CPU が増加傾向にありますか？
* パフォーマンスに影響していますか？影響していない場合、どのくらいで影響が出ますか？
* これは定期的に発生しますか？また、通常は自動的に回復しますか？

### データの履歴を確認する

ここで、CPU の履歴時系列グラフを含むダッシュボードを考えてみましょう。この単一のメトリクスだけでも、これがスパイクなのか、それとも上昇傾向なのかを確認できます。また、どれくらいの速さで上昇傾向にあるかも確認でき、対応の優先順位について判断を下すことができます。

### ワークフローへの影響を確認する

しかし、このマシンは何をしているのでしょうか？全体的なコンテキストにおいて、これはどれほど重要なのでしょうか？ここで、ワークフローのパフォーマンス（応答時間、スループット、エラー、またはその他の指標）の可視化を追加したと想像してください。これにより、高い CPU 使用率が、このインスタンスがサポートしているワークフローやユーザーに影響を与えているかどうかを確認できます。

### アラームの履歴を表示する

アラームが過去 1 か月間にどのくらいの頻度でトリガーされたかを示す可視化を追加し、さらに過去にさかのぼって、これが定期的に発生しているかどうかを確認することを検討してください。たとえば、バックアップジョブがスパイクをトリガーしているのでしょうか。再発のパターンを把握することで、根本的な問題を理解し、アラームの再発を完全に防ぐ方法について長期的な決定を下すことができます。

### コンテキストを追加する

最後に、ダッシュボードにコンテキストを追加します。このダッシュボードが存在する理由、関連するワークフロー、問題が発生した場合の対処方法、ドキュメントへのリンク、連絡先などの簡単な説明を含めます。

:::info
    これで*ストーリー*が完成し、ダッシュボードのユーザーは何が起こっているかを確認し、影響を理解し、どのようなアクションが必要か、またその緊急性についてデータに基づいた適切な意思決定を行うことができます。
:::
### すべてを一度に可視化しようとしない

アラーム疲労についてよく話題になります。識別可能なアクションと優先順位のない過剰なアラームは、チームに過負荷をかけ、非効率につながる可能性があります。アラームは、重要かつ対処可能な事項に対して設定する必要があります。

ダッシュボードはこの点でより柔軟性があります。同じ方法で注意を要求しないため、まだ重要であるかどうか確信が持てないものや、調査をサポートするものを視覚化する自由度が高くなります。それでも、やりすぎには注意してください。すべてのものは、良いことでもやりすぎると問題になる可能性があります。

ダッシュボードは、あなたにとって重要な何かの全体像を提供する必要があります。取り込むデータを決定するのと同じように、ダッシュボードにとって何が重要かを考える必要があります。
ダッシュボードについては、以下を検討してください。

* 誰がこれを閲覧しますか？
    * 彼らの背景と知識は何ですか？
	* どの程度のコンテキストが必要ですか？
* 彼らはどのような質問に答えようとしていますか？
* このデータを見た結果、どのようなアクションを取りますか？

:::tip
    ダッシュボードのストーリーをどのようにすべきか、どの程度含めるべきかを判断するのが難しい場合があります。では、ダッシュボードの設計をどこから始めればよいでしょうか。*KPI 駆動*と*インシデント駆動*の 2 つの方法を見てみましょう。
:::

#### ダッシュボードの設計: KPI 駆動型

これを理解する 1 つの方法は、KPI から逆算することです。これは通常、非常にユーザー主導のアプローチです。
[レイアウト](#レイアウト)については、通常、トップダウンで作業を進め、ダッシュボードの下に移動するか、下位レベルのダッシュボードに移動するにつれて、より詳細な情報を取得します。

まず、**KPI を理解します**。それらが何を意味するのかを理解することで、これらをどのように視覚化したいかを決定するのに役立ちます。
多くの KPI は単一の数値として表示されます。たとえば、特定のワークフローを正常に完了している顧客の割合と、その所要時間はどのくらいでしょうか。しかし、どの期間にわたってでしょうか。1 週間の平均を取れば KPI を満たすかもしれませんが、その中には基準に違反するより短い期間がまだ存在する可能性があります。これらの違反はあなたにとって重要ですか。顧客体験に影響を与えますか。もしそうであれば、KPI を確認するために異なる期間と時系列チャートを検討するかもしれません。そして、おそらくすべての人が詳細を見る必要はないため、KPI の内訳を別のダッシュボードに移動して、別の対象者向けにすることを検討するかもしれません。

次に、**これらの KPI に寄与するものは何でしょうか？** これらのアクションを実行するために、どのようなワークフローが実行されている必要がありますか？これらを測定できますか？

主要なコンポーネントを特定し、そのパフォーマンスの可視化を追加します。KPI が違反した場合、ワークフローのどこに主な影響があるかを迅速に確認できる必要があります。

さらに深く掘り下げることもできます。これらのワークフローのパフォーマンスに影響を与えるものは何でしょうか？深さのレベルを決定する際には、対象読者を念頭に置いてください。

注文数の KPI を持つ e コマースシステムの例を考えてみましょう。
注文を行うには、ユーザーは次のアクションを実行できる必要があります。商品を検索し、カートに追加し、配送先の詳細を追加し、注文の支払いを行います。
これらの各ワークフローについて、主要なコンポーネントが機能しているかどうかを確認することを検討できます。たとえば、RUM または Synthetics を使用してアクションの成功に関するデータを取得し、ユーザーが問題の影響を受けているかどうかを確認します。各アクションのパフォーマンスが期待どおりであるかどうかを確認するために、スループット、レイテンシー、失敗したアクションの割合の測定を検討できます。パフォーマンスに影響を与えている可能性のあるものを確認するために、基盤となるインフラストラクチャの測定を検討できます。

ただし、すべての情報を同じダッシュボードに配置しないでください。繰り返しになりますが、ユーザーオーディエンスを考慮してください。

:::info
    ドリルダウンを可能にし、適切なユーザーに適切なコンテキストを提供するダッシュボードのレイヤーを作成します。
:::
#### ダッシュボードの設計: インシデント駆動型

多くの人にとって、インシデント解決はオブザーバビリティの主要な推進力です。ユーザーまたはオブザーバビリティアラームによって問題が通知され、迅速に修正方法と問題の根本原因を見つける必要があります。

:::info
    最近のインシデントを確認することから始めます。共通のパターンはありますか？会社にとって最も影響が大きかったのはどれですか？繰り返し発生しているものはどれですか？
:::
この場合、重大度を理解し、根本原因を特定し、インシデントを修正しようとしている人々のためのダッシュボードを設計しています。

特定のインシデントについて振り返ってください。

* インシデントが報告どおりであることをどのように確認しましたか？
    * 何を確認しましたか？エンドポイント？エラー？
* 問題の影響、したがって優先度をどのように理解しましたか？
* 問題の原因として何を調査しましたか？

アプリケーションパフォーマンスモニタリング (APM) がここで役立ちます。エンドポイントとワークフローの定期的なベースラインとテストには [Synthetics](../tools/synthetics/) を使用し、実際の顧客体験には [RUM](../tools/rum/) を使用します。このデータを使用して、どのワークフローがどの程度影響を受けているかを迅速に可視化できます。

時間経過に伴うエラー数と上位のエラーを示す可視化は、適切な領域に焦点を当て、エラーの具体的な詳細を表示するのに役立ちます。ここでは、ログデータとエラーコードおよび理由の動的な可視化をよく使用します。

ここでは、できるだけ早く詳細にたどり着くために、何らかのフィルタリングやドリルダウンを用意することが非常に役立ちます。過度なオーバーヘッドなしでこれを実装する方法を検討してください。たとえば、フィルタリングして詳細に近づくことができる単一のダッシュボードを用意することが考えられます。
 
### レイアウト

ダッシュボードのレイアウトも重要です。 

:::info
    通常、ユーザーにとって最も重要な視覚化は左上に配置するか、ページナビゲーションの自然な*始まり*に合わせて配置することが望ましいです。
:::

レイアウトを使用してストーリーを伝えることができます。たとえば、上から下へのレイアウトを使用して、下にスクロールするほど詳細が表示されるようにすることができます。または、左右の表示が便利な場合もあります。左側に上位レベルのサービスを配置し、右に移動するにつれて依存関係を表示します。

### 動的コンテンツを作成する

多くのワークロードは、需要に応じて拡大または縮小するように設計されており、ダッシュボードはこれを考慮する必要があります。たとえば、インスタンスが Auto Scaling グループに含まれている場合、特定の負荷に達すると、追加のインスタンスが追加されます。

:::info
    特定の ID で指定された特定のインスタンスからのデータを表示するダッシュボードでは、それらの新しいインスタンスからのデータを確認できません。リソースとデータにメタデータを追加して、特定のメタデータ値を持つすべてのインスタンスをキャプチャするビジュアライゼーションを作成できるようにします。これにより、実際の状態が反映されます。
:::
動的な可視化のもう 1 つの例として、現在発生している上位 10 件のエラーを見つけ、それらが最近どのように推移しているかを確認できることが挙げられます。どのエラーが発生するかを事前に知らなくても、テーブルやチャートで確認できるようにしたいと考えています。

### 原因よりも症状を優先して考える

症状を観察する際は、ユーザーやシステムへの影響について考慮します。多くの根本的な原因が同じ症状を引き起こす可能性があります。これにより、未知の問題を含む、より多くの問題を捕捉できます。原因を理解するにつれて、下位レベルのダッシュボードはこれらに対してより具体的になり、問題の迅速な診断と修正に役立ちます。

:::tip 
    先週ユーザーに影響を与えた特定の JavaScript エラーをキャプチャしないでください。中断されたワークフローへの*影響*をキャプチャし、最近の履歴における JavaScript エラーの上位カウント、または最近の履歴で劇的に増加したエラーを表示します。
:::
### 上位/下位 N を使用

ほとんどの場合、*すべて*の運用メトリクスを同時に可視化する必要はありません。大規模な EC2 インスタンスのフリートはこの良い例です。数百台のサーバーファーム全体のディスク IOPS や CPU 使用率を同時に表示する必要も価値もありません。これにより、最高 (または最悪) のパフォーマンスを発揮しているリソースを確認するよりも、メトリクスを掘り下げることに多くの時間を費やしてしまうアンチパターンが生まれます。

:::info
    ダッシュボードを使用して、任意のメトリクスの上位 10 個または 20 個を表示し、これによって明らかになる[症状](#原因よりも症状を優先して考える)に焦点を当てます。 
:::
[CloudWatch メトリクス](../tools/metrics/)を使用すると、任意の時系列データに対して上位 N 件を検索できます。たとえば、次のクエリは CPU 使用率が最も高い 20 個の EC2 インスタンスを返します。

```
SORT(SEARCH('{AWS/EC2,InstanceId} MetricName="CPUUtilization"', 'Average', 300), SUM, DESC, 10)
```

このアプローチ、または [CloudWatch Metric Insights](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/query_with_cloudwatch-metrics-insights.html) を使用した同様の方法で、ダッシュボード内のパフォーマンスが最も高い、または最も低いメトリクスを特定します。

### しきい値を使用して KPI を視覚的に表示する

KPI には警告またはエラーのしきい値を設定する必要があり、ダッシュボードでは水平アノテーションを使用してこれを表示できます。これはウィジェット上に高水位マークとして表示されます。これを視覚的に表示することで、ビジネス成果やインフラストラクチャが危険にさらされている場合に、オペレーターに事前警告を与えることができます。

![Image of a horizonal annotation](../images/horizontal-annotation.png)

:::info
    水平アノテーションは、適切に開発されたダッシュボードの重要な部分です。
:::
### コンテキストの重要性

人々はデータを簡単に誤解する可能性があります。彼らの背景や現在の状況が、データの見方に影響を与えます。

ダッシュボードには必ず*テキスト*を含めるようにしてください。このデータは何のためのもので、誰のためのものですか？それは何を意味しますか？アプリケーションのドキュメント、サポート担当者、トラブルシューティングドキュメントへのリンクを追加してください。テキスト表示を使用してダッシュボードの表示を分割することもできます。左側に配置して左右のコンテキストを設定します。水平方向の全幅表示として使用して、ダッシュボードを垂直方向に分割します。

:::info
    IT サポート、オンコール運用担当者、またはビジネスオーナーへのリンクを用意することで、問題が発生した際にサポートを提供できる担当者に迅速に連絡できる経路をチームに提供できます。
:::
:::tip
    チケットシステムへのハイパーリンクも、ダッシュボードに追加すると非常に便利です。
:::