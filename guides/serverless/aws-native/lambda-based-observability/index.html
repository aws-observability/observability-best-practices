<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/serverless/aws-native/lambda-based-observability" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">AWS Lambda based Serverless Observability | AWS Observability Best Practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-observability.github.io/observability-best-practices/guides/serverless/aws-native/lambda-based-observability"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AWS Lambda based Serverless Observability | AWS Observability Best Practices"><meta data-rh="true" name="description" content="In the world of distributed systems and serverless computing, achieving observability is the key to ensuring application reliability and performance. It involves more than traditional monitoring. By leveraging AWS observability tools like Amazon CloudWatch and AWS X-Ray, you can gain insights into your serverless applications, troubleshoot issues, and optimize application performance. In this guide, we will learn essential concepts, tools and best practices to implement Observability of your Lambda based serverless application."><meta data-rh="true" property="og:description" content="In the world of distributed systems and serverless computing, achieving observability is the key to ensuring application reliability and performance. It involves more than traditional monitoring. By leveraging AWS observability tools like Amazon CloudWatch and AWS X-Ray, you can gain insights into your serverless applications, troubleshoot issues, and optimize application performance. In this guide, we will learn essential concepts, tools and best practices to implement Observability of your Lambda based serverless application."><link data-rh="true" rel="icon" href="/observability-best-practices/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-observability.github.io/observability-best-practices/guides/serverless/aws-native/lambda-based-observability"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/guides/serverless/aws-native/lambda-based-observability" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/ja/guides/serverless/aws-native/lambda-based-observability" hreflang="ja"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/guides/serverless/aws-native/lambda-based-observability" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/observability-best-practices/blog/rss.xml" title="AWS Observability Best Practices RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/observability-best-practices/blog/atom.xml" title="AWS Observability Best Practices Atom Feed"><link rel="stylesheet" href="/observability-best-practices/assets/css/styles.e835fd1b.css">
<script src="/observability-best-practices/assets/js/runtime~main.9a4032c5.js" defer="defer"></script>
<script src="/observability-best-practices/assets/js/main.dcb5aaa0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/observability-best-practices/"><div class="navbar__logo"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AWS Observability Best Practices</b></a><a class="navbar__item navbar__link" href="/observability-best-practices/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/observability-best-practices/guides/">Guides</a><a class="navbar__item navbar__link" href="/observability-best-practices/signals/logs">Signals</a><a class="navbar__item navbar__link" href="/observability-best-practices/tools/observability_accelerator">Tools</a><a class="navbar__item navbar__link" href="/observability-best-practices/recipes/">Recipes</a><a class="navbar__item navbar__link" href="/observability-best-practices/faq/general">FAQ</a><a class="navbar__item navbar__link" href="/observability-best-practices/patterns/Tracing/xrayec2">Patterns</a><a class="navbar__item navbar__link" href="/observability-best-practices/persona/cloud_engineer">Persona</a><a class="navbar__item navbar__link" href="/observability-best-practices/resources/">Resources</a><a class="navbar__item navbar__link" href="/observability-best-practices/contributors">Contributors</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/observability-best-practices/guides/serverless/aws-native/lambda-based-observability" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/observability-best-practices/ja/guides/serverless/aws-native/lambda-based-observability" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li></ul></div><a href="https://github.com/aws-observability/observability-best-practices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/observability-best-practices/guides/">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/">Best practices overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/choosing-a-tracing-agent">Choosing a tracing agent</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/cost/kubecost">Cost</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/databases/rds-and-aurora">Databases</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/ec2-monitoring">EC2 Monitoring and Observability</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/containers/aws-native/ecs/best-practices-metrics-collection-1">ECS best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">EKS best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/observability-best-practices/guides/serverless/aws-native/lambda-based-observability">Serverless best practices</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/observability-best-practices/guides/serverless/aws-native/lambda-based-observability">AWS Lambda based Serverless Observability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/serverless/oss/lambda-based-observability-adot">AWS Lambda based Serverless Observability with OpenTelemetry</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/hybrid-and-multicloud">Best practices for hybrid and multicloud</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/operational/adot-at-scale/operating-adot-collector">Operational</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/signal-collection/emf">Signal collection</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/partners/databricks">Partners</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/observability-maturity-model">AWS Observability Maturity Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/cloudwatch_cross_account_observability">CloudWatch Cross-Account Observability</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/observability-best-practices/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Serverless best practices</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">AWS Lambda based Serverless Observability</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AWS Lambda based Serverless Observability</h1></header>
<p>In the world of distributed systems and serverless computing, achieving observability is the key to ensuring application reliability and performance. It involves more than traditional monitoring. By leveraging AWS observability tools like Amazon CloudWatch and AWS X-Ray, you can gain insights into your serverless applications, troubleshoot issues, and optimize application performance. In this guide, we will learn essential concepts, tools and best practices to implement Observability of your Lambda based serverless application.</p>
<p>The first step before you implement observability for your infrastructure or application is to determine your key objectives. It could be enhanced user experience, increased developer productivity, meeting service level objectives (SLOs), increasing business revenue or any other specific objective depending on your application type. So, clearly define these key objectives and establish how you would measure them. Then work backwards from there to design your observability strategy. Refer to “<a href="https://aws-observability.github.io/observability-best-practices/guides/#monitor-what-matters" target="_blank" rel="noopener noreferrer">Monitor what matters</a>” to learn more.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pillars-of-observability">Pillars of Observability<a href="#pillars-of-observability" class="hash-link" aria-label="Direct link to Pillars of Observability" title="Direct link to Pillars of Observability">​</a></h2>
<p>There are three main pillars to observability:</p>
<ul>
<li>Logs: Timestamped records of discrete events that happened within an application or system, such as a failure, an error, or a state transformation</li>
<li>Metrics: Numeric data measured at various time intervals (time series data); SLIs (request rate, error rate, duration, CPU%, etc.)</li>
<li>Traces: A trace represents a single user’s journey across multiple applications and systems (usually microservices)</li>
</ul>
<p>AWS offers both Native and Open source tools to facilitate logging, monitoring metrics, and tracing to obtain actionable insights for your AWS Lambda application.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="logs"><strong>Logs</strong><a href="#logs" class="hash-link" aria-label="Direct link to logs" title="Direct link to logs">​</a></h2>
<p>In this section of the observability best practices guide, we will deep dive on to following topics:</p>
<ul>
<li>Unstructured vs structured logs</li>
<li>CloudWatch Logs Insights</li>
<li>Logging correlation Id</li>
<li>Code Sample using Lambda Powertools</li>
<li>Log visualization using CloudWatch Dashboards</li>
<li>CloudWatch Logs Retention</li>
</ul>
<p>Logs are discrete events that have occurred within your application. These can include events like failures, errors, execution path or something else. Logs can be recorded in unstructured, semi-structured, or structured formats.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unstructured-vs-structured-logs"><strong>Unstructured vs structured logs</strong><a href="#unstructured-vs-structured-logs" class="hash-link" aria-label="Direct link to unstructured-vs-structured-logs" title="Direct link to unstructured-vs-structured-logs">​</a></h3>
<p>We often see developers start with simple log messages within their application using <code>print</code> or <code>console.log</code> statements. These are difficult to parse and analyze programmatically at scale, particularly in a AWS Lambda based applications that can generate many lines of log messages across different log groups. As a result, consolidating these logs in CloudWatch becomes challenging and hard to analyze. You would need to do text match or regular expressions to find relevant information in the logs. Here’s is an example of what unstructured logging looks like:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[2023-07-19T19:59:07Z]  INFO  Request started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2023-07-19T19:59:07Z]  INFO  AccessDenied: Could not access resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2023-07-19T19:59:08Z]  INFO  Request finished</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, the log messages lack a consistent structure, making it challenging to get useful insights from it. Also, it is hard to add contextual information to it.</p>
<p>Whereas structured logging is a way to log information in a consistent format, often in JSON, that allows logs to be treated as data rather than text, which makes querying and filtering simple. It gives developers the ability to efficiently store, retrieve, and analyze the logs programmatically. It also facilitates better debugging. Structured logging provides a simpler way to modify the verbosity of logs across different environments through log levels. <strong>Pay attention to logging levels.</strong> Logging too much will increase costs and decrease application throughput. Ensure personal identifiable information is redacted before logging. Here’s is an example of what structured logging looks like:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;correlationId&quot;: &quot;9ac54d82-75e0-4f0d-ae3c-e84ca400b3bd&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;requestId&quot;: &quot;58d9c96e-ae9f-43db-a353-c48e7a70bfa8&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;level&quot;: &quot;INFO&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;message&quot;: &quot;AccessDenied&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;function-name&quot;: &quot;demo-observability-function&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;cold-start&quot;: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong><code>Prefer structured and centralized logging into CloudWatch logs</code></strong> to emit operational information about transactions, correlation identifiers across different components, and business outcomes from your application.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cloudwatch-logs-insights"><strong>CloudWatch Logs Insights</strong><a href="#cloudwatch-logs-insights" class="hash-link" aria-label="Direct link to cloudwatch-logs-insights" title="Direct link to cloudwatch-logs-insights">​</a></h3>
<p>Use CloudWatch Logs Insights, which can automatically discover fields in JSON formatted logs. In addition, JSON logs can be extended to log custom metadata specific to your application that can be used to search, filter, and aggregate your logs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="logging-correlation-id"><strong>Logging correlation Id</strong><a href="#logging-correlation-id" class="hash-link" aria-label="Direct link to logging-correlation-id" title="Direct link to logging-correlation-id">​</a></h3>
<p>For example, for an http request coming in from API Gateway, the correlation Id is set at the <code>requestContext.requestId</code> path, which can be easily extracted and logged in the downstream Lambda functions using Lambda powertools. Distributed systems often involve multiple services and components working together to handle a request. So, logging correlation Id and passing them to downstream systems becomes crucial for end-to-end tracing and debugging. A correlation Id is a unique identifier assigned to a request at the very beginning. As the request moves through different services, the correlation Id is included in the logs, allowing you to trace the entire path of the request. You can either manually insert correlation Id to your AWS Lambda logs or use tools like <a href="https://docs.powertools.aws.dev/lambda/python/latest/core/logger/#setting-a-correlation-id" target="_blank" rel="noopener noreferrer">AWS Lambda powertools</a> to easily grab the correlation Id the from API Gateway and log it along with your application logs. For example, for an http request correlation Id could be a request-id which can be initiated at API Gateway and then passed on to your backend services like Lambda functions.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="code-sample-using-lambda-powertools"><strong>Code Sample using Lambda Powertools</strong><a href="#code-sample-using-lambda-powertools" class="hash-link" aria-label="Direct link to code-sample-using-lambda-powertools" title="Direct link to code-sample-using-lambda-powertools">​</a></h3>
<p>As a best practice, generate a correlation Id as early as possible in the request lifecycle, preferably at the entry point of your serverless application, such as API Gateway or application load balancer. Use UUIDs, or request id or any other unique attribute which can used to track the request across distributed systems. Pass the correlation id along with each request either as part of the custom header, body or metadata. Ensure that correlation Id is included in all the log entries and traces in your downstream services.</p>
<p>You can either manually capture and include correlation Id as part of your Lambda function logs or use tools like <a href="https://docs.powertools.aws.dev/lambda/python/latest/core/logger/#setting-a-correlation-id" target="_blank" rel="noopener noreferrer">AWS Lambda Powertools</a>. With Lambda Powertools, you can easily grab the correlation Id from predefined request <a href="https://github.com/aws-powertools/powertools-lambda-python/blob/08a0a7b68d2844d36c33ab8156640f4ea9632d0c/aws_lambda_powertools/logging/correlation_paths.py" target="_blank" rel="noopener noreferrer">path mapping</a> for supported upstream services and automatically add it alongside your application logs. Also, ensure that correlation Id is added to all your error messages to easily debug and identify the root cause in case of failures and tie it back to the original request.</p>
<p>Let&#x27;s look at the code sample to demostrate structured logging with correlation id and viewing it in CloudWatch for below serverless architecture:</p>
<p><img decoding="async" loading="lazy" alt="architecture" src="/observability-best-practices/assets/images/apigw_lambda-d5a2045427dc437610c3a840ab59880d.png" width="1410" height="556" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Initializing Logger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Logger log = LogManager.getLogger();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Uses @Logger annotation from Lambda Powertools, which takes optional parameter correlationIdPath to extract correlation Id from the API Gateway header and inserts correlation_id to the Lambda function logs in a structured format.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Logging(correlationIdPath = &quot;/headers/path-to-correlation-id&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public APIGatewayProxyResponseEvent handleRequest(final APIGatewayProxyRequestEvent input, final Context context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The log statement below will also have additional correlation_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  log.info(&quot;Success&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, a Java based Lambda function is using Lambda Powertools library to log <code>correlation_id</code> coming in from the api gateway request.</p>
<p>Sample CloudWatch logs for the code sample:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;level&quot;: &quot;INFO&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;message&quot;: &quot;Success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;function-name&quot;: &quot;demo-observability-function&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;cold-start&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;lambda_request_id&quot;: &quot;52fdfc07-2182-154f-163f-5f0f9a621d72&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;correlation_id&quot;: &quot;&lt;correlation_id_value&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}_</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="log-visualization-using-cloudwatch-dashboards"><strong>Log visualization using CloudWatch Dashboards</strong><a href="#log-visualization-using-cloudwatch-dashboards" class="hash-link" aria-label="Direct link to log-visualization-using-cloudwatch-dashboards" title="Direct link to log-visualization-using-cloudwatch-dashboards">​</a></h3>
<p>Once you log the data in structured JSON format, <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/AnalyzingLogData.html" target="_blank" rel="noopener noreferrer">CloudWatch Logs Insights</a> then automatically discovers values in JSON output and parses the messages as fields. CloudWatch Logs insights provides purpose-built <a href="https://serverlessland.com/snippets?type=CloudWatch+Logs+Insights" target="_blank" rel="noopener noreferrer">SQL-like query</a> language to search and filter multiple log streams. You can perform queries over multiple log groups using glob and regular expressions pattern matching. In addition, you can also write your custom queries and save them to re-run it again without having to re-create them each time.</p>
<p><img decoding="async" loading="lazy" alt="CloudWatch Dashboard" src="/observability-best-practices/assets/images/cw_dashboard-fdc698b6cb981a78ee3d37c4553bcfc5.png" width="1024" height="418" class="img_ev3q">
In CloudWatch logs insights, you can generate visualizations like line charts, bar charts, and stacked area charts from your queries with one or more aggregation functions. You can then easily add these visualization to the CloudWatch Dashboards. Sample dashboard below shows percentile report of Lambda function’s execution duration. Such dashboards will quickly give you insights on where you should focus on improve application performance. Average latency is a good metrics to look at but <strong><code>you should aim to optimize for p99 and not the average latency.</code></strong></p>
<p><img decoding="async" loading="lazy" alt="CloudWatch Dashboard" src="/observability-best-practices/assets/images/cw_percentile-68c9b6fafdc4e8e313da2e3213fa7ada.png" width="4062" height="660" class="img_ev3q">
To send (platform, function and extensions) logs to locations other than CloudWatch, you could use <a href="https://docs.aws.amazon.com/lambda/latest/dg/telemetry-api.html" target="_blank" rel="noopener noreferrer">Lambda Telemetry API</a> with Lambda Extensions. A number of <a href="https://docs.aws.amazon.com/lambda/latest/dg/extensions-api-partners.html" target="_blank" rel="noopener noreferrer">partner solutions</a> provide Lambda layers which use the Lambda Telemetry API and make integration with their systems easier.</p>
<p>To make the best use of CloudWatch logs insights, think about what data you must be ingesting into your logs in the form of structured logging, which will then help better monitor the health of your application.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cloudwatch-logs-retention"><strong>CloudWatch Logs Retention</strong><a href="#cloudwatch-logs-retention" class="hash-link" aria-label="Direct link to cloudwatch-logs-retention" title="Direct link to cloudwatch-logs-retention">​</a></h3>
<p>By default all messages that are written to stdout in your Lambda function are saved to an Amazon CloudWatch log stream. Lambda function&#x27;s execution role should have permission to create CloudWatch log streams and write log events the streams. It is important to be aware that CloudWatch is billed by the amount of data ingested, and the storage used. Therefore, reducing the amount of logging will help you minimize the associated cost. <strong><code>By default CloudWatch logs are kept indefinitely and never expire. It is recommended to configure log retention policy to reduce log-storage costs</code></strong>, and apply it across all your log groups. You might want differing retention policies per environment. Log retention can be configured manually in the AWS console but to ensure consistency and best practices, you should configure it as part of your Infrastructure as Code (IaC) deployments. Below is a sample CloudFormation template that demonstrates how to configuring Log Retention for Lambda function:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Function:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::Serverless::Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CodeUri: .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Runtime: python3.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Handler: main.handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tracing: Active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Explicit log group that refers to the Lambda function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LogGroup:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::Logs::LogGroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      LogGroupName: !Sub &quot;/aws/lambda/${Function}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Explicit retention time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RetentionInDays: 7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, we created a Lambda function and corresponding log group. The <strong><code>RetentionInDays</code></strong> property is <strong>set to 7 days</strong>, meaning that logs in this log group will be retained for 7 days before they are automatically deleted, thus helping to control log storage cost.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="metrics"><strong>Metrics</strong><a href="#metrics" class="hash-link" aria-label="Direct link to metrics" title="Direct link to metrics">​</a></h2>
<p>In this section of Observability best practices guide, we will deep dive on to following topics:</p>
<ul>
<li>Monitor and alert on out-of-the-box metrics</li>
<li>Publish custom metrics</li>
<li>Use embedded-metrics to auto generate metrics from your logs</li>
<li>Use CloudWatch Lambda Insights to monitor system-level metrics</li>
<li>Creating CloudWatch Alarms</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitor-and-alert-on-out-of-the-box-metrics"><strong>Monitor and alert on out-of-the-box metrics</strong><a href="#monitor-and-alert-on-out-of-the-box-metrics" class="hash-link" aria-label="Direct link to monitor-and-alert-on-out-of-the-box-metrics" title="Direct link to monitor-and-alert-on-out-of-the-box-metrics">​</a></h3>
<p>Metrics are numeric data measured at various time intervals (time series data) and service-level indicators (request rate, error rate, duration, CPU, etc.). AWS services provide a number of out-of-the-box standard metrics to help monitor the operational health of your application. Establish key metrics applicable for your application and use them for monitor performance of your application. Examples of key metrics may include function errors, queue depth, failed state machine executions, and api response times.</p>
<p>One challenge with out-of-the-box metrics is knowing how to analyze them in a CloudWatch dashboard. For example, when looking at Concurrency, do I look at max, average, or percentile? And the right statistics to monitor differs for each metric.</p>
<p>As best practices, for Lambda function’s <code>ConcurrentExecutions</code> metrics look at the <code>Count</code> statistics to check if it is getting close to the account and regional limit or close to the Lambda reserved concurrency limit if applicable.
For <code>Duration</code> metric, which indicates how long your function takes to process an event, look at the <code>Average</code> or <code>Max</code> statistic. For measuring the latency of your API, look at the <code>Percentile</code> statistics for API Gateway’s <code>Latency</code> metrics. P50, P90, and P99 are much better methods of monitoring latency over averages.</p>
<p>Once you know what metrics to monitor, configure alerts on these key metrics to engage you when components of your application are unhealthy. For Example</p>
<ul>
<li>For AWS Lambda, alert on Duration, Errors, Throttling, and ConcurrentExecutions. For stream-based invocations, alert on IteratorAge. For Asynchronous invocations, alert on DeadLetterErrors.</li>
<li>For Amazon API Gateway, alert on IntegrationLatency, Latency, 5XXError, 4XXError</li>
<li>For Amazon SQS, alert on ApproximateAgeOfOldestMessage, ApproximateNumberOfMessageVisible</li>
<li>For AWS Step Functions, alert on ExecutionThrottled, ExecutionsFailed, ExecutionsTimedOut</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="publish-custom-metrics"><strong>Publish custom metrics</strong><a href="#publish-custom-metrics" class="hash-link" aria-label="Direct link to publish-custom-metrics" title="Direct link to publish-custom-metrics">​</a></h3>
<p>Identify key performance indicators (KPIs) based on desired business and customer outcomes for your application. Evaluate KPIs to determine application success and operational health. Key metrics may vary depending on the type of application, but examples include site visited, orders placed, flights purchased, page load time, unique visitors etc.</p>
<p>One way to publish custom metrics to AWS CloudWatch is by calling CloudWatch metrics SDK’s <code>putMetricData</code> API. However, <code>putMetricData</code> API call is synchronous. It will increase the duration of your Lambda function and it can potentially block other API calls in your application, leading to performance bottlenecks. Also, longer execution duration of your Lambda function will attribute towards higher cost. Additionally you are charged for both the number of custom metrics that are sent to CloudWatch and the number of API calls (i.e. PutMetricData API calls) that are made.</p>
<p><strong><code>A more efficient and cost-effective way to publish custom metrics is with</code></strong> <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Embedded_Metric_Format.html" target="_blank" rel="noopener noreferrer">CloudWatch Embedded Metrics Format</a> (EMF). The CloudWatch Embedded Metric format allows you to generate custom metrics <strong><code>asynchronously</code></strong> as logs written to CloudWatch logs, resulting in improved performance of your application at a lower cost. With EMF, you can embed custom metrics alongside detailed log event data, and CloudWatch automatically extracts these custom metrics so that you can visualize and set alarm on them as you would do out-of-the-box metrics. By sending logs in the embedded metric format, you can query it using <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/AnalyzingLogData.html" target="_blank" rel="noopener noreferrer">CloudWatch Logs Insights</a>, and you only pay for the query, not the cost of the metrics.</p>
<p>To achieve this, you can generate the logs using <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Embedded_Metric_Format_Specification.html" target="_blank" rel="noopener noreferrer">EMF specification</a>, and send them to CloudWatch using <code>PutLogEvents</code> API. To simplify the process, there are <strong>two client libraries that support the creation of metrics in the EMF</strong> <strong>format</strong>.</p>
<ul>
<li>Low level client libraries (<a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Embedded_Metric_Format_Libraries.html" target="_blank" rel="noopener noreferrer">aws-embedded-metrics</a>)</li>
<li>Lambda Powertools <a href="https://docs.powertools.aws.dev/lambda/java/core/metrics/" target="_blank" rel="noopener noreferrer">Metrics</a>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-cloudwatch-lambda-insights-to-monitor-system-level-metrics"><strong>Use <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Lambda-Insights.html" target="_blank" rel="noopener noreferrer">CloudWatch Lambda Insights</a> to monitor system-level metrics</strong><a href="#use-cloudwatch-lambda-insights-to-monitor-system-level-metrics" class="hash-link" aria-label="Direct link to use-cloudwatch-lambda-insights-to-monitor-system-level-metrics" title="Direct link to use-cloudwatch-lambda-insights-to-monitor-system-level-metrics">​</a></h3>
<p>CloudWatch Lambda insights provides you system-level metrics, including CPU time, memory usage, disk utilization, and network performance. Lambda Insights also collects, aggregates, and summarizes diagnostic information, such as <strong><code>cold starts</code></strong> and Lambda worker shutdowns. Lambda Insights leverages CloudWatch Lambda extension, which is packaged as a Lambda layer. Once enabled, it collects system-level metrics and emits a single performance log event to CloudWatch Logs for every invocation of that Lambda function in the embedded metrics format.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>CloudWatch Lambda Insights is not enabled by default and needs to be turned on per Lambda function.</p></div></div>
<p>You can enable it via AWS console or via  Infrastructure as Code (IaC). Here is an example of how to enable it using the AWS serverless application model (SAM). You add <code>LambdaInsightsExtension</code> extension Layer to your Lambda function, and also add managed IAM policy <code>CloudWatchLambdaInsightsExecutionRolePolicy</code>, which gives permissions to your Lambda function to create log stream and call <code>PutLogEvents</code> API to be able to write logs to it.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Add LambdaInsightsExtension Layer to your function resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MyFunction:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::Serverless::Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Layers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - !Sub &quot;arn:aws:lambda:${AWS::Region}:580247275435:layer:LambdaInsightsExtension:14&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Add IAM policy to enable Lambda function to write logs to CloudWatch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MyFunction:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::Serverless::Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Policies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - `CloudWatchLambdaInsightsExecutionRolePolicy`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can then use CloudWatch console to view these system-level performance metrics under Lambda Insights.</p>
<p><img decoding="async" loading="lazy" alt="Lambda Insights" src="/observability-best-practices/assets/images/lambda_insights-d3c0ecd9b0ecbad1ff320b30cacac11d.png" width="900" height="654" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-cloudwatch-alarms"><strong>Creating CloudWatch Alarms</strong><a href="#creating-cloudwatch-alarms" class="hash-link" aria-label="Direct link to creating-cloudwatch-alarms" title="Direct link to creating-cloudwatch-alarms">​</a></h3>
<p>Creating CloudWatch Alarms and take necessary actions when metrics go off is a critical part of observability. Amazon <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/AlarmThatSendsEmail.html" target="_blank" rel="noopener noreferrer">CloudWatch alarms</a> are used to alert you or automate remediation actions when application and infrastructure metrics exceed static or dynamically set thresholds.</p>
<p>To set up an alarm for a metric, you select a threshold value that triggers a set of actions. A fixed threshold value is known as a static threshold. For instance, you can configure an alarm on <code>Throttles</code> metrics from Lambda function to activate if it exceeds 10% of the time within a 5-min period. This could potentially mean that Lambda function has reached its max concurrency for your account and region.</p>
<p>In a serverless application, it is common to send an alert using SNS (Simple Notification Service). This enables users to receive alerts via email, SMS, or other channels. Additionally, you can subscribe a Lambda function to the SNS topic, allowing it to auto remediate any issues which caused the alarm to go off.</p>
<p>For example, Let’s say you have a Lambda function A, which is polling an SQS queue and calling a downstream service. If downstream service is down and not responding, Lambda function will continue to poll from SQS and try calling downstream service with failures. While you can monitor these errors and generate a CloudWatch alarm using SNS to notify appropriate team, you can also call another Lambda function B (via SNS subscription), which can disable the event-source-mapping for the Lambda function A and thus stopping it from polling SQS queue, until the downstream service is back up and running.</p>
<p>While setting up alarms on an individual metric is good, sometimes monitoring multiple metrics becomes necessary to better understand the operational health and performance of your application. In such a scenario, you should setup alarms based on multiple metrics using <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/using-metric-math.html" target="_blank" rel="noopener noreferrer">metric math</a> expression.</p>
<p>For example, if you want to monitor AWS Lambda errors but allow a small number of errors without triggering your alarm, y you can create an error rate expression in the form of a percentage. i.e. ErrorRate = errors / invocation * 100, then create an alarm to send an alert if the ErrorRate goes above 20% within the configured evaluation period.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tracing"><strong>Tracing</strong><a href="#tracing" class="hash-link" aria-label="Direct link to tracing" title="Direct link to tracing">​</a></h2>
<p>In this section of Observability best practices guide, we will deep dive on to following topics:</p>
<ul>
<li>Introduction to distributed tracing and AWS X-Ray</li>
<li>Apply appropriate sampling rule</li>
<li>Use X-Ray SDK to trace interaction with other services</li>
<li>Code Sample for tracing integrated services using X-Ray SDK</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction-to-distributed-tracing-and-aws-x-ray">Introduction to distributed tracing and AWS X-Ray<a href="#introduction-to-distributed-tracing-and-aws-x-ray" class="hash-link" aria-label="Direct link to Introduction to distributed tracing and AWS X-Ray" title="Direct link to Introduction to distributed tracing and AWS X-Ray">​</a></h3>
<p>Most serverless applications consist of multiple microservices, each using multiple AWS services. Due to the nature of serverless architectures, it’s crucial to have distributed tracing. For effective performance monitoring and error tracking, it is important to trace the transaction across entire application flow, from the source caller through all the downstream services. While it’s possible to achieve this using individual service’s logs, it’s faster and more efficient to use a tracing tool like AWS X-Ray. See <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-instrumenting-your-app.html" target="_blank" rel="noopener noreferrer">Instrumenting your application with AWS X-Ray</a> for more information.</p>
<p>AWS X-Ray enables you to trace requests as it flows through the involved microservices. X-Ray Service maps enables you to understand different integration points and identify any performance degradation of your application. You can quickly isolate which component of you application is causing errors, throttling or having latency issues with just few clicks. Under the service graph, you can also individual traces to pinpoint the exact duration taken by each microservice.</p>
<p><img decoding="async" loading="lazy" alt="X-Ray Trace" src="/observability-best-practices/assets/images/xray_trace-4e37cc666884874868893a75b45f32fa.png" width="1024" height="744" class="img_ev3q"></p>
<p><strong><code>As a best practice, create custom subsegments in your code for downstream calls</code></strong> or any specific functionality that requires monitoring. For instance, you can create a subsegment to monitor a call to an external HTTP API, or an SQL database query.</p>
<p>For example, To create a custom subsegment for a function that makes calls to downstream services, use the <code>captureAsyncFunc</code> function (in node.js)</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var AWSXRay = require(&#x27;aws-xray-sdk&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app.use(AWSXRay.express.openSegment(&#x27;MyApp&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app.get(&#x27;/&#x27;, function (req, res) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var host = &#x27;api.example.com&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // start of the subsegment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AWSXRay.captureAsyncFunc(&#x27;send&#x27;, function(subsegment) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sendRequest(host, function() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.log(&#x27;rendering!&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      res.render(&#x27;index&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // end of the subsegment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      subsegment.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this example, the application creates a custom subsegment named <code>send</code> for calls to the <code>sendRequest</code> function. <code>captureAsyncFunc</code> passes a subsegment that you must close within the callback function when the asynchronous calls that it makes are complete.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="apply-appropriate-sampling-rule"><strong>Apply appropriate sampling rule</strong><a href="#apply-appropriate-sampling-rule" class="hash-link" aria-label="Direct link to apply-appropriate-sampling-rule" title="Direct link to apply-appropriate-sampling-rule">​</a></h3>
<p>AWS X-Ray SDK does not trace all requests by default. It applies a conservative sampling rule to provide a representative sample of the requests without incurring high cost. However, you can <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-console-sampling.html#xray-console-config" target="_blank" rel="noopener noreferrer">customize</a> the default sampling rule or disable sampling altogether and start tracing all your requests based on your specific requirements.</p>
<p>It’s important to note that AWS X-Ray is not intended to be used as an audit or compliance tool. You should consider having <strong><code>different sampling rate for different type of application</code></strong>. For instance, high-volume read-only calls, like background polling, or health checks can be sampled at a lower rate while still providing enough data to identify any potential issues that may arise. You may also want to have <strong><code>different sampling rate per environment</code></strong>. For instance, in your development environment, you may want all your requests to be traced to troubleshoot any errors or performance issues easily, whereas for production environment you may have lower number of traces. <strong><code>You should also keep in mind that extensive tracing can result in increased cost</code></strong>. For more information about sampling rules, see <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-console-sampling.html" target="_blank" rel="noopener noreferrer"><em>Configuring sampling rules in the X-Ray console</em></a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-x-ray-sdk-to-trace-interaction-with-other-aws-services"><strong>Use X-Ray SDK to trace interaction with other AWS services</strong><a href="#use-x-ray-sdk-to-trace-interaction-with-other-aws-services" class="hash-link" aria-label="Direct link to use-x-ray-sdk-to-trace-interaction-with-other-aws-services" title="Direct link to use-x-ray-sdk-to-trace-interaction-with-other-aws-services">​</a></h3>
<p>While X-Ray tracing can be easily enabled for services like AWS Lambda and Amazon API Gateway, with just few clicks or few lines on your IaC tool, other services require additional steps to instrument their code. Here is the complete <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-services.html" target="_blank" rel="noopener noreferrer">list of AWS Services integrated with X-Ray</a>.</p>
<p>To instrument calls to the services which are not integrated with X-Ray, such as DynamoDB, you can capture traces by wrapping AWS SDK calls with the AWS X-Ray SDK. For instance, when using node.js, you can follow below code example to capture all AWS SDK calls:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="code-sample-for-tracing-integrated-services-using-x-ray-sdk"><strong>Code sample for tracing integrated services using X-Ray SDK</strong><a href="#code-sample-for-tracing-integrated-services-using-x-ray-sdk" class="hash-link" aria-label="Direct link to code-sample-for-tracing-integrated-services-using-x-ray-sdk" title="Direct link to code-sample-for-tracing-integrated-services-using-x-ray-sdk">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//... FROM (old code)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const AWS = require(&#x27;aws-sdk&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//... TO (new code)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const AWSXRay = require(&#x27;aws-xray-sdk-core&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const AWS = AWSXRay.captureAWS(require(&#x27;aws-sdk&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>To instrument individual clients wrap your AWS SDK client in a call to <code>AWSXRay.captureAWSClient</code>.  Do not use both <code>captureAWS</code> and <code>captureAWSClient</code> together. This will lead to duplicate traces.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-resources"><strong>Additional Resources</strong><a href="#additional-resources" class="hash-link" aria-label="Direct link to additional-resources" title="Direct link to additional-resources">​</a></h2>
<p><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/AnalyzingLogData.html" target="_blank" rel="noopener noreferrer">CloudWatch Logs Insights</a></p>
<p><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Lambda-Insights.html" target="_blank" rel="noopener noreferrer">CloudWatch Lambda Insights</a></p>
<p><a href="https://github.com/awslabs/aws-embedded-metrics-java" target="_blank" rel="noopener noreferrer">Embedded Metrics Library</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>In this observability best practice guide for AWS Lambda based serverless application, we highlighted critical aspects such as logging, metrics and tracing using Native AWS services such as Amazon CloudWatch and AWS X-Ray. We recommended using AWS Lambda Powertools library to easily add observability best practices to your application. By adopting these best practices, you can unlock valuable insights into your serverless application, enabling faster error detection and performance optimization.</p>
<p>For further deep dive, we would highly recommend you to practice AWS Native Observability module of AWS <a href="https://catalog.workshops.aws/observability/en-US" target="_blank" rel="noopener noreferrer">One Observability Workshop</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/aws-observability/observability-best-practices/blob/main/docusaurus/docs/guides/serverless/aws-native/lambda-based-observability.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/observability-best-practices/guides/containers/oss/eks/keda-amp-eks"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Autoscaling applications using KEDA on AMP and EKS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/observability-best-practices/guides/serverless/oss/lambda-based-observability-adot"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AWS Lambda based Serverless Observability with OpenTelemetry</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#pillars-of-observability" class="table-of-contents__link toc-highlight">Pillars of Observability</a></li><li><a href="#logs" class="table-of-contents__link toc-highlight"><strong>Logs</strong></a><ul><li><a href="#unstructured-vs-structured-logs" class="table-of-contents__link toc-highlight"><strong>Unstructured vs structured logs</strong></a></li><li><a href="#cloudwatch-logs-insights" class="table-of-contents__link toc-highlight"><strong>CloudWatch Logs Insights</strong></a></li><li><a href="#logging-correlation-id" class="table-of-contents__link toc-highlight"><strong>Logging correlation Id</strong></a></li><li><a href="#code-sample-using-lambda-powertools" class="table-of-contents__link toc-highlight"><strong>Code Sample using Lambda Powertools</strong></a></li><li><a href="#log-visualization-using-cloudwatch-dashboards" class="table-of-contents__link toc-highlight"><strong>Log visualization using CloudWatch Dashboards</strong></a></li><li><a href="#cloudwatch-logs-retention" class="table-of-contents__link toc-highlight"><strong>CloudWatch Logs Retention</strong></a></li></ul></li><li><a href="#metrics" class="table-of-contents__link toc-highlight"><strong>Metrics</strong></a><ul><li><a href="#monitor-and-alert-on-out-of-the-box-metrics" class="table-of-contents__link toc-highlight"><strong>Monitor and alert on out-of-the-box metrics</strong></a></li><li><a href="#publish-custom-metrics" class="table-of-contents__link toc-highlight"><strong>Publish custom metrics</strong></a></li><li><a href="#use-cloudwatch-lambda-insights-to-monitor-system-level-metrics" class="table-of-contents__link toc-highlight"><strong>Use CloudWatch Lambda Insights to monitor system-level metrics</strong></a></li><li><a href="#creating-cloudwatch-alarms" class="table-of-contents__link toc-highlight"><strong>Creating CloudWatch Alarms</strong></a></li></ul></li><li><a href="#tracing" class="table-of-contents__link toc-highlight"><strong>Tracing</strong></a><ul><li><a href="#introduction-to-distributed-tracing-and-aws-x-ray" class="table-of-contents__link toc-highlight">Introduction to distributed tracing and AWS X-Ray</a></li><li><a href="#apply-appropriate-sampling-rule" class="table-of-contents__link toc-highlight"><strong>Apply appropriate sampling rule</strong></a></li><li><a href="#use-x-ray-sdk-to-trace-interaction-with-other-aws-services" class="table-of-contents__link toc-highlight"><strong>Use X-Ray SDK to trace interaction with other AWS services</strong></a></li><li><a href="#code-sample-for-tracing-integrated-services-using-x-ray-sdk" class="table-of-contents__link toc-highlight"><strong>Code sample for tracing integrated services using X-Ray SDK</strong></a></li></ul></li><li><a href="#additional-resources" class="table-of-contents__link toc-highlight"><strong>Additional Resources</strong></a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2025.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>