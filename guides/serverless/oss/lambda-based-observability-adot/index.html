<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/serverless/oss/lambda-based-observability-adot" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">AWS Lambda based Serverless Observability with OpenTelemetry | AWS Observability Best Practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-observability.github.io/observability-best-practices/guides/serverless/oss/lambda-based-observability-adot"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AWS Lambda based Serverless Observability with OpenTelemetry | AWS Observability Best Practices"><meta data-rh="true" name="description" content="This guide covers the best practices on configuring observability for Lambda based serverless applications using managed open-source tools and technologies together with the native AWS monitoring services such as AWS X-Ray, and Amazon CloudWatch. We will cover tools such as AWS Distro for OpenTelemetry (ADOT), AWS X-Ray, and Amazon Managed Service for Prometheus (AMP) and how you can use these tools to gain actionable insights into your serverless applications, troubleshoot issues, and optimize application performance."><meta data-rh="true" property="og:description" content="This guide covers the best practices on configuring observability for Lambda based serverless applications using managed open-source tools and technologies together with the native AWS monitoring services such as AWS X-Ray, and Amazon CloudWatch. We will cover tools such as AWS Distro for OpenTelemetry (ADOT), AWS X-Ray, and Amazon Managed Service for Prometheus (AMP) and how you can use these tools to gain actionable insights into your serverless applications, troubleshoot issues, and optimize application performance."><link data-rh="true" rel="icon" href="/observability-best-practices/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-observability.github.io/observability-best-practices/guides/serverless/oss/lambda-based-observability-adot"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/guides/serverless/oss/lambda-based-observability-adot" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/ja/guides/serverless/oss/lambda-based-observability-adot" hreflang="ja"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/guides/serverless/oss/lambda-based-observability-adot" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/observability-best-practices/blog/rss.xml" title="AWS Observability Best Practices RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/observability-best-practices/blog/atom.xml" title="AWS Observability Best Practices Atom Feed"><link rel="stylesheet" href="/observability-best-practices/assets/css/styles.e835fd1b.css">
<script src="/observability-best-practices/assets/js/runtime~main.fcc1f1ff.js" defer="defer"></script>
<script src="/observability-best-practices/assets/js/main.156239e1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/observability-best-practices/"><div class="navbar__logo"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/observability-best-practices/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AWS Observability Best Practices</b></a><a class="navbar__item navbar__link" href="/observability-best-practices/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/observability-best-practices/guides/">Guides</a><a class="navbar__item navbar__link" href="/observability-best-practices/signals/logs">Signals</a><a class="navbar__item navbar__link" href="/observability-best-practices/tools/observability_accelerator">Tools</a><a class="navbar__item navbar__link" href="/observability-best-practices/recipes/">Recipes</a><a class="navbar__item navbar__link" href="/observability-best-practices/faq/general">FAQ</a><a class="navbar__item navbar__link" href="/observability-best-practices/patterns/Tracing/xrayec2">Patterns</a><a class="navbar__item navbar__link" href="/observability-best-practices/persona/cloud_engineer">Persona</a><a class="navbar__item navbar__link" href="/observability-best-practices/resources/">Resources</a><a class="navbar__item navbar__link" href="/observability-best-practices/contributors">Contributors</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/observability-best-practices/guides/serverless/oss/lambda-based-observability-adot" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/observability-best-practices/ja/guides/serverless/oss/lambda-based-observability-adot" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li></ul></div><a href="https://github.com/aws-observability/observability-best-practices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/observability-best-practices/guides/">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/">Best practices overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/choosing-a-tracing-agent">Choosing a tracing agent</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/cost/kubecost">Cost</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/databases/rds-and-aurora">Databases</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/ec2-monitoring">EC2 Monitoring and Observability</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/containers/aws-native/ecs/best-practices-metrics-collection-1">ECS best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">EKS best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/observability-best-practices/guides/serverless/aws-native/lambda-based-observability">Serverless best practices</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/serverless/aws-native/lambda-based-observability">AWS Lambda based Serverless Observability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/observability-best-practices/guides/serverless/oss/lambda-based-observability-adot">AWS Lambda based Serverless Observability with OpenTelemetry</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/hybrid-and-multicloud">Best practices for hybrid and multicloud</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/operational/adot-at-scale/operating-adot-collector">Operational</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/signal-collection/emf">Signal collection</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/guides/partners/databricks">Partners</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/observability-maturity-model">AWS Observability Maturity Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/guides/cloudwatch_cross_account_observability">CloudWatch Cross-Account Observability</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/observability-best-practices/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Serverless best practices</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">AWS Lambda based Serverless Observability with OpenTelemetry</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AWS Lambda based Serverless Observability with OpenTelemetry</h1></header>
<p>This guide covers the best practices on configuring observability for Lambda based serverless applications using managed open-source tools and technologies together with the native AWS monitoring services such as AWS X-Ray, and Amazon CloudWatch. We will cover tools such as <a href="https://aws-otel.github.io/docs/introduction" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry (ADOT)</a>, <a href="https://aws.amazon.com/xray" target="_blank" rel="noopener noreferrer">AWS X-Ray</a>, and <a href="https://aws.amazon.com/prometheus/" target="_blank" rel="noopener noreferrer">Amazon Managed Service for Prometheus (AMP)</a> and how you can use these tools to gain actionable insights into your serverless applications, troubleshoot issues, and optimize application performance.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-topics-covered"><strong>Key topics covered</strong><a href="#key-topics-covered" class="hash-link" aria-label="Direct link to key-topics-covered" title="Direct link to key-topics-covered">​</a></h2>
<p>In this section of the observability best practices guide, we will deep dive on to following topics:</p>
<ul>
<li>Introduction to AWS Distro for OpenTelemetry (ADOT) and ADOT Lambda Layer</li>
<li>Auto-instrumentation Lambda function using ADOT Lambda Layer</li>
<li>Custom configuration support for ADOT Collector</li>
<li>Integration with Amazon Managed Service for Prometheus (AMP)</li>
<li>Pros and cons of using ADOT Lambda Layer</li>
<li>Managing cold start latency when using ADOT</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction-to-aws-distro-for-opentelemetry-adot"><strong>Introduction to AWS Distro for OpenTelemetry (ADOT)</strong><a href="#introduction-to-aws-distro-for-opentelemetry-adot" class="hash-link" aria-label="Direct link to introduction-to-aws-distro-for-opentelemetry-adot" title="Direct link to introduction-to-aws-distro-for-opentelemetry-adot">​</a></h2>
<p><a href="https://aws-otel.github.io/docs/introduction" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry (ADOT)</a> is a secure, production-ready, AWS-supported distribution of the Cloud Native Computing Foundation (CNCF) <a href="https://opentelemetry.io/" target="_blank" rel="noopener noreferrer">OpenTelemetry (OTel)</a> project. Using ADOT, you can instrument your applications just once and send correlated metrics and traces to multiple monitoring solutions.</p>
<p>AWS&#x27;s managed <a href="https://aws-otel.github.io/docs/getting-started/lambda" target="_blank" rel="noopener noreferrer">OpenTelemetry Lambda Layer</a> utilizes <a href="https://github.com/open-telemetry/opentelemetry-lambda" target="_blank" rel="noopener noreferrer">OpenTelemetry Lambda Layer</a>  to export telemetry data. It provides plug-and-play user experience by wrapping an AWS Lambda function, and by packaging the OpenTelemetry runtime specific SDK, trimmed down version of ADOT collector together with an out-of-the-box configuration for auto-instrumenting AWS Lambda functions. ADOT Lambda Layer collector components, such as Receivers, Exporters, and Extensions support integration with Amazon CloudWatch, Amazon OpenSearch Service, Amazon Managed Service for Prometheus, AWS X-Ray, and others. Find the complete list <a href="https://github.com/aws-observability/aws-otel-lambda" target="_blank" rel="noopener noreferrer">here</a>. ADOT also supports integrations with <a href="https://aws.amazon.com/otel/partners" target="_blank" rel="noopener noreferrer">partner solutions</a>.</p>
<p>ADOT Lambda Layer supports both auto-instrumentation (for Python, NodeJS, and Java) as well as custom instrumentation for any specific set of libraries and SDKs. With auto-instrumentation, by default, the Lambda Layer is configured to export traces to AWS X-Ray. For custom instrumentation, you will need to include the corresponding library instrumentation from the respective <a href="https://github.com/open-telemetry" target="_blank" rel="noopener noreferrer">OpenTelemetry runtime instrumentation repository</a> and modify your code to initialize it in your function.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="auto-instrumentation-using-adot-lambda-layer-with-aws-lambda"><strong>Auto-instrumentation using ADOT Lambda Layer with AWS Lambda</strong><a href="#auto-instrumentation-using-adot-lambda-layer-with-aws-lambda" class="hash-link" aria-label="Direct link to auto-instrumentation-using-adot-lambda-layer-with-aws-lambda" title="Direct link to auto-instrumentation-using-adot-lambda-layer-with-aws-lambda">​</a></h2>
<p>You can easily enable auto-instrumentation of Lambda function using ADOT Lambda Layer without any code changes. Let’s take an example of adding ADOT Lambda layer to your existing Java based Lambda function and view execution logs and traces in CloudWatch.</p>
<ol>
<li>Choose the ARN of the Lambda Layer based on the <code>runtime</code>, <code>region</code> and the <code>arch type</code> as per the <a href="https://aws-otel.github.io/docs/getting-started/lambda" target="_blank" rel="noopener noreferrer">documentation</a>. Make sure you use the Lambda Layer in the same region as your Lambda function. For example, Lambda Layer for java auto-instrumentation would be <code>arn:aws:lambda:us-east-1:901920570463:layer:aws-otel-java-agent-x86_64-ver-1-28-1:1</code></li>
<li>Add Layer to your Lambda function either via Console of IaC of your choice.<!-- -->
<ul>
<li>With AWS Console, follow the <a href="https://docs.aws.amazon.com/lambda/latest/dg/adding-layers.html" target="_blank" rel="noopener noreferrer">instructions</a> to add Layer to your Lambda function. Under Specify an ARN paste the layer ARN selected above.</li>
<li>With IaC option, SAM template for Lambda function would look like this:</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Layers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- !Sub arn:aws:lambda:${AWS::Region}:901920570463:layer:aws-otel-java-agent-arm64-ver-1-28-1:1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>Add an environment variable <code>AWS_LAMBDA_EXEC_WRAPPER=/opt/otel-handler</code> for Node.js or Java, and <code>AWS_LAMBDA_EXEC_WRAPPER=/opt/otel-instrument</code> for Python to your Lambda function.</li>
<li>Enable Active Tracing for your Lambda function. <strong><code>Note</code></strong> that by default, the layer is configured to export traces to AWS X-Ray. Make sure your Lambda function’s execution role has the required AWS X-Ray permissions. For more on AWS X-Ray permissions for AWS Lambda, see the <a href="https://docs.aws.amazon.com/lambda/latest/dg/services-xray.html#services-xray-permissions" target="_blank" rel="noopener noreferrer">AWS Lambda documentation</a>.<!-- -->
<ul>
<li><code>Tracing: Active</code></li>
</ul>
</li>
<li>Example SAM template with Lambda Layer configuration, Environment Variable, and X-Ray tracing would look something like this:</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ListBucketsFunction:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::Serverless::Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Handler: com.example.App::handleRequest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ProvisionedConcurrencyConfig:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ProvisionedConcurrentExecutions: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Policies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - AWSXrayWriteOnlyAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - AmazonS3ReadOnlyAccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Variables:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          AWS_LAMBDA_EXEC_WRAPPER: /opt/otel-handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Tracing: Active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Layers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - !Sub arn:aws:lambda:${AWS::Region}:901920570463:layer:aws-otel-java-agent-amd64-ver-1-28-1:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Events:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HelloWorld:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Type: Api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Path: /listBuckets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Method: get</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="6">
<li>Testing and Visualizing traces in AWS X-Ray
Invoke your Lambda function either directly or via an API (if an API is configured as a trigger). For example, invoking Lambda function via API (using <code>curl</code>) would generate logs as below:</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X GET https://XXXXXX.execute-api.us-east-1.amazonaws.com/Prod/listBuckets</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Lambda function logs:</p>
<pre><code><p>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
[otel.javaagent 2023-09-24 15:28:16:862 +0000] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: 1.28.0-adot-lambda1-aws
EXTENSION Name: collector State: Ready Events: [INVOKE, SHUTDOWN]
START RequestId: ed8f8444-3c29-40fe-a4a1-aca7af8cd940 Version: 3
...
END RequestId: ed8f8444-3c29-40fe-a4a1-aca7af8cd940
REPORT RequestId: ed8f8444-3c29-40fe-a4a1-aca7af8cd940 Duration: 5144.38 ms Billed Duration: 5145 ms Memory Size: 1024 MB Max Memory Used: 345 MB Init Duration: 27769.64 ms
<b>XRAY TraceId: 1-65105691-384f7da75714148655fa631b SegmentId: 2c52a147021ebd20 Sampled: true</b></p></code></pre>
<p>As you can see from the logs, OpenTelemetry Lambda extension starts listening and instrumenting Lambda functions using opentelemetry-javaagent and generates traces in AWS X-Ray.</p>
<p>To view the traces from the above Lambda function invocation, navigate to the AWS X-Ray console and select the trace id under Traces. You should see a Trace Map along with Segments Timeline as below:
<img decoding="async" loading="lazy" alt="Lambda Insights" src="/observability-best-practices/assets/images/xray-trace-67990b791cb455e28b42e1716556a32a.png" width="2491" height="1174" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-configuration-support-for-adot-collector"><strong>Custom configuration support for ADOT Collector</strong><a href="#custom-configuration-support-for-adot-collector" class="hash-link" aria-label="Direct link to custom-configuration-support-for-adot-collector" title="Direct link to custom-configuration-support-for-adot-collector">​</a></h2>
<p>The ADOT Lambda Layer combines both OpenTelemetry SDK and the ADOT Collector components. The configuration of the ADOT Collector follows the OpenTelemetry standard. By default, the ADOT Lambda Layer uses <a href="https://github.com/aws-observability/aws-otel-lambda/blob/main/adot/collector/config.yaml" target="_blank" rel="noopener noreferrer">config.yaml</a>, which exports telemetry data to AWS X-Ray. However, ADOT Lambda Layer also supports other exporters, which enables you to send metrics and traces to other destinations. Find the complete list of available components supported for custom configuration <a href="https://github.com/aws-observability/aws-otel-lambda/blob/main/README.md#adot-lambda-layer-available-components" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-amazon-managed-service-for-prometheus-amp"><strong>Integration with Amazon Managed Service for Prometheus (AMP)</strong><a href="#integration-with-amazon-managed-service-for-prometheus-amp" class="hash-link" aria-label="Direct link to integration-with-amazon-managed-service-for-prometheus-amp" title="Direct link to integration-with-amazon-managed-service-for-prometheus-amp">​</a></h2>
<p>You can use custom collector configuration to export metrics from your Lambda function to Amazon Managed Prometheus (AMP).</p>
<ol>
<li>Follow the steps from auto-instrumentation above, to configure Lambda Layer, set Environment variable <code>AWS_LAMBDA_EXEC_WRAPPER</code>.</li>
<li>Follow the <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-onboard-create-workspace.html" target="_blank" rel="noopener noreferrer">instructions</a> to create Amazon Manager Prometheus workspace in your AWS account, where your Lambda function will be sending metrics to. Make a note of the <code>Endpoint - remote write URL</code> from the AMP workspace. You would need that to be configured on ADOT collector configuration.</li>
<li>Create a custom ADOT collector configuration file (say <code>collector.yaml</code>) in your Lambda function&#x27;s root directory with details of AMP endpoint remote write URL from previous step. You can also load the configuration file from S3 bucket.
Sample ADOT collector configuration file:</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#collector.yaml in the root directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Set an environemnt variable &#x27;OPENTELEMETRY_COLLECTOR_CONFIG_FILE&#x27; to &#x27;/var/task/collector.yaml&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extensions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sigv4auth:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service: &quot;aps&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    region: &quot;&lt;workspace_region&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">receivers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  otlp:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocols:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      grpc:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      http:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exporters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logging:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prometheusremotewrite:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    endpoint: &quot;&lt;workspace_remote_write_url&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    namespace: test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auth:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      authenticator: sigv4auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  extensions: [sigv4auth]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pipelines:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    traces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      receivers: [otlp]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      exporters: [awsxray]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      receivers: [otlp]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      exporters: [logging, prometheusremotewrite]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Prometheus Remote Write Exporter can also be configured with retry, and timeout settings. For more information see the <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/exporter/prometheusremotewriteexporter/README.md" target="_blank" rel="noopener noreferrer">documentation</a>. <strong><code>Note</code></strong> Service value for <code>sigv4auth</code> extension should be <code>aps</code> (amazon prometheus service). Also, Make sure your Lambda function execution role has the required AMP permissions. For more information on permissions and policies required on AMP for AWS Lambda, see the AWS Managed Service for Prometheus <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-and-IAM.html#AMP-IAM-policies-built-in" target="_blank" rel="noopener noreferrer">documentation</a>.</p>
<ol start="4">
<li>Add an environment variable <code>OPENTELEMETRY_COLLECTOR_CONFIG_FILE</code> and set value to the path of configuration file. E.g.  /var/task/<code>&lt;path to config file&gt;</code>.yaml. This will tell the Lambda Layer extension where to find the collector configuration.</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Function:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type: AWS::Serverless::Function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Variables:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          OPENTELEMETRY_COLLECTOR_CONFIG_FILE: /var/task/collector.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>Update your Lambda function code to add metrics using OpenTelemetry Metrics API. Check out examples here.</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// get meter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Meter meter = GlobalOpenTelemetry.getMeterProvider()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .meterBuilder(&quot;aws-otel&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .setInstrumentationVersion(&quot;1.0&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Build counter e.g. LongCounter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LongCounter counter = meter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .counterBuilder(&quot;processed_jobs&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .setDescription(&quot;Processed jobs&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .setUnit(&quot;1&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// It is recommended that the API user keep a reference to Attributes they will record against</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Attributes attributes = Attributes.of(stringKey(&quot;Key&quot;), &quot;SomeWork&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Record data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">counter.add(123, attributes);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pros-and-cons-of-using-adot-lambda-layer"><strong>Pros and Cons of using ADOT Lambda Layer</strong><a href="#pros-and-cons-of-using-adot-lambda-layer" class="hash-link" aria-label="Direct link to pros-and-cons-of-using-adot-lambda-layer" title="Direct link to pros-and-cons-of-using-adot-lambda-layer">​</a></h2>
<p>If you intend to send traces to AWS X-Ray from Lambda function, you can either use <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-nodejs.html" target="_blank" rel="noopener noreferrer">X-Ray SDK</a> or  <a href="https://aws-otel.github.io/docs/getting-started/lambda" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry (ADOT) Lambda Layer</a>. While X-Ray SDK supports easy instrumentation of various AWS services, it can only send traces to X-Ray. Whereas, ADOT collector, which is included as part of the Lambda Layer supports large number of library instrumentations for each language. You can use it to collect and send metrics and traces to AWS X-Ray and other monitoring solutions, such as Amazon CloudWatch, Amazon OpenSearch Service, Amazon Managed Service for Prometheus and other <a href="https://aws-otel.github.io/docs/components/otlp-exporter#appdynamics" target="_blank" rel="noopener noreferrer">partner</a> solutions.</p>
<p>However, due to the flexibility ADOT offers, your Lambda function may require additional memory and can experience notable impact on cold start latency. So, if you are optimizing your Lambda function for low-latency and do not need advanced features of OpenTelemetry, using AWS X-Ray SDK over ADOT might be more suitable. For detailed comparison and guidance on choosing the right tracing tool, refer to AWS docs on <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-instrumenting-your-app.html#xray-instrumenting-choosing" target="_blank" rel="noopener noreferrer">choosing between ADOT and X-Ray SDK</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="managing-cold-start-latency-when-using-adot"><strong>Managing cold start latency when using ADOT</strong><a href="#managing-cold-start-latency-when-using-adot" class="hash-link" aria-label="Direct link to managing-cold-start-latency-when-using-adot" title="Direct link to managing-cold-start-latency-when-using-adot">​</a></h2>
<p>ADOT Lambda Layer for Java is agent-based, which means that when you enable auto-instrumentation, Java Agent will try to instrument all the OTel <a href="https://github.com/open-telemetry/opentelemetry-java-instrumentation/tree/main/instrumentation" target="_blank" rel="noopener noreferrer">supported</a> libraries. This will increase the Lambda function cold start latency significantly. So, we recommend that you only enable auto-instrumentation for the libraries/frameworks that are used by your application.</p>
<p>To enable only specific instrumentations, you can use the following environment variables:</p>
<ul>
<li><code>OTEL_INSTRUMENTATION_COMMON_DEFAULT_ENABLED</code>: when set to false, disables auto-instrumentation in the Layer, requiring each instrumentation to be enabled individually.</li>
<li><code>OTEL_INSTRUMENTATION_&lt;NAME&gt;_ENABLED</code>: set to true to enable auto-instrumentation for a specific library or framework. Replace &quot;NAME&quot; by the instrumentation that you want to enable. For the list of available instrumentations, see Suppressing specific agent instrumentation.</li>
</ul>
<p>For example, to only enable auto-instrumentation for Lambda and the AWS SDK, you would set the following environment variables:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">OTEL_INSTRUMENTATION_COMMON_DEFAULT_ENABLED=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OTEL_INSTRUMENTATION_AWS_LAMBDA_ENABLED=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OTEL_INSTRUMENTATION_AWS_SDK_ENABLED=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="additional-resources"><strong>Additional Resources</strong><a href="#additional-resources" class="hash-link" aria-label="Direct link to additional-resources" title="Direct link to additional-resources">​</a></h2>
<ul>
<li><a href="https://opentelemetry.io" target="_blank" rel="noopener noreferrer">OpenTelemetry</a></li>
<li><a href="https://aws-otel.github.io/docs/introduction" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry (ADOT)</a></li>
<li><a href="https://aws-otel.github.io/docs/getting-started/lambda" target="_blank" rel="noopener noreferrer">ADOT Lambda Layer</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary"><strong>Summary</strong><a href="#summary" class="hash-link" aria-label="Direct link to summary" title="Direct link to summary">​</a></h2>
<p>In this observability best practice guide for AWS Lambda based serverless application using Open Source technologies, we covered AWS Distro for OpenTelemetry (ADOT) and Lambda Layer and how you can use it instrument your AWS Lambda functions. We covered how you can easily enable auto-instrumentation as well as customize the ADOT collector with simple configuration to send observability signals to multiple destinations. We highlighted pros and cons of using ADOT and how it can impact cold start latency for your Lambda function and also recommended best practices to manage cold-start times. By adopting these best practices, you can instrument your applications just once to send logs, metrics and traces to multiple monitoring solutions in a vendor agnostic way.</p>
<p>For further deep dive, we would highly recommend you to practice AWS managed open-source Observability module of <a href="https://catalog.workshops.aws/observability/en-US" target="_blank" rel="noopener noreferrer">AWS One Observability Workshop</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/aws-observability/observability-best-practices/blob/main/docusaurus/docs/guides/serverless/oss/lambda-based-observability-adot.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/observability-best-practices/guides/serverless/aws-native/lambda-based-observability"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">AWS Lambda based Serverless Observability</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/observability-best-practices/guides/hybrid-and-multicloud"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Best practices for hybrid and multicloud</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#key-topics-covered" class="table-of-contents__link toc-highlight"><strong>Key topics covered</strong></a></li><li><a href="#introduction-to-aws-distro-for-opentelemetry-adot" class="table-of-contents__link toc-highlight"><strong>Introduction to AWS Distro for OpenTelemetry (ADOT)</strong></a></li><li><a href="#auto-instrumentation-using-adot-lambda-layer-with-aws-lambda" class="table-of-contents__link toc-highlight"><strong>Auto-instrumentation using ADOT Lambda Layer with AWS Lambda</strong></a></li><li><a href="#custom-configuration-support-for-adot-collector" class="table-of-contents__link toc-highlight"><strong>Custom configuration support for ADOT Collector</strong></a></li><li><a href="#integration-with-amazon-managed-service-for-prometheus-amp" class="table-of-contents__link toc-highlight"><strong>Integration with Amazon Managed Service for Prometheus (AMP)</strong></a></li><li><a href="#pros-and-cons-of-using-adot-lambda-layer" class="table-of-contents__link toc-highlight"><strong>Pros and Cons of using ADOT Lambda Layer</strong></a></li><li><a href="#managing-cold-start-latency-when-using-adot" class="table-of-contents__link toc-highlight"><strong>Managing cold start latency when using ADOT</strong></a></li><li><a href="#additional-resources" class="table-of-contents__link toc-highlight"><strong>Additional Resources</strong></a></li><li><a href="#summary" class="table-of-contents__link toc-highlight"><strong>Summary</strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2025.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>