<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/containers/aws-native/eks/eks-api-server-monitoring" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Amazon EKS API サーバーのモニタリング | AWS Observability best practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-observability.github.io/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Amazon EKS API サーバーのモニタリング | AWS Observability best practices"><meta data-rh="true" name="description" content="このオブザーバビリティのベストプラクティスガイドのセクションでは、API サーバーのモニタリングに関連する以下のトピックについて詳しく説明します。"><meta data-rh="true" property="og:description" content="このオブザーバビリティのベストプラクティスガイドのセクションでは、API サーバーのモニタリングに関連する以下のトピックについて詳しく説明します。"><link data-rh="true" rel="icon" href="/observability-best-practices/ja/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-observability.github.io/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/docs/guides/containers/aws-native/eks/eks-api-server-monitoring" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring" hreflang="ja"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/docs/guides/containers/aws-native/eks/eks-api-server-monitoring" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/observability-best-practices/ja/blog/rss.xml" title="AWS Observability best practices RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/observability-best-practices/ja/blog/atom.xml" title="AWS Observability best practices Atom Feed"><link rel="stylesheet" href="/observability-best-practices/ja/assets/css/styles.2859e3e9.css">
<script src="/observability-best-practices/ja/assets/js/runtime~main.dd3cafa4.js" defer="defer"></script>
<script src="/observability-best-practices/ja/assets/js/main.77fb91b4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/observability-best-practices/ja/"><div class="navbar__logo"><img src="/observability-best-practices/ja/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/observability-best-practices/ja/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AWS Observability Best Practices</b></a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/docs/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/observability-best-practices/ja/docs/guides/">Guides</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/docs/signals/alarms">Signals</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/docs/tools/observability_accelerator">Tools</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/docs/recipes/">Recipes</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/docs/faq/adot">FAQ</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/docs/patterns/multiaccount">Patterns</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/docs/contributors">Contributors</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>日本語</a><ul class="dropdown__menu"><li><a href="/observability-best-practices/docs/guides/containers/aws-native/eks/eks-api-server-monitoring" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ja">日本語</a></li></ul></div><a href="https://github.com/aws-observability/observability-best-practices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/observability-best-practices/ja/docs/guides/">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/docs/guides/">ベストプラクティスの概要</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/docs/guides/choosing-a-tracing-agent">トレーシングエージェントの選択</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/docs/guides/cost/kubecost">Cost</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/docs/guides/databases/rds-and-aurora">Databases</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/docs/guides/ec2-monitoring">EC2 Monitoring and Observability</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/docs/guides/containers/aws-native/ecs/best-practices-metrics-collection-1">ECS best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">EKS best practices</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">AWS Native</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">Amazon CloudWatch Container Insights</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/log-aggregation">ログ集約</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring">Amazon EKS API サーバーのモニタリング</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/container-tracing-with-aws-xray">AWS X-Ray によるコンテナトレーシング</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/docs/guides/containers/oss/eks/best-practices-metrics-collection">Open Source</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/docs/guides/serverless/aws-native/lambda-based-observability">Serverless best practices</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/docs/guides/hybrid-and-multicloud">ハイブリッドとマルチクラウドのためのベストプラクティス</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/docs/guides/operational/adot-at-scale/operating-adot-collector">Operational</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/docs/guides/signal-collection/emf">Signal collection</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/docs/guides/partners/databricks">Partners</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/docs/guides/observability-maturity-model">AWS オブザーバビリティ成熟度モデル</a></li></ul></li></ul></nav><button type="button" title="サイドバーを隠す" aria-label="サイドバーを隠す" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/observability-best-practices/ja/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">EKS best practices</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AWS Native</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Amazon EKS API サーバーのモニタリング</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><h1>Amazon EKS API サーバーのモニタリング</h1>
<p>このオブザーバビリティのベストプラクティスガイドのセクションでは、API サーバーのモニタリングに関連する以下のトピックについて詳しく説明します。</p>
<ul>
<li>Amazon EKS API サーバーのモニタリングの紹介</li>
<li>API サーバーのトラブルシューティングダッシュボードの設定</li>
<li>API トラブルシューティングダッシュボードを使用した API サーバーの問題の理解</li>
<li>API サーバーへの無制限なリスト呼び出しの理解</li>
<li>API サーバーへの悪影響を及ぼす動作の停止</li>
<li>API の優先順位と公平性</li>
<li>最も遅い API 呼び出しと API サーバーのレイテンシの問題の特定</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="はじめに">はじめに<a class="hash-link" aria-label="はじめに への直接リンク" title="はじめに への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#はじめに">​</a></h3>
<p>Amazon EKS で管理されるコントロールプレーンのモニタリングは、EKS クラ  スターの正常性に関する問題を事前に特定するための非常に重要な Day 2 運用アクティビティです。 Amazon EKS コントロールプレーンモニタリングにより、収集されたメトリクスに基づいて予防措置を講じることができます。 これらのメトリクスは、API サーバーのトラブルシューティングと、内部の問題の特定に役立ちます。</p>
<p>このセクションでは、Amazon EKS API サーバーモニタリングのデモンストレーションに Amazon Managed Service for Prometheus(AMP) とメトリクスの可視化に Amazon Managed Grafana(AMG) を使用します。 Prometheus は、強力なクエリ機能を備え、さまざまなワークロードで広くサポートされている一般的なオープンソースのモニタリングツールです。 Amazon Managed Service for Prometheus は、Amazon EKS、Amazon Elastic Container Service(Amazon ECS)、Amazon Elastic Compute Cloud(Amazon EC2)などの環境を安全かつ信頼性高くモニタリングするのに役立つ、完全マネージドの Prometheus 互換サービスです。 Amazon Managed Grafana は、オープンソースの Grafana の完全マネージドかつセキュアなデータ可視化サービスで、アプリケーションの運用メトリクス、ログ、トレースを複数のデータソースから即座にクエリ、相関分析、可視化できます。</p>
<p>まず、Amazon Managed Service for Prometheus と Amazon Managed Grafana を使用してスターターダッシュボードを設定し、Prometheus で <a href="https://aws.amazon.com/eks" target="_blank" rel="noopener noreferrer">Amazon Elastic Kubernetes Service(Amazon EKS)</a> API サーバーのトラブルシューティングを支援します。 次のセクションでは、EKS API サーバーのトラブルシューティング時の問題の理解、API の優先順位と公平性、悪い動作の停止について詳しく説明しま す。 最後に、最も遅い API 呼び出しと API サーバーレイテンシの問題を特定して、Amazon EKS クラスターの状態を正常に保つためのアクションを実行できるようになります。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-サーバーのトラブルシューティング用ダッシュボードの設定">API サーバーのトラブルシューティング用ダッシュボードの設定<a class="hash-link" aria-label="API サーバーのトラブルシューティング用ダッシュボードの設定 への直接リンク" title="API サーバーのトラブルシューティング用ダッシュボードの設定 への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#api-サーバーのトラブルシューティング用ダッシュボードの設定">​</a></h3>
<p>AMP を使用して <a href="https://aws.amazon.com/eks" target="_blank" rel="noopener noreferrer">Amazon Elastic Kubernetes Service(Amazon EKS)</a> API サーバーのトラブルシューティングを支援するためのスターターダッシュボードを設定します。これにより、本番 EKS クラスターのトラブルシューティング時にメトリクスを理解するのに役立ちます。収集されたメトリクスに深く注目して、Amazon EKS クラスターのトラブルシューティング時にその重要性を理解します。</p>
<p>まず、<a href="https://aws.amazon.com/blogs/containers/metrics-and-traces-collection-using-amazon-eks-add-ons-for-aws-distro-for-opentelemetry/" target="_blank" rel="noopener noreferrer">ADOT コレクターを設定して、Amazon EKS クラスターからメトリクスを Amazon Managed Service for Prometheus に収集します</a>。この設定では、EKS ADOT アドオンを使用します。これにより、EKS クラスターがアップおよび実行された後いつでも ADOT をアドオンとして有効にでき ます。ADOT アドオンには最新のセキュリティパッチとバグ修正が含まれており、Amazon EKS で動作することが AWS によって検証されています。この設定では、EKS クラスターに ADOT アドオンをインストールする方法と、それを使用してクラスターからメトリクスを収集する方法を示します。</p>
<p>次に、最初のステップで設定した AMP をデータソースとして使用して、<a href="https://aws.amazon.com/blogs/mt/amazon-managed-grafana-getting-started/" target="_blank" rel="noopener noreferrer">Amazon Managed Grafana ワークスペースを設定してメトリクスを可視化します</a>。最後に、<a href="https://github.com/RiskyAdventure/Troubleshooting-Dashboards/blob/main/api-troubleshooter.json" target="_blank" rel="noopener noreferrer">API トラブルシューターダッシュボード</a> をダウンロードし、Amazon Managed Grafana に移動して、API トラブルシューターダッシュボードの json をアップロードして、さらなるトラブルシューティングのためにメトリクスを可視化します。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-トラブルシューティングダッシュボードを使用して問題を理解する">API トラブルシューティングダッシュボードを使用して問題を理解する<a class="hash-link" aria-label="API トラブルシューティングダッシュボードを使用して問題を理解する への直接リンク" title="API トラブルシューティングダッシュボードを使用して問題を理解する への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#api-トラブルシューティングダッシュボードを使用して問題を理解する">​</a></h3>
<p>クラスタにインストールしたい興味深いオープンソースプロジェクトを見つけたとします。その Operator は DaemonSet をクラスタにデプロイしますが、そこには不適切なリクエスト、不要なほどの高頻度の LIST 呼び出し、あるいは 1,000 ノードのすべてのノード上の各 DaemonSet が毎分クラスタ上の 50,000 ポッドのステータスを要求しているなどの問題が含まれている可能性があります。</p>
<p>こうしたことが本当に頻繁に起こるのでしょうか。はい、そうなのです! なぜそうなるのか、ちょっとした迂回路を見てみましょう。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="list-と-watch-の違いを理解する">LIST と WATCH の違いを理解する<a class="hash-link" aria-label="LIST と WATCH の違いを理解する への直接リンク" title="LIST と WATCH の違いを理解する への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#list-と-watch-の違いを理解する">​</a></h4>
<p>クラスタ内のオブジェクトの状態を理解する必要があるアプリケーションがあります。
たとえば、マシンラーニング(ML)アプリケーションは、<em>Completed</em> ステータスでない Pod の数を理解することでジョブのステータスを知りたいとします。
Kubernetes では、WATCH と呼ばれるものでこれを上手く行う方法があります。また、Pod の最新のステータスを見つけるために、クラスタ上のすべてのオブジェクトをリストするというあまりうまくいかない方法もあります。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="適切に動作する-watch">適切に動作する WATCH<a class="hash-link" aria-label="適切に動作する WATCH への直接リンク" title="適切に動作する WATCH への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#適切に動作する-watch">​</a></h4>
<p>Kubernetes でプッシュモデルによる更新を受信するために WATCH や長期間存続する単一の接続を使用することが、最もスケーラブルな更新方法です。
単純化すると、システムの完全な状態を要求し、そのオブジェクトの変更が受信されたときにのみキャッシュ内のオブジェクトを更新し、更新を見逃していないことを確認するために定期的に再同期を実行します。</p>
<p>下の画像では、<code>apiserver_longrunning_gauge</code> を使用して、両方の API サーバー全体でこれらの長期間存続する接続の数を取得しています。</p>
<p><img decoding="async" loading="lazy" alt="API-MON-1" src="/observability-best-practices/ja/assets/images/api-mon-1-6beca6db67fd83b66ee810e950a174a0.jpg" width="1613" height="361" class="img_ev3q"></p>
<p><em>図: <code>apiserver_longrunning_gauge</code> メトリクス</em></p>
<p>この効率的なシステムであっても、まだ多すぎるほどの良いことができます。
たとえば、非常に小さなノードを多数使用し、API サーバーと通信する必要がある 2 つ以上の DaemonSet を使用している場合、システムの WATCH 呼び出しの数を不必要に劇的に増加させることが非常に簡単です。
たとえば、8 個の xlarge ノードと 1 個の 8xlarge ノードの違いを見てみましょう。
ここでは、システムの WATCH 呼び出しが 8 倍に増加しているのがわかります。</p>
<p><img decoding="async" loading="lazy" alt="API-MON-2" src="/observability-best-practices/ja/assets/images/api-mon-2-319b357b94ac8442fd7e15809db19003.jpg" width="921" height="415" class="img_ev3q"></p>
<p><em>図: 8 個の xlarge ノードの WATCH 呼び出し数。</em></p>
<p>これらは効率的な呼び出しですが、前述の不適切な呼び出しであったとしたらどうでしょうか?
上記の 1,000 ノードのそれぞれにある DaemonSet の 1 つが、クラスター内の合計 50,000 ポッドのそれぞれについて更新を要求していると想像してみてください。
次のセクションでは、この無制限のリスト呼び出しの考え方を探究します。</p>
<p>続ける前に、上記の例のような統合は細心の注意を払って行う必要があり、考慮しなければならない他の多くの要因があることを簡単に警告しておきます。
システムの CPU の限られた数を競うスレッドの遅延の数から、ポッドのチャーンレート、ノードが安全に処理できる最大ボリュームアタッチメントの数まで、あらゆるものがそうです。
しかし、焦点は問題が発生する前に実行できるアクション可能なステップにつながるメトリクスに置かれます。そして、設計についての新しい洞察を与えてくれるかもしれません。</p>
<p>WATCH メトリクスはシンプルなものですが、WATCH の数をトラッキングおよび削減するために使用できます(それがあなたにとっての問題である場合)。
この数を減らすために検討できるいくつかのオプションがあります:</p>
<ul>
<li>Helm が履歴を追跡するために作成する ConfigMap の数を制限する</li>
<li>イミュータブルな ConfigMap と Secret を使用する(WATCH を使用しない)</li>
<li>適切なノードサイズ設定と統合</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-サーバーへの無制限なリストコールの理解">API サーバーへの無制限なリストコールの理解<a class="hash-link" aria-label="API サーバーへの無制限なリストコールの理解 への直接リンク" title="API サーバーへの無制限なリストコールの理解 への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#api-サーバーへの無制限なリストコ  ールの理解">​</a></h3>
<p>これまで説明してきた LIST コールについてです。リストコールは、オブジェクトの状態を理解するたびに、Kubernetes オブジェクトの全履歴を取得するものです。このとき、キャッシュには何も保存されません。</p>
<p>これがどの程度の影響を与えるかは、エージェントの数、データ要求の頻度、要求データ量によって異なります。クラスタ全体を要求しているのか、単一の名前空間だけなのか。それが毎分、すべてのノードで発生するのか。例として、ノードから送信されるすべてのログに Kubernetes のメタデータを追加するロギングエージェントを使用しましょう。これは、大規模なクラスタでは膨大なデータ量になる可能性があります。エージェントがリストコールを介してそのデータを取得する方法は多数ありますので、いくつかを見ていきましょう。</p>
<p>以下のリクエストは、特定の名前空間から Pod を取得しています。</p>
<p><code>/api/v1/namespaces/my-namespace/pods</code></p>
<p>次に、クラスタ上の全 50,000 個の Pod を要求しますが、500 個ずつのチャンクで取得します。</p>
<p><code>/api/v1/pods?limit=500</code></p>
<p>次のコールが最も破壊的です。クラスタ全体の全 50,000 個の Pod を一度に取得しています。</p>
<p><code>/api/v1/pods</code></p>
<p>これは現場でかなり頻繁に発生し、ログで確認できます。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-サーバーへの悪い動作の停止">API サーバーへの悪い動作の停止<a class="hash-link" aria-label="API サーバーへの悪い動作の停止 への直接リンク" title="API サーバーへの悪い動作の停止 への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#api-サーバーへの悪い動作の停止">​</a></h3>
<p>このような悪い動作からクラスターをどのように保護できるでしょうか? Kubernetes 1.20 より前は、API サーバーは 1 秒あたり処理される <em>inflight</em> リクエストの数を制限することによって自身を保護していました。etcd は一度に実行できるリクエスト数には限界があるため、リクエスト数を 1 秒あたりの適切な値に制限し、etcd の読み書きレイテンシを許容範囲内に保つ必要があります。残念ながら、この記事執筆時点では、これを動的に行う方法はありません。</p>
<p>下のチャートでは、デフォルトの最大 400 の inflight リクエスト数と、デフォルトの最大 200 の同時書き込みリクエスト数を持つ、読み取りリクエストの内訳を確認できます。デフォルトの EKS クラスターでは、合計 800 の読み取りと 400 の書き込みを処理できる 2 つの API サーバーがあります。ただし、アップグレード直後など、サーバーに非対称な負荷がかかる時期があることに注意が必要です。</p>
<p><img decoding="async" loading="lazy" alt="API-MON-3" src="/observability-best-practices/ja/assets/images/api-mon-3-1f15dc0e228fff08b1ee9d167b6f7411.jpg" width="1292" height="536" class="img_ev3q"></p>
<p><em>図: 読み取りリクエストの内訳を示す Grafana チャート。</em></p>
<p>上記の方式は完璧なものではないことが判明しました。例えば、API サーバーのすべての inflight 書き込みリクエストを占有し、ノードのキープアライブメッセージなどの重要なリクエストを遅延させる可能性がある、今インストールしたこの悪い動作をする新しい operator からクラスターをどのように保護できるでしょうか。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-の優先順位と公平性">API の優先順位と公平性<a class="hash-link" aria-label="API の優先順位と公平性 への直接リンク" title="API の優先順位と公平性 への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#api-の優先順位と公平性">​</a></h3>
<p>1 秒間に開いている読み取り/書き込みリクエストの数を心配する代わりに、容量を 1 つの全体的な数値として扱い、クラスター上の各アプリケーションがその最大数の公平な割合またはシェアを得ることができたらどうでしょうか。</p>
<p>それを効果的に行うには、API サーバーにリクエストを送信したものを識別し、そのリクエストに名前タグのようなものを付ける必要があります。この新しい名前タグを使用することで、これらのリクエストがすべて、「Chatty」と呼ばれる新しいエージェントからのものであることがわかります。この概念により、これらのリクエストが同じ DaemonSet からのものであることを特定するフローに、Chatty のすべてのリクエストをグループ化できるようになりました。これにより、この悪いエージェントを制限し、クラスター全体を消費しないようにすることができます。</p>
<p>ただし、すべてのリクエストが同じではありません。クラスターを操作可能な状態に保つために必要なコントロールプレーントラフィックは、新しいオペレーターよりも優先度が高くする必要があります。ここで優先度レベルの概念が登場します。クリティカル、高、低の優先度トラフィック用にデフォルトでいくつかの「バケット」またはキューがあるとしたらどうでしょうか。クリティカルなトラフィックキューで、おしゃべりなエージェントフローが公平な  シェアのトラフィックを得ることは望ましくありません。ただし、そのトラフィックを低優先度キューに入れることができます。そうすることで、そのフローはおそらく他のおしゃべりなエージェントと競合することになります。次に、各優先度レベルが、API サーバーが処理できる全体の最大数の適切なシェアまたは割合を持つことを確認する必要があります。これにより、リクエストの遅延が大きくなりすぎないようにできます。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="優先順位と公平性の実践">優先順位と公平性の実践<a class="hash-link" aria-label="優先順位と公平性の実践 への直接リンク" title="優先順位と公平性の実践 への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#優先順位と公平性の実践">​</a></h4>
<p>これは比較的新しい機能なので、多くの既存のダッシュボードは、最大同時読み取り数と最大同時書き込み数の古いモデルを使用しています。なぜこれが問題になる可能性があるのか?</p>
<p>kube-system 名前空間のすべてに高い優先順位の名前タグを付けていたとします。しかし、その重要な名前空間に不適切なエージェントをインストールしたり、単純にその名前空間に過剰にアプリケーションをデプロイした場合はどうなるでしょうか。回避しようとしたのと同じ問題が発生する可能性があります! したがって、このような状況を注意深く監視することが大切です。</p>
<p>この種の問題を追跡するのに最も興味深いメトリクスをいくつか抜粋しました。</p>
<ul>
<li>優先グループのシェアの何パーセントが使用されているか?</li>
<li>リクエストがキューで待機した最長時  間は?</li>
<li>どのフローが最も多くのシェアを使用しているか?</li>
<li>システムに予期しない遅延があるか?</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="使用率のパーセンテージ">使用率のパーセンテージ<a class="hash-link" aria-label="使用率のパーセンテージ への直接リンク" title="使用率のパーセンテージ への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#使用率のパーセンテージ">​</a></h4>
<p>ここでは、クラスター上のさまざまなデフォルトの優先度グループと、最大値の何パーセントが使用されているかが表示されます。</p>
<p><img decoding="async" loading="lazy" alt="API-MON-4" src="/observability-best-practices/ja/assets/images/api-mon-4-fc5a08408f764524f2960e1b0e6d8352.jpg" width="1652" height="424" class="img_ev3q"></p>
<p><em>図: クラスター上の優先度グループ。</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="キュー内のリクエスト時間">キュー内のリクエスト時間<a class="hash-link" aria-label="キュー内のリクエスト時間 への直接リンク" title="キュー内のリクエスト時間 への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#キュー内のリクエスト時間">​</a></h4>
<p>優先キューで処理される前にリクエストが座っていた秒数です。</p>
<p><img decoding="async" loading="lazy" alt="API-MON-5" src="/observability-best-practices/ja/assets/images/api-mon-5-b3d3c2243725460655927eba3379e00f.jpg" width="999" height="369" class="img_ev3q"></p>
<p><em>図: リクエストが優先キュー内にあった時間。</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="フロー別の実行回数上位リクエスト">フロー別の実行回数上位リクエスト<a class="hash-link" aria-label="フロー別 の実行回数上位リクエスト への直接リンク" title="フロー別の実行回数上位リクエスト への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#フロー別の実行回数上位リクエスト">​</a></h4>
<p>どのフローが最も大きなシェアを占めているでしょうか。</p>
<p><img decoding="async" loading="lazy" alt="API-MON-6" src="/observability-best-practices/ja/assets/images/api-mon-6-99bad57bd277923055a5074b247259e1.jpg" width="967" height="371" class="img_ev3q"></p>
<p><em>図: フロー別の実行回数上位リクエスト</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="リクエスト実行時間">リクエスト実行時間<a class="hash-link" aria-label="リクエスト実行時間 への直接リンク" title="リクエスト実行時間 への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#リクエスト実行時間">​</a></h4>
<p>処理に予期しない遅延はありますか?</p>
<p><img decoding="async" loading="lazy" alt="API-MON-7" src="/observability-best-practices/ja/assets/images/api-mon-7-0b77723bbfea585d2bf33f2f43f8cd5e.jpg" width="976" height="369" class="img_ev3q"></p>
<p><em>図: フロー制御リクエスト実行時間。</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="最も遅い-api-呼び出しと-api-サーバーのレイテンシー問題の特定">最も遅い API 呼び出しと API サーバーのレイテンシー問題の特定<a class="hash-link" aria-label="最も遅い API 呼び出しと API サーバーのレイテンシー問題の特定 への直接リンク" title="最も遅い API 呼び出しと API サーバーのレイテンシー問題の特定 への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#最も遅い-api-呼び出しと-api-サーバーのレイテンシー問題 の特定">​</a></h3>
<p>API のレイテンシーを引き起こす要因の性質を理解したので、大局的な視点で問題を見直すことができます。ダッシュボードの設計は単に、調査が必要な問題があるかどうかを簡単に確認するスナップショットを取得しようとしていることを忘れてはいけません。詳細な分析には、ad-hoc クエリで PromQL を使用するか、ログクエリを使用するのが望ましいでしょう。</p>
<p>高レベルのメトリクスとして確認したいアイデアは何でしょうか。</p>
<ul>
<li>最も時間のかかる API 呼び出しは何ですか?<!-- -->
<ul>
<li>その呼び出しは何をしているのですか? (オブジェクトの一覧表示、削除など)</li>
<li>その操作の対象となっているオブジェクトは何ですか? (Pod、Secret、ConfigMap など)</li>
</ul>
</li>
<li>API サーバー自体にレイテンシーの問題がありますか?<!-- -->
<ul>
<li>優先キューの 1 つで遅延が発生し、リクエストのバックアップが発生していますか?</li>
</ul>
</li>
<li>API サーバーが遅いように見えるのは、etcd サーバーがレイテンシーを経験しているためですか?</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="最も遅い-api-呼び出し">最も遅い API 呼び出し<a class="hash-link" aria-label="最も遅い API 呼び出し への直接リンク" title="最も遅い API 呼び出し への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#最も遅い-api-呼び出し">​</a></h4>
<p>以下のチャートでは、その期間で完了するのに最も時間がかかった API 呼び出しを探しています。この場合、05:40 の時間帯で最も待ち時間の長い呼び出しである LIST 関数をカスタムリソース定義 (CRD) が呼び出していることがわかります。このデータを使って、CloudWatch Insights でその時間帯の監査ログから LIST リクエストを引き出し、どのアプリケーションかを確認できます。</p>
<p><img decoding="async" loading="lazy" alt="API-MON-8" src="/observability-best-practices/ja/assets/images/api-mon-8-b05232ee0fadf479574e6e80f429825d.jpg" width="941" height="409" class="img_ev3q"></p>
<p><em>図: 上位 5 つの最も遅い API 呼び出し</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="api-リクエストの所要時間">API リクエストの所要時間<a class="hash-link" aria-label="API リクエストの所要時間 への直接リンク" title="API リクエストの所要時間 への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#api-リクエストの所要時間">​</a></h4>
<p>この API レイテンシーチャートは、1 分のタイムアウト値に近づいているリクエストがあるかどうかを理解するのに役立ちます。以下の時間経過によるヒストグラム形式が好きです。これにより、線グラフでは隠れてしまうデータの外れ値が確認できます。</p>
<p><img decoding="async" loading="lazy" alt="API-MON-9" src="/observability-best-practices/ja/assets/images/api-mon-9-90c5abd6685cd0b05e2f38876d648d2a.jpg" width="845" height="416" class="img_ev3q"></p>
<p><em>図: API リクエスト期間のヒートマップ。</em></p>
<p>バケットをホバーするだけで、約 25 ミリ秒かかった呼び出しの正確な数を確認できます。
[Image: Image.jpg]<em>図: 25 ミリ秒以上かかった呼び出し。</em></p>
<p>この概念は、リクエストをキャッシュする他のシステムで動作しているときに重要です。キャッシュリクエストは高速です。低速なリクエストのレイテンシとキャッシュリクエストのレイテンシをマージしたくありません。ここでは、キャッシュされた  リクエストとキャッシュされていないリクエストの2つの明確なレイテンシーバンドが確認できます。</p>
<p><img decoding="async" loading="lazy" alt="API-MON-10" src="/observability-best-practices/ja/assets/images/api-mon-10-951cb182ad00cf55c12c569f53a8f6f7.jpg" width="774" height="229" class="img_ev3q"></p>
<p><em>図: レイテンシー、キャッシュされたリクエスト。</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="etcd-リクエスト期間">ETCD リクエスト期間<a class="hash-link" aria-label="ETCD リクエスト期間 への直接リンク" title="ETCD リクエスト期間 への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#etcd-リクエスト期間">​</a></h4>
<p>ETCD のレイテンシは、Kubernetes のパフォーマンスにおいて最も重要な要因の 1 つです。Amazon EKS では、<code>request_duration_seconds_bucket</code> メトリクスを見ることで、API サーバーの視点からこのパフォーマンスを確認できます。</p>
<p><img decoding="async" loading="lazy" alt="API-MON-11" src="/observability-best-practices/ja/assets/images/api-mon-11-41907cb5ef379332cd272ba6e67191e6.jpg" width="886" height="440" class="img_ev3q"></p>
<p><em>図: <code>request_duration_seconds_bucket</code> メトリクス</em></p>
<p>これまで学んできたことを、特定のイベントが相関しているかどうかを確認することで組み合わせることができます。下のチャートでは、API サーバーのレイテンシを確認できますが、このレイテンシの多くが etcd サーバーから発生していることもわかります。ひと目で正しい問題領域にすばやく移動できることが、ダッシュボードを強力にしています。</p>
<p><img decoding="async" loading="lazy" alt="API-MON-12" src="/observability-best-practices/ja/assets/images/api-mon-12-ce420a9849f95a4d8d12af13860b91c8.jpg" width="871" height="473" class="img_ev3q"></p>
<p><em>図: ETCD リクエスト</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#まとめ">​</a></h2>
<p>このオブザーバビリティのベストプラクティスガイドのセクションでは、<a href="https://aws.amazon.com/eks" target="_blank" rel="noopener noreferrer">Amazon Elastic Kubernetes Service(Amazon EKS)</a> API サーバーのトラブルシューティングに役立つように、Amazon Managed Service for Prometheus と Amazon Managed Grafana を使用した<a href="https://github.com/RiskyAdventure/Troubleshooting-Dashboards/blob/main/api-troubleshooter.json" target="_blank" rel="noopener noreferrer">スターターダッシュボード</a> を使用しました。さらに、EKS API サーバーのトラブルシューティング中に発生する問題の理解、API の優先順位と公平性、悪い動作の停止について深く掘り下げました。最後に、最も遅い API 呼び出しと、Amazon EKS クラスターの状態を健全に保つためのアクションを取るのに役立つ API サーバーレイテンシの問題を特定することについて深く掘り下げました。さらなる深掘りのために、AWS ネイティブのオブザーバビリティカテゴリの AWS <a href="https://catalog.workshops.aws/observability/en-US" target="_blank" rel="noopener noreferrer">One Observability ワークショップ</a> のアプリケーションモニタリングモジュールを実践することを強くおすすめします。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/aws-observability/observability-best-practices/docs/guides/containers/aws-native/eks/eks-api-server-monitoring.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/log-aggregation"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">ログ集約</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/container-tracing-with-aws-xray"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">AWS X-Ray によるコンテナトレーシング</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#はじめに">はじめに</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#api-サーバーのトラブルシューティング用ダッシュボードの設定">API サーバーのトラブルシューティング用ダッシュボードの設定</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#api-トラブルシュー  ティングダッシュボードを使用して問題を理解する">API トラブルシューティングダッシュボードを使用して問題を理解する</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#api-サーバーへの無制限なリストコールの理解">API サーバーへの無制限なリストコールの理解</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#api-サーバーへの悪い動作の停止">API サーバーへの悪い動作の停止</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#api-の優先順位と公平性">API の優先順位と公平性</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#最も遅い-api-呼び出しと-api-サーバーのレイテンシー問題の特定">最も遅い API 呼び出しと API サーバーのレイテンシー問題の特定</a></li><li><a class="table-of-contents__link toc-highlight" href="/observability-best-practices/ja/docs/guides/containers/aws-native/eks/eks-api-server-monitoring#まとめ">まとめ</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2024.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>