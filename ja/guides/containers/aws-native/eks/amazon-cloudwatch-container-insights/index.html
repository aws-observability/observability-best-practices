<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/containers/aws-native/eks/amazon-cloudwatch-container-insights" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Amazon CloudWatch Container Insights | AWS Observability Best Practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aws-observability.github.io/observability-best-practices/ja/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Amazon CloudWatch Container Insights | AWS Observability Best Practices"><meta data-rh="true" name="description" content="Observability のベストプラクティスガイドのこのセクションでは、Amazon CloudWatch Container Insights に関連する以下のトピックについて詳しく説明します："><meta data-rh="true" property="og:description" content="Observability のベストプラクティスガイドのこのセクションでは、Amazon CloudWatch Container Insights に関連する以下のトピックについて詳しく説明します："><link data-rh="true" rel="icon" href="/observability-best-practices/ja/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aws-observability.github.io/observability-best-practices/ja/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights" hreflang="en"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/ja/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights" hreflang="ja"><link data-rh="true" rel="alternate" href="https://aws-observability.github.io/observability-best-practices/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/observability-best-practices/ja/blog/rss.xml" title="AWS Observability Best Practices RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/observability-best-practices/ja/blog/atom.xml" title="AWS Observability Best Practices Atom Feed"><link rel="stylesheet" href="/observability-best-practices/ja/assets/css/styles.e835fd1b.css">
<script src="/observability-best-practices/ja/assets/js/runtime~main.d48eceaf.js" defer="defer"></script>
<script src="/observability-best-practices/ja/assets/js/main.da851f34.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/observability-best-practices/ja/"><div class="navbar__logo"><img src="/observability-best-practices/ja/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/observability-best-practices/ja/img/logo.svg" alt="AWS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">AWS Observability Best Practices</b></a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/home">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/observability-best-practices/ja/guides/">Guides</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/signals/logs">Signals</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/tools/observability_accelerator">Tools</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/recipes/">Recipes</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/faq/general">FAQ</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/patterns/Tracing/xrayec2">Patterns</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/persona/cloud_engineer">Persona</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/resources/">Resources</a><a class="navbar__item navbar__link" href="/observability-best-practices/ja/contributors">Contributors</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>日本語</a><ul class="dropdown__menu"><li><a href="/observability-best-practices/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/observability-best-practices/ja/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ja">日本語</a></li></ul></div><a href="https://github.com/aws-observability/observability-best-practices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ダークモードを切り替える(現在はライトモード)" aria-label="ダークモードを切り替える(現在はライトモード)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/observability-best-practices/ja/guides/">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/guides/">ベストプラクティスの概要</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/guides/choosing-a-tracing-agent">トレーシングエージェントの選択</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/guides/cost/kubecost">Cost</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/guides/databases/rds-and-aurora">Databases</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/guides/ec2-monitoring">EC2 のモニタリングとオブザーバビリティ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/guides/containers/aws-native/ecs/best-practices-metrics-collection-1">ECS best practices</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/observability-best-practices/ja/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">EKS best practices</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/observability-best-practices/ja/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">AWS Native</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/observability-best-practices/ja/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights">Amazon CloudWatch Container Insights</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/guides/containers/aws-native/eks/log-aggregation">ログ集約</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/guides/containers/aws-native/eks/eks-api-server-monitoring">Amazon EKS API サーバーのモニタリング</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/guides/containers/aws-native/eks/container-tracing-with-aws-xray">AWS X-Ray によるコンテナトレーシング</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/guides/containers/oss/eks/best-practices-metrics-collection">Open Source</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/guides/serverless/aws-native/lambda-based-observability">Serverless best practices</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/guides/hybrid-and-multicloud">ハイブリッドおよびマルチクラウドのベストプラクティス</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/guides/operational/adot-at-scale/operating-adot-collector">Operational</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/guides/signal-collection/emf">Signal collection</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/observability-best-practices/ja/guides/partners/databricks">Partners</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/guides/observability-maturity-model">AWS オブザーバビリティ成熟度モデル</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/observability-best-practices/ja/guides/cloudwatch_cross_account_observability">CloudWatch Cross-Account Observability</a></li></ul></li></ul></nav><button type="button" title="サイドバーを隠す" aria-label="サイドバーを隠す" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/observability-best-practices/ja/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">EKS best practices</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AWS Native</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Amazon CloudWatch Container Insights</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>Amazon CloudWatch Container Insights</h1></header>
<p>Observability のベストプラクティスガイドのこのセクションでは、Amazon CloudWatch Container Insights に関連する以下のトピックについて詳しく説明します：</p>
<ul>
<li>Amazon CloudWatch Container Insights の概要</li>
<li>AWS Distro for OpenTelemetry を使用した Amazon CloudWatch Container Insights の活用</li>
<li>Amazon EKS 向け CloudWatch Container Insights における Fluent Bit の統合</li>
<li>Amazon EKS 上の Container Insights によるコスト削減</li>
<li>EKS Blueprints を使用した Container Insights のセットアップ</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="はじめに">はじめに<a href="#はじめに" class="hash-link" aria-label="はじめに への直接リンク" title="はじめに への直接リンク">​</a></h3>
<p><a href="https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/ContainerInsights.html" target="_blank" rel="noopener noreferrer">Amazon CloudWatch Container Insights</a> は 、コンテナ化されたアプリケーションやマイクロサービスからメトリクスとログを収集、集約、要約するのに役立ちます。メトリクスデータは、<a href="https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/CloudWatch_Embedded_Metric_Format.html" target="_blank" rel="noopener noreferrer">埋め込みメトリクスフォーマット</a> を使用してパフォーマンスログイベントとして収集されます。これらのパフォーマンスログイベントは、構造化された JSON スキーマを使用しており、高カーディナリティデータを大規模に取り込み、保存することができます。このデータから、CloudWatch はクラスター、ノード、Pod、タスク、サービスレベルで集約されたメトリクスを CloudWatch メトリクスとして作成します。Container Insights が収集するメトリクスは、CloudWatch の自動ダッシュボードで利用できます。Container Insights は、セルフマネージドノードグループ、マネージドノードグループ、AWS Fargate プロファイルを持つ Amazon EKS クラスターで利用可能です。</p>
<p>コスト最適化の観点から、また Container Insights のコスト管理を支援するために、CloudWatch はログデータからすべての可能なメトリクスを自動的に作成するわけではありません。ただし、CloudWatch Logs Insights を使用して生のパフォーマンスログイベントを分析することで、追加のメトリクスやより詳細な粒度を表示できます。Container Insights によって収集されるメトリクスは、カスタムメトリクスとして課金されます。CloudWatch の料金について詳しくは、<a href="https://aws.amazon.com/jp/cloudwatch/pricing/" target="_blank" rel="noopener noreferrer">Amazon CloudWatch の料金</a> をご覧ください。</p>
<p>Amazon EKS では、Container Insights は Amazon が Amazon Elastic Container Registry を通じて提供する <a href="https://gallery.ecr.aws/cloudwatch-agent/cloudwatch-agent" target="_blank" rel="noopener noreferrer">CloudWatch エージェント</a> のコンテナ化バージョンを使用して、クラスター内で実行中のすべてのコンテナを検出します。その後、パフォーマンススタックのあらゆる層でパフォーマンスデータを収集します。Container Insights は、収集するログとメトリクスに対して AWS KMS キーによる暗号化をサポートしています。この暗号化を有効にするには、Container Insights データを受け取るロググループに対して AWS KMS 暗号化を手動で有効にする必要があります。これにより、CloudWatch Container Insights は提供された AWS KMS キーを使用してこのデータを暗号化します。対称キーのみがサポートされており、ロググループの暗号化に非対称 AWS KMS キーはサポートされていません。Container Insights は Linux インスタンスでのみサポートされています。Amazon EKS 用の Container Insights は、<a href="https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/ContainerInsights.html" target="_blank" rel="noopener noreferrer">これらの</a> AWS リージョンでサポートされています。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aws-distro-for-open-telemetry-を使用した-amazon-cloudwatch-container-insights">AWS Distro for Open Telemetry を使用した Amazon CloudWatch Container Insights<a href="#aws-distro-for-open-telemetry-を使用した-amazon-cloudwatch-container-insights" class="hash-link" aria-label="AWS Distro for Open Telemetry を使用した Amazon CloudWatch Container Insights への直接リンク" title="AWS Distro for Open Telemetry を使用した Amazon CloudWatch Container Insights への直接リンク">​</a></h3>
<p>ここでは、Amazon EKS ワークロードから Container Insights メトリクスの収集を可能にするオプションの 1 つである <a href="https://aws-otel.github.io/docs/introduction" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry (ADOT)</a> について詳しく見ていきます。<a href="https://aws-otel.github.io/docs/introduction" target="_blank" rel="noopener noreferrer">AWS Distro for OpenTelemetry (ADOT)</a> は、<a href="https://opentelemetry.io/docs/" target="_blank" rel="noopener noreferrer">OpenTelemetry</a> プロジェクトの安全で AWS がサポートする配布版です。ADOT を使用すると、ユーザーは一度アプリケーションを計装するだけで、相関のあるメトリクスとトレースを複数の監視ソリューションに送信できます。CloudWatch Container Insights 向けの ADOT サポートにより、お客様は <a href="https://aws.amazon.com/jp/pm/ec2/" target="_blank" rel="noopener noreferrer">Amazon Elastic Cloud Compute</a> (Amazon EC2) 上で実行されている Amazon EKS クラスターから CPU、メモリ、ディスク、ネットワーク使用量などのシステムメトリクスを収集でき、Amazon CloudWatch エージェントと同じ体験を提供します。ADOT Collector は現在、Amazon EKS 向けの CloudWatch Container Insights と Amazon EKS 向けの AWS Fargate プロファイルをサポートしています。お客様は、Amazon EKS クラスターにデプロイされた Pod の CPU やメモリ使用率などのコンテナと Pod のメトリクスを収集し、既存の CloudWatch Container Insights の体験を変更することなく CloudWatch ダッシュボードで表示できるようになりました。これにより、お客様はトラフィックに応じてスケールアップまたはダウンするかどうかを判断し、コストを節約することができます。</p>
<p>ADOT Collector には、レシーバー、プロセッサー、エクスポーターという 3 つの主要なコンポーネントタイプで構成される <a href="https://opentelemetry.io/docs/collector/configuration/" target="_blank" rel="noopener noreferrer">パイプラインの概念</a> があります。<a href="https://opentelemetry.io/docs/collector/configuration/#receivers" target="_blank" rel="noopener noreferrer">レシーバー</a> は、データがコレクターに入る方法です。指定された形式でデータを受け取り、内部形式に変換し、パイプラインで定義された <a href="https://opentelemetry.io/docs/collector/configuration/#processors" target="_blank" rel="noopener noreferrer">プロセッサー</a> と <a href="https://opentelemetry.io/docs/collector/configuration/#exporters" target="_blank" rel="noopener noreferrer">エクスポーター</a> に渡します。プル型またはプッシュ型があります。プロセッサーはオプションのコンポーネントで、受信されてからエクスポートされるまでの間にデータのバッチ処理、フィルタリング、変換などのタスクを実行するために使用されます。エクスポーターは、メトリクス、ログ、またはトレースを送信する宛先を決定するために使用されます。コレクターのアーキテクチャでは、YAML 設定を通じてこのようなパイプラインの複数のインスタンスを定義できます。以下の図は、Amazon EKS および Fargate プロファイル付きの Amazon EKS にデプロイされた ADOT Collector インスタンスのパイプラインコンポーネントを示しています。</p>
<p><img decoding="async" loading="lazy" alt="CW-ADOT-EKS" src="/observability-best-practices/ja/assets/images/cw-adot-collector-pipeline-eks-a57495e3ee941a7dc20d9239727c5e9e.jpg" width="1648" height="1096" class="img_ev3q"></p>
<p><em>図: Amazon EKS にデプロイされた ADOT Collector インスタンスのパイプラインコンポーネント</em></p>
<p>上記のアーキテクチャでは、パイプラインで <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/awscontainerinsightreceiver" target="_blank" rel="noopener noreferrer">AWS Container Insights Receiver</a> のインスタンスを使用し、Kubelet から直接メトリクスを収集しています。AWS Container Insights Receiver (<code>awscontainerinsightreceiver</code>) は、<a href="https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/ContainerInsights.html" target="_blank" rel="noopener noreferrer">CloudWatch Container Insights</a> をサポートする AWS 固有のレシーバーです。CloudWatch Container Insights は、コンテナ化されたアプリケーションとマイクロサービスからメトリクスとログを収集、集約、要約します。データは <a href="https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/CloudWatch_Embedded_Metric_Format.html" target="_blank" rel="noopener noreferrer">埋め込みメトリクスフォーマット</a> を使用してパフォーマンスログイベントとして収集されます。EMF データから、Amazon CloudWatch はクラスター、ノード、Pod、タスク、サービスレベルで集約された CloudWatch メトリクスを作成できます。以下は <code>awscontainerinsightreceiver</code> 設定のサンプル例です：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">receivers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  awscontainerinsightreceiver:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # すべてのパラメータはオプションです</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    collection_interval: 60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container_orchestrator: eks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_service_as_attribute: true </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prefer_full_pod_name: false </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_full_pod_name_metric_label: false </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これは、上記の設定を使用して Amazon EKS 上にコレクターを DaemonSet としてデプロイすることを意味します。また、このレシーバーが Kubelet から直接収集するより完全なメトリクスセットにアクセスできます。ADOT Collector の複数のインスタンスがあれば、クラスター内のすべてのノードからリソースメトリクスを収集するのに十分です。ADOT コレクターの単一インスタンスは負荷が高い場合に圧倒される可能性があるため、常に複数のコレクターをデプロイすることをお勧めします。</p>
<p><img decoding="async" loading="lazy" alt="CW-ADOT-FARGATE" src="/observability-best-practices/ja/assets/images/cw-adot-collector-pipeline-7ac4d843c5bd5c85f737b1a86e546950.jpg" width="2280" height="1430" class="img_ev3q"></p>
<p><em>図: Fargate プロファイル付きの Amazon EKS にデプロイされた ADOT Collector インスタンスのパイプラインコンポーネント</em></p>
<p>上記のアーキテクチャでは、Kubernetes クラスター内のワーカーノード上の kubelet が、<em>/metrics/cadvisor</em> エンドポイントで CPU、メモリ、ディスク、ネットワーク使用量などのリソースメトリクスを公開しています。しかし、EKS Fargate のネットワークアーキテクチャでは、Pod がそのワーカーノード上の kubelet に直接到達することは許可されていません。そのため、ADOT Collector は Kubernetes API サーバーを呼び出してワーカーノード上の kubelet への接続をプロキシし、そのノード上のワークロードの kubelet の cAdvisor メトリクスを収集します。これらのメトリクスは Prometheus 形式で利用可能です。したがって、コレクターは <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/prometheusreceiver" target="_blank" rel="noopener noreferrer">Prometheus Receiver</a> のインスタンスを Prometheus サーバーの代替として使用し、Kubernetes API サーバーエンドポイントからこれらのメトリクスをスクレイピングします。Kubernetes サービスディスカバリを使用して、レシーバーは EKS クラスター内のすべてのワーカーノードを発見できます。したがって、ADOT Collector の複数のインスタンスがあれば、クラスター内のすべてのノードからリソースメトリクスを収集するのに十分です。ADOT コレクターの単一インスタンスは負荷が高い場合に圧倒される可能性があるため、常に複数のコレクターをデプロイすることをお勧めします。</p>
<p>メトリクス  は、フィルタリング、名前変更、データ集約、変換などを行う一連のプロセッサーを通過します。以下は、上図の Amazon EKS 用 ADOT Collector インスタンスのパイプラインで使用されるプロセッサーのリストです。</p>
<ul>
<li><a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/filterprocessor" target="_blank" rel="noopener noreferrer">Filter Processor</a> は、名前に基づいてメトリクスを含めたり除外したりするための AWS OpenTelemetry ディストリビューションの一部です。メトリクス収集パイプラインの一部として使用して、不要なメトリクスをフィルタリングできます。例えば、Container Insights が Pod レベルのメトリクス（名前のプレフィックスが <code>pod_</code>）のみを収集し、ネットワーキング用のメトリクス（名前のプレフィックスが <code>pod_network</code>）を除外したい場合は以下のようになります。</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">      # 関心のある名前変更されたメトリクスのみをフィルタリング</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      filter:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          include:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            match_type: regexp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            metric_names:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - new_container_.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - pod_.*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/metricstransformprocessor" target="_blank" rel="noopener noreferrer">Metrics Transform Processor</a> は、メトリクスの名前変更、ラベルキーと値の追加、名前変更、削除に使用できます。また、ラベルまたはラベル値全体でメトリクスのスケーリングと集約を実行するためにも使用できます。</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">     metricstransform/rename:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        transforms:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - include: container_spec_cpu_quota</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new_name: new_container_cpu_limit_raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            action: insert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            match_type: regexp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            experimental_match_labels: {&quot;container&quot;: &quot;\\S&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/cumulativetodeltaprocessor" target="_blank" rel="noopener noreferrer">Cumulative to Delta Processor</a> は、単調増加の累積和とヒストグラムメトリクスを単調増加のデルタメトリクスに変換します。非単調増加の和と指数ヒストグラムは除外されます。</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">` # 累積和データポイントをデルタに変換</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> cumulativetodelta:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - pod_cpu_usage_seconds_total </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - pod_network_rx_errors`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/deltatorateprocessor" target="_blank" rel="noopener noreferrer">Delta to Rate Processor</a> は、デルタ和メトリクスをレートメトリクスに変換します。このレートはゲージです。</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">` # デルタをレートに変換</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deltatorate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - pod_memory_hierarchical_pgfault </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - pod_memory_hierarchical_pgmajfault </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - pod_network_rx_bytes </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - pod_network_rx_dropped </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - pod_network_rx_errors </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - pod_network_tx_errors </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - pod_network_tx_packets </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - new_container_memory_pgfault </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - new_container_memory_pgmajfault </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - new_container_memory_hierarchical_pgfault </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - new_container_memory_hierarchical_pgmajfault`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/metricsgenerationprocessor" target="_blank" rel="noopener noreferrer">Metrics Generation Processor</a> は、既存のメトリクスを使用して、与えられたルールに従って新しいメトリクスを作成するために使用できます。</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">      experimental_metricsgeneration/1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - name: pod_memory_utilization_over_pod_limit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            unit: Percent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: calculate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            metric1: pod_memory_working_set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            metric2: pod_memory_limit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            operation: percent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>パイプラインの最後のコンポーネントは <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/awsemfexporter" target="_blank" rel="noopener noreferrer">AWS CloudWatch EMF Exporter</a> で、メトリクスを埋め込みメトリクスフォーマット (EMF) に変換し、<a href="https://docs.aws.amazon.com/ja_jp/AmazonCloudWatchLogs/latest/APIReference/API_PutLogEvents.html" target="_blank" rel="noopener noreferrer">PutLogEvents</a> API を使用して直接 CloudWatch Logs に送信します。以下のメトリクスリストは、Amazon EKS 上で実行されている各ワークロードに対して ADOT Collector によって CloudWatch に送信されます。</p>
<ul>
<li>pod_cpu_utilization_over_pod_limit</li>
<li>pod_cpu_usage_total</li>
<li>pod_cpu_limit</li>
<li>pod_memory_utilization_over_pod_limit</li>
<li>pod_memory_working_set</li>
<li>pod_memory_limit</li>
<li>pod_network_rx_bytes</li>
<li>pod_network_tx_bytes</li>
</ul>
<p>各メトリクスは以下のディメンションセットに関連付けられ、<em>ContainerInsights</em> という名前の CloudWatch 名前空間の下で収集されます。</p>
<ul>
<li>ClusterName, LaunchType</li>
<li>ClusterName, Namespace, LaunchType</li>
<li>ClusterName, Namespace, PodName, LaunchType</li>
</ul>
<p>さらに、[ADOT 向け Container Insight</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="amazon-eks-向け-cloudwatch-container-insights-における-fluent-bit-の統合">Amazon EKS 向け CloudWatch Container Insights における Fluent Bit の統合<a href="#amazon-eks-向け-cloudwatch-container-insights-における-fluent-bit-の統合" class="hash-link" aria-label="Amazon EKS 向け CloudWatch Container Insights における Fluent Bit の統合 への直接リンク" title="Amazon EKS 向け CloudWatch Container Insights における Fluent Bit の統合 への直接リンク">​</a></h3>
<p><a href="https://fluentbit.io/" target="_blank" rel="noopener noreferrer">Fluent Bit</a> は、オープンソースのマルチプラットフォームログプロセッサおよびフォワーダーです。さまざまなソースからデータとログを収集し、統合して CloudWatch Logs を含む異なる送信先に送信することができます。また、<a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker</a> や <a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes</a> 環境とも完全に互換性があります。新しく導入された Fluent Bit デーモンセットを使用することで、EKS クラスターからコンテナログを CloudWatch Logs に送信し、ログの保存と分析を行うことができます。</p>
<p>軽量な特性により、EKS ワーカーノードの Container Insights でデフォルトのログフォワーダーとして Fluent Bit を使用することで、アプリケーションログを効率的かつ確実に CloudWatch Logs にストリーミングできます。Fluent Bit を使用することで、Container Insights は数千の重要なビジネスログをスケーラブルかつリソース効率の高い方法で配信できます。特に Pod レベルでの CPU とメモリ使用量の面で効率的です。言い換えれば、以前使用されていたログフォワーダーである FluentD と比較して、Fluent Bit はリソースフットプリントが小さく、結果としてメモリと CPU のリソース効率が高くなります。一方、Fluent Bit と関連プラグインを含む <a href="https://github.com/aws/aws-for-fluent-bit" target="_blank" rel="noopener noreferrer">AWS for Fluent Bit イメージ</a> は、AWS エコシステム内で統一されたエクスペリエンスを提供することを目的としているため、Fluent Bit に新しい AWS 機能をより迅速に採用する柔軟性を与えています。</p>
<p>以下のアーキテクチャは、EKS 向け CloudWatch Container Insights で使用される個々のコンポーネントを示しています：</p>
<p><img decoding="async" loading="lazy" alt="CW-COMPONENTS" src="/observability-best-practices/ja/assets/images/cw-components-0a6886b7b1f1c933135cc484fe01f3b9.jpg" width="751" height="570" class="img_ev3q"></p>
<p><em>図：EKS 向け CloudWatch Container Insights で使用される個々のコンポーネント</em></p>
<p>コンテナを扱う際は、可能な限りアプリケーションログを含むすべてのログを、Docker JSON ロギングドライバーを使用して標準出力 (stdout) と標準エラー出力 (stderr) を通じてプッシュすることが推奨されます。このため、EKS ではロギングドライバーがデフォルトで設定されており、コンテナ化されたアプリケーションが <code>stdout</code> または <code>stderr</code> に書き込むすべてのものが、ワーカーノードの <code>&quot;/var/log/containers&quot;</code> 下の JSON ファイルにストリーミングされます。Container Insights は、これらのログをデフォルトで 3 つの異なるカテゴリに分類し、Fluent Bit 内に各カテゴリ専用の入力ストリームを作成し、CloudWatch Logs 内に独立したロググループを作成します。これらのカテゴリは以下の通りです：</p>
<ul>
<li>アプリケーションログ：<code>&quot;/var/log/containers/*.log&quot;</code> 下に保存されるすべてのアプリケーションログは、専用の <code>/aws/containerinsights/Cluster_Name/application</code> ロググ  ループにストリーミングされます。kube-proxy や aws-node ログなどの非アプリケーションログはデフォルトで除外されます。ただし、CoreDNS ログなどの追加の Kubernetes アドオンログも処理され、このロググループにストリーミングされます。</li>
<li>ホストログ：各 EKS ワーカーノードのシステムログは、<code>/aws/containerinsights/Cluster_Name/host</code> ロググループにストリーミングされます。これらのシステムログには、<code>&quot;/var/log/messages,/var/log/dmesg,/var/log/secure&quot;</code> ファイルの内容が含まれます。コンテナ化されたワークロードのステートレスで動的な性質を考慮すると、EKS ワーカーノードがスケーリング活動中に頻繁に終了されるため、これらのログをリアルタイムで Fluent Bit でストリーミングし、ノードが終了した後でも CloudWatch Logs で利用可能にすることは、EKS ワーカーノードの可観測性とヘルスモニタリングの観点から重要です。また、多くの場合、ワーカーノードにログインせずにクラスターの問題をデバッグまたはトラブルシューティングし、これらのログをより体系的に分析することができます。</li>
<li>データプレーンログ：EKS はすでに <a href="https://docs.aws.amazon.com/ja_jp/eks/latest/userguide/control-plane-logs.html" target="_blank" rel="noopener noreferrer">コントロールプレーンログ</a> を提供しています。Container Insights における Fluent Bit 統合により、すべてのワーカーノードで実行され、実行中の Pod の維持を担当する EKS データプレーンコンポーネントによって生成されるログがデータプレーンログとしてキャプチャされます。これらのログも <code>&#x27;/aws/containerinsights/Cluster_Name/dataplane&#x27;</code> 下の専用の CloudWatch ロググループにストリーミングされます。kube-proxy、aws-node、Docker ランタイムログがこのロググループに保存されます。コントロールプレーンログに加えて、データプレーンログを CloudWatch Logs に保存することで、EKS クラスターの完全な全体像を提供するのに役立ちます。</li>
</ul>
<p>さらに、Fluent Bit の設定、Fluent Bit のモニタリング、ログ分析などのトピックについては、<a href="https://aws.amazon.com/blogs/containers/fluent-bit-integration-in-cloudwatch-container-insights-for-eks/" target="_blank" rel="noopener noreferrer">Amazon EKS における Fluent Bit の統合</a> で詳しく学んでください。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="amazon-eks-における-container-insights-のコスト削減">Amazon EKS における Container Insights のコスト削減<a href="#amazon-eks-における-container-insights-のコスト削減" class="hash-link" aria-label="Amazon EKS における Container Insights のコスト削減 への直接リンク" title="Amazon EKS における Container Insights のコスト削減 への直接リンク">​</a></h3>
<p>デフォルト設定では、Container Insights レシーバーは <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/awscontainerinsightreceiver#available-metrics-and-resource-attributes" target="_blank" rel="noopener noreferrer">レシーバーのドキュメント</a> で定義されている完全なメトリクスセットを収集します。収集されるメトリクスとディメンションの数は多く、大規模なクラスターでは、メトリクスの取り込みと保存のコストが大幅に増加します。ここでは、価値のあるメトリクスのみを送信してコストを削減するために、ADOT Collector を設定する 2 つの異なるアプローチを紹介します。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="プロセ  ッサーの使用">プロセッサーの使用<a href="#プロセッサーの使用" class="hash-link" aria-label="プロセッサーの使用 への直接リンク" title="プロセッサーの使用 への直接リンク">​</a></h4>
<p>このアプローチでは、上記で説明した OpenTelemetry プロセッサーを導入して、メトリクスや属性をフィルタリングし、<a href="https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/CloudWatch_Embedded_Metric_Format.html" target="_blank" rel="noopener noreferrer">EMF ログ</a> のサイズを削減します。ここでは、<em>Filter</em> と <em>Resource</em> という 2 つのプロセッサーの基本的な使用方法を示します。</p>
<p><a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/filterprocessor/README.md" target="_blank" rel="noopener noreferrer">Filter プロセッサー</a> は、<code>otel-agent-conf</code> という名前の <code>ConfigMap</code> に含めることができます：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">processors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # filter processors example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  filter/include:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # any names NOT matching filters are excluded from remainder of pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      include:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match_type: regexp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metric_names:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          # re2 regexp patterns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ^pod_.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  filter/exclude:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # any names matching filters are excluded from remainder of pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metrics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      exclude:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match_type: regexp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metric_names:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - ^pod_network.*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/resourceprocessor/README.md" target="_blank" rel="noopener noreferrer">Resource プロセッサー</a> も AWS OpenTelemetry Distro に組み込まれており、不要なメトリクス属性を削除するために使用できます。例えば、EMF ログから <code>Kubernetes</code> と <code>Sources</code> フィールドを削除したい場合、以下のようにリソースプロセッサーをパイプラインに追加できます：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  # resource processors example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    attributes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - key: Sources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      action: delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - key: kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      action: delete</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="メトリクスとディメンションのカスタマイズ">メトリクスとディメンションのカスタマイズ<a href="#メトリクスとディメンションのカスタマイズ" class="hash-link" aria-label="メトリクスとディメンションのカスタマイズ への直接リンク" title="メトリクスとディメンションのカスタマイズ への直接リンク">​</a></h4>
<p>このアプローチでは、CloudWatch EMF エクスポーターを設定して、CloudWatch Logs に送信したいメトリクスのセットのみを生成するようにします。CloudWatch EMF エクスポーター設定の <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/5ccdbe08c6a2a43b7c6c7f9c0031a4b0348394a9/exporter/awsemfexporter/README.md#metric_declaration" target="_blank" rel="noopener noreferrer">metric_declaration</a> セクションを使用して、エクスポートしたいメトリクスとディメンションのセットを定義できます。例えば、デフォルト設定から Pod メトリクスのみを保持することができます。この <code>metric_declaration</code> セクションは以下のようになり、メトリクス数を減らすために、他のものを気にしない場合はディメンションセットを <code>[PodName, Namespace, ClusterName]</code> のみに保持できます：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  awsemf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    namespace: ContainerInsights</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_group_name: &#x27;/aws/containerinsights/{ClusterName}/performance&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_stream_name: &#x27;{NodeName}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource_to_telemetry_conversion:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dimension_rollup_option: NoDimensionRollup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parse_json_encoded_attr_values: [Sources, kubernetes]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # カスタマイズされたメトリクス宣言セクション</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metric_declarations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Pod メトリクス</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - dimensions: [[PodName, Namespace, ClusterName]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metric_name_selectors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - pod_cpu_utilization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - pod_memory_utilization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - pod_cpu_utilization_over_pod_limit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - pod_memory_utilization_over_pod_limit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この設定により、デフォルト設定の複数のディメンションに対する 55 の異なるメトリクスではなく、単一のディメンション <code>[PodName, Namespace, ClusterName]</code> 内で以下の 4 つのメトリクスが生成されストリーミングされます：</p>
<ul>
<li>pod_cpu_utilization</li>
<li>pod_memory_utilization</li>
<li>pod_cpu_utilization_over_pod_limit</li>
<li>pod_memory_utilization_over_pod_limit</li>
</ul>
<p>この設定により、デフォルトで設定されているすべてのメトリクスではなく、興味のあるメトリクスのみを送信することができます。結果として、Container Insights のメトリクス取り込みコストを大幅に削減できます。この柔軟性により、Container Insights の顧客はエクスポートされるメトリクスを高度に制御できます。<code>awsemf</code> エクスポーター設定を変更してメトリクスをカスタマイズすることも非常に柔軟で、送信したいメトリクスとそのディメンションの両方をカスタマイズできます。これは CloudWatch に送信されるログにのみ適用されることに注意してください。</p>
<p>上記で説明した 2 つのアプローチは互いに排他的ではありません。実際、両方を組み合わせることで、監視システムに取り込みたいメトリクスをカスタマイズする際に高度な柔軟性を得ることができます。このアプローチを使用して、以下のグラフに示すように、メトリクスの保存と処理に関連するコストを削減します。</p>
<p><img decoding="async" loading="lazy" alt="CW-COST-EXPLORER" src="/observability-best-practices/ja/assets/images/cw-cost-explorer-36744006c7f0596712be861fc21076e2.jpg" width="1441" height="579" class="img_ev3q"></p>
<p><em>図：AWS コストエクスプローラー</em></p>
<p>上記の AWS コストエクスプローラーのグラフでは、小規模な EKS クラスター（ワーカーノード 20 台、Pod 220 個）で ADOT Collector の異なる設定を使用した場合の CloudWatch に関連する日々のコストを確認できます。<em>8 月 15 日</em> は、デフォルト設定の ADOT Collector を使用した CloudWatch の請求を示しています。<em>8 月 16 日</em> には、<a href="https://aws.amazon.com/jp/blogs/news/cost-savings-by-customizing-metrics-sent-by-container-insights-in-amazon-eks/" target="_blank" rel="noopener noreferrer">EMF エクスポーターのカスタマイズ</a> アプローチを使用し、約 30% のコスト削減が見られます。<em>8 月 17 日</em> には、<a href="https://aws.amazon.com/jp/blogs/news/cost-savings-by-customizing-metrics-sent-by-container-insights-in-amazon-eks/" target="_blank" rel="noopener noreferrer">プロセッサー</a> アプローチを使用し、約 45% のコスト削減を達成しています。</p>
<p>Container Insights によって送信されるメトリクスをカスタマイズすることのトレードオフを考慮する必要があります。監視コストを削減できますが、監視対象クラスターの可視性を犠牲にすることになります。また、ダッシュボードで使用されているメトリクスとディメンションを送信しな  いように選択できるため、AWS コンソール内の Container Insights が提供するビルトインダッシュボードに影響を与える可能性があります。さらに学習を深めるには、<a href="https://aws.amazon.com/jp/blogs/news/cost-savings-by-customizing-metrics-sent-by-container-insights-in-amazon-eks/" target="_blank" rel="noopener noreferrer">Amazon EKS の Container Insights によって送信されるメトリクスをカスタマイズすることによるコスト削減</a> をご覧ください。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="eks-blueprints-を使用した-container-insights-のセットアップ">EKS Blueprints を使用した Container Insights のセットアップ<a href="#eks-blueprints-を使用した-container-insights-のセットアップ" class="hash-link" aria-label="EKS Blueprints を使用した Container Insights のセットアップ への直接リンク" title="EKS Blueprints を使用した Container Insights のセットアップ への直接リンク">​</a></h3>
<p><a href="https://aws.amazon.com/jp/blogs/news/bootstrapping-clusters-with-eks-blueprints/" target="_blank" rel="noopener noreferrer">EKS Blueprints</a> は、アカウントやリージョン間で一貫性のある、すぐに使用可能な EKS クラスターを構成およびデプロイするのに役立つ Infrastructure as Code (IaC) モジュールのコレクションです。EKS Blueprints を使用すると、<a href="https://docs.aws.amazon.com/ja_jp/eks/latest/userguide/eks-add-ons.html" target="_blank" rel="noopener noreferrer">Amazon EKS アドオン</a> や、Prometheus、Karpenter、Nginx、Traefik、AWS Load Balancer Controller、Container Insights、Fluent Bit、Keda、Argo CD などの幅広い人気のオープンソースアドオンを含む EKS クラスターを簡単にブートストラップできます。EKS Blueprints は、インフラストラクチャのデプロイメントを自動化するのに役立つ 2 つの人気のある IaC フレームワーク、<a href="https://github.com/aws-ia/terraform-aws-eks-blueprints" target="_blank" rel="noopener noreferrer">HashiCorp Terraform</a> と <a href="https://github.com/aws-quickstart/cdk-eks-blueprints" target="_blank" rel="noopener noreferrer">AWS Cloud Development Kit (AWS CDK)</a> で実装されています。</p>
<p>EKS Blueprints を使用した Amazon EKS クラスター作成プロセスの一部として、Container Insights を Day One の運用ツールとしてセットアップし、コンテナ化されたアプリケーションやマイクロサービスからメトリクスとログを収集、集約、要約して Amazon CloudWatch コンソールに表示することができます。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="結論">結論<a href="#結論" class="hash-link" aria-label="結論 への直接リンク" title="結論 への直接リンク">​</a></h3>
<p>オブザーバビリティのベストプラクティスガイドのこのセクションでは、CloudWatch Container Insights に関する多くの詳細な内容を扱いました。これには Amazon CloudWatch Container Insights の紹介と、Amazon EKS 上のコンテナ化されたワークロードを観察するのにどのように役立つかが含まれています。AWS Distro for Open Telemetry と Amazon CloudWatch Container Insights を使用して、Container Insights メトリクスの収集を有効にし、Amazon CloudWatch コンソールでコンテナ化されたワークロードのメトリクスを可視化する方法について、より深く掘り下げました。</p>
<p>次に、Amazon EKS 向けの CloudWatch Container Insights における Fluent Bit 統合について詳しく説明しました。これにより、Fluent Bit 内に専用の入力ストリームを作成し、アプリケーション、ホスト、データプレーンログ用に CloudWatch Logs 内に独立したロググループを作成できます。</p>
<p>さらに、CloudWatch Container Insights でコスト削減を実現するための 2 つの異なるアプローチ（プロセッサーとメトリクスディメンション）について説明しました。最後に、Amazon EKS クラスター作成プロセス中に Container Insights をセットアップするための手段として EKS Blueprints を使用する方法について簡単に説明しました。</p>
<p><a href="https://catalog.workshops.aws/observability/en-US" target="_blank" rel="noopener noreferrer">One Observability Workshop</a> 内の <a href="https://catalog.workshops.aws/observability/en-US/aws-native/insights/containerinsights" target="_blank" rel="noopener noreferrer">CloudWatch Container Insights モジュール</a> で実践的な経験を積むことができます。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/aws-observability/observability-best-practices/blob/main/docusaurus/docs/guides/containers/aws-native/eks/amazon-cloudwatch-container-insights.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/observability-best-practices/ja/guides/containers/oss/ecs/best-practices-metrics-collection-2"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">AWS Distro for OpenTelemetry を使用した ECS クラスターでのサービスメトリクスの収集</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/observability-best-practices/ja/guides/containers/aws-native/eks/log-aggregation"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">ログ集約</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#はじめに" class="table-of-contents__link toc-highlight">はじめに</a></li><li><a href="#aws-distro-for-open-telemetry-を使用した-amazon-cloudwatch-container-insights" class="table-of-contents__link toc-highlight">AWS Distro for Open Telemetry を使用した Amazon CloudWatch Container Insights</a></li><li><a href="#amazon-eks-向け-cloudwatch-container-insights-における-fluent-bit-の統合" class="table-of-contents__link toc-highlight">Amazon EKS 向け CloudWatch Container Insights における Fluent Bit の統合</a></li><li><a href="#amazon-eks-における-container-insights-のコスト削減" class="table-of-contents__link toc-highlight">Amazon EKS における Container Insights のコスト削減</a></li><li><a href="#eks-blueprints-を使用した-container-insights-のセットアップ" class="table-of-contents__link toc-highlight">EKS Blueprints を使用した Container Insights のセットアップ</a></li><li><a href="#結論" class="table-of-contents__link toc-highlight">結論</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS. <br> © 2025.  Amazon.com, Inc. or its affiliates. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>